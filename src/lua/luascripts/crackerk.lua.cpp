#ifdef LUACONSOLE
#ifdef _MSC_VER
#include "Platform.h"
#include "resource.h"
#endif
#include "lua/LuaCompat.h"
void luaopen_crackerk(lua_State *l)
{
#ifndef _MSC_VER
	int crackerk_luac_sz = 145822;
	const char* crackerk_luac = "--Cracker1000's custom script version 6.1\nlocal toggle = Button:new(314,0,23,12, \"V\", \"Toggle additional menus.\")\nlocal newmenu = Window:new(-15,-15, 610, 300)\nlocal creditstxt1 = Label:new(110,-20,100, 60,\"Welcome to the Mod settings. Tip: 'J' can be used as a shortcut.\")\nnewmenu:addComponent(creditstxt1)\n\nlocal deletesparkButton =  Button:new(10,28,75,30,\"Interface\", \"shows UI related stuff.\")\n\nlocal UIhidey = Button:new(90,28,80,20,\"Hide\", \"Hides the UI\")\nlocal UIhiden = Button:new(90,48,80,20,\"Show\", \"Shows the UI\")\n\nlocal FPS = Button:new(10,60,75,30, \"Frame limiter\", \"Turns the frame limiter on/off.\")\nlocal FPS1 = Button:new(90,60,80,20, \"On\", \"Turns the frame limiter on.\")\nlocal FPS2 = Button:new(90,80,80,20, \"Off\", \"Turns the frame limiter off.\")\n\nlocal reset= Button:new(10,92,75,30,\"Reset\", \"Reset everything.\")\n\nlocal info= Button:new(10,124,75,30,\"Stack tools\", \"Usefull for subframe.\")\nlocal info1= Button:new(90,124,80,20,\"Separate\", \"Removes top most particle from stack.\")\nlocal info2= Button:new(90,144,80,20,\"Delete\", \"Leaves top particle and PHOT but remove everything else.\")\n\nlocal Ruler = Button:new(10,156,75,30, \"Ruler\", \"Toggles in game ruler.\")\nlocal Ry = Button:new(90,156,80,20,\"Hide\", \"Hides the Ruler\")\nlocal Rn = Button:new(90,176,80,20,\"Show\", \"Shows the Ruler. (Press SHIFT)\")\n\nlocal rc = Button:new(10,188,75,30,\"Record\", \"Options for recording frames\")\nlocal rc1 = Button:new(90,188,80,20,\"Start\", \"Starts recording\")\nlocal rc2 = Button:new(90,206,80,20,\"Stop\",\"Stops recording\")\n\nlocal bar = Button:new(10,220,75,30,\"Top bar\", \"Toggle top bar\")\nlocal bary = Button:new(90,220,80,20,\"Show\", \"Shows the bar at top\")\nlocal barn = Button:new(90,240,80,20,\"Hide\", \"Hides the bar\")\n\nlocal bug = Button:new(10,252,75,30,\"Feedback\", \"Direct to Mod thread for bug report.\")\nlocal bug1 = Button:new(90,252,50,30,\"Website\", \"Direct to Mod thread for bug report.\")\nlocal bug2 = Button:new(145,252,50,30,\"In game\", \"Direct to Mod thread for bug report.\")\n\nlocal wiki  =  Button:new(203,28,80,30,\"Wiki\", \"Element wiki!\")\n\nlocal bare = Button:new(203,60,80,30,\"Hidden Elem.\", \"Toggle hidden elements.\")\nlocal barye = Button:new(293,60,80,20,\"Show\", \"Shows hidden elements\")\nlocal barne = Button:new(293,80,80,20,\"Hide\", \"Hides elements\")\n\nlocal mp = Button:new(203,92,80,30,\"Theme\", \"Changes game's theme\")\nlocal mp1 = Button:new(293,92,75,20,\"Dark\", \"Change the theme to default\")\nlocal mp2 = Button:new(293,112,75,20,\"Fire\", \"Change the theme to Blue\")\nlocal mp3 = Button:new(293,132,75,20,\"Aqua\", \"Change the theme to Red\")\nlocal mp4 = Button:new(293,152,75,20,\"Forest\", \"Change the theme to Green\")\nlocal mp5 = Button:new(293,172,75,20,\"Sun\", \"Change the theme to Yellow\")\nlocal mp6 = Button:new(293,192,75,20,\"Orange\", \"Change the theme to Orange\")\nlocal mp7 = Button:new(293,212,75,20,\"Vanilla\", \"Change the theme back to Plain white\")\nlocal mp8 = Button:new(293,232,75,20,\"Pulse\", \"RBG makes everything better.\")\nlocal mp9 = Button:new(293,252,75,20,\"Custom\", \"Custom options.\")\nlocal rl = Label:new(480, 92, 10, 15, \"Red\")\nlocal gl = Label:new(480, 112, 10, 15, \"Green\")\nlocal bl = Label:new(480, 132, 10, 15, \"Blue\")\nlocal rSlider = Slider:new(373, 92, 100, 15, 255)\nlocal gSlider = Slider:new(373, 112, 100, 15, 255)\nlocal bSlider = Slider:new(373, 132, 100, 15, 255)\n\nlocal rlb = Label:new(510, 92, 10, 15)\nlocal glb = Label:new(510, 112, 10, 15)\nlocal blb = Label:new(510, 132, 10, 15)\n\nlocal mpop = Button:new(373,152,75,20,\"Done\", \"Custom options.\")\n\nlocal bg = Button:new(203,124,80,30,\"Backgrounds\", \"Sets different backgrounds.\")\nlocal bg1 = Button:new(293,124,75,20,\"BLACK\", \"Default\")\nlocal bg2 = Button:new(293,146,75,20,\"BLUE\", \"Blue background\")\nlocal bg3 = Button:new(293,166,75,20,\"RED\", \"Red background\")\nlocal bg4 = Button:new(293,186,75,20,\"GREEN\", \"Green background\")\nlocal bg5 = Button:new(293,206,75,20,\"YELLOW\", \"Yellow background\")\nlocal bgI = Button:new(373,124,75,20,\"Brighten\", \"Increase brightness\")\nlocal bgD = Button:new(373,146,75,20,\"Dimmer\", \"Decrease brightness\")\n\nlocal autohide= Button:new(203,156,80,30, \"Auto Hide HUD\", \"Hide.\")\nlocal autohidey= Button:new(293,156,75,20, \"On\", \"Hide.\")\nlocal autohiden= Button:new(293,176,75,20, \"Off\", \"Hide.\")\n\nlocal chud = Button:new(203,188,80,30, \"Texter\", \"for text.\")\n\nlocal brightness = Button:new(203,220,80,30, \"Brightness\", \"Adjust brightness.\")\nlocal brightSlider = Slider:new(293,220, 100, 15, 255)\n\nlocal brop = Button:new(293,235,45,20,\"On\", \"Save.\")\nlocal bropc = Button:new(342,235,45,20,\"Off\", \"Cancel.\")\nlocal brlabel = Label:new(340, 210, 10, 15, \"Turned: Off\")\n\nlocal reminder = Button:new(203,252,80,30, \"Reminder\", \"reminds after 30 mins.\")\nlocal remon = Button:new(293,252,45,20,\"On\", \"Save.\")\nlocal remoff  = Button:new(293,272,45,20,\"Off\", \"Cancel.\")\nlocal remlabel = Label:new(68, 284, 10, 15, \"Reminder is on (30 mins.)\")\n\nlocal fancur = Button:new(396,28,80,30, \"Fancy cursor\", \"Draws graphics around cursor.\")\nlocal fanon = Button:new(483,28,40,20,\"On\", \"Turnon\")\nlocal fanoff  = Button:new(483,48,40,20,\"Off\", \"Turnoff\")\n\nlocal hide= Button:new(528,278,80,20, \"Close menu\", \"Hide.\")\n\nfunction clearm()\nnewmenu:removeComponent(reset)\nnewmenu:removeComponent(FPS)\nnewmenu:removeComponent(deletesparkButton)\nnewmenu:removeComponent(hide)\nnewmenu:removeComponent(info)\nnewmenu:removeComponent(Ruler)\nnewmenu:removeComponent(mp)\nnewmenu:removeComponent(rc)\nnewmenu:removeComponent(bg)\nnewmenu:removeComponent(bug)\nnewmenu:removeComponent(bar)\nnewmenu:removeComponent(bare)\nnewmenu:removeComponent(wiki)\nnewmenu:removeComponent(autohide)\nnewmenu:removeComponent(chud)\nnewmenu:removeComponent(brightness)\nnewmenu:removeComponent(reminder)\nnewmenu:removeComponent(fancur)\nend\n\nfunction clearsb()\nnewmenu:removeComponent(UIhiden)\nnewmenu:removeComponent(UIhidey)\nnewmenu:removeComponent(Ry)\nnewmenu:removeComponent(Rn)\nnewmenu:removeComponent(rc1)\nnewmenu:removeComponent(rc2)\nnewmenu:removeComponent(bug1)\nnewmenu:removeComponent(bug2)\nnewmenu:removeComponent(bg1)\nnewmenu:removeComponent(bg2)\nnewmenu:removeComponent(bg3)\nnewmenu:removeComponent(bg4)\nnewmenu:removeComponent(bg5)\nnewmenu:removeComponent(bgI)\nnewmenu:removeComponent(bgD)\nnewmenu:removeComponent(FPS1)\nnewmenu:removeComponent(FPS2)\nnewmenu:removeComponent(mp1)\nnewmenu:removeComponent(mp2)\nnewmenu:removeComponent(mp3)\nnewmenu:removeComponent(mp4)\nnewmenu:removeComponent(mp5)\nnewmenu:removeComponent(mp6)\nnewmenu:removeComponent(mp7)\nnewmenu:removeComponent(mp8)\nnewmenu:removeComponent(mp9)\nnewmenu:removeComponent(bary)\nnewmenu:removeComponent(barn)\nnewmenu:removeComponent(barye)\nnewmenu:removeComponent(barne)\nnewmenu:removeComponent(info1)\nnewmenu:removeComponent(info2)\nnewmenu:removeComponent(autohidey)\nnewmenu:removeComponent(autohiden)\nnewmenu:removeComponent(rSlider)\nnewmenu:removeComponent(gSlider)\nnewmenu:removeComponent(bSlider)\nnewmenu:removeComponent(rl)\nnewmenu:removeComponent(gl)\nnewmenu:removeComponent(bl)\nnewmenu:removeComponent(rlb)\nnewmenu:removeComponent(glb)\nnewmenu:removeComponent(blb)\nnewmenu:removeComponent(mpop)\nnewmenu:removeComponent(brop)\nnewmenu:removeComponent(bropc)\nnewmenu:removeComponent(brlabel)\nnewmenu:removeComponent(brightSlider)\nnewmenu:removeComponent(remon)\nnewmenu:removeComponent(remoff)\nnewmenu:removeComponent(fanon)\nnewmenu:removeComponent(fanoff)\nend\n\n\nfunction drawcirc()\nif MANAGER.getsetting(\"CRK\", \"savergb\") == \"2\" then\ngraphics.fillCircle(tpt.mousex, tpt.mousey,tpt.brushx+10,tpt.brushy+10,ar,ag,ab,110)\nelse\ngraphics.fillCircle(tpt.mousex, tpt.mousey,tpt.brushx+10,tpt.brushy+10,colourRED,colourGRN,colourBLU,110)\nend\nend\n\nfancur:action(function(sender)\nclearsb()\nfs.makeDirectory(\"scripts\")\nnewmenu:addComponent(fanon)\nnewmenu:addComponent(fanoff)\nend)\n\nfanon:action(function(sender)\nMANAGER.savesetting(\"CRK\", \"fanc\",1)\nevent.unregister(event.tick,drawcirc)\nevent.register(event.tick,drawcirc)\nclearsb()\nend)\n\nfanoff:action(function(sender)\nMANAGER.savesetting(\"CRK\", \"fanc\",0)\nevent.unregister(event.tick,drawcirc)\nclearsb()\nend)\n\nlocal startTime\n\nfunction remindme()\nlocal endTime = startTime+ 1800\nif os.time() >= endTime then\nevent.unregister(event.tick,remindme)\nnewmenu:removeComponent(remlabel)\ntpt.message_box(\"Activity Reminder!\",\"You have played for 30 mins. Simulation has been paused to save resources. Click dismiss to continue.\")\nend\nend\n\nreminder:action(function(sender)\nclearsb()\nnewmenu:addComponent(remon)\nnewmenu:addComponent(remoff)\nend)\n\nremon:action(function(sender)\nclearsb()\nstartTime = os.time()\nevent.unregister(event.tick,remindme)\nevent.register(event.tick,remindme)\nnewmenu:addComponent(remlabel)\nnewmenu:addComponent(remon)\nnewmenu:removeComponent(remon)\nnewmenu:removeComponent(remoff)\nend)\n\nremoff:action(function(sender)\nclearsb()\nevent.unregister(event.tick,remindme)\nnewmenu:removeComponent(remlabel)\nnewmenu:removeComponent(remon)\nnewmenu:removeComponent(remoff)\nend)\n\nfunction cbrightness()\ntpt.fillrect(-1,-1,629,424,0,0,0,255 - MANAGER.getsetting(\"CRK\", \"brightness\"))\nend\n\nbrightness:action(function(sender)\nif MANAGER.getsetting(\"CRK\", \"brightstate\") == \"1\" then\nnewmenu:onDraw(cbrightness)\nend\nfs.makeDirectory(\"scripts\")\nclearsb()\nbrightSlider:value (MANAGER.getsetting(\"CRK\", \"brightness\"))\nbrightSlider:onValueChanged(function() MANAGER.savesetting(\"CRK\", \"brightness\", brightSlider:value()+30) end)\nnewmenu:addComponent(brlabel)\nnewmenu:addComponent(brightSlider)\nnewmenu:addComponent(brop)\nnewmenu:addComponent(bropc)\nend)\n\nbrop:action(function(sender)\nMANAGER.savesetting(\"CRK\", \"brightstate\", \"1\")\nevent.unregister(event.tick,cbrightness)\nevent.register(event.tick,cbrightness)\nnewmenu:removeComponent(brightSlider)\nbrlabel:text(\"Turned: on\")\nnewmenu:removeComponent(brlabel)\nnewmenu:removeComponent(brop)\nnewmenu:removeComponent(bropc)\nend)\n\nbropc:action(function(sender)\nMANAGER.savesetting(\"CRK\", \"brightstate\", \"0\")\nbrlabel:text(\"Turned: off\")\nevent.unregister(event.tick,cbrightness)\nbrightSlider:value(\"200\")\nnewmenu:removeComponent(brightSlider)\nnewmenu:removeComponent(brop)\nnewmenu:removeComponent(brlabel)\nnewmenu:removeComponent(bropc)\nend)\n\n--Texter script hybrid start\nyvalue = 50\nlinenumber = 01\nfunction drawLetter(letter, x, y, element, font)\n\n        for currentX = 0, fonts[font]['width'] - 1 + fonts[font][letter]['kerning'] do\n\n                for currentY = fonts[font][letter]['descender'], fonts[font]['height'] - 1 do\n\n                        if fonts[font][letter]['pixels'][currentY + 1 - fonts[font][letter]['descender']][currentX + 1] == 1 then\n\n                                -- Create the element\n                                tpt.create(x + currentX, y + currentY - fonts[font][letter]['descender'], element)\n                        end\n                end\n        end\nend\n\nfunction drawText(text, x, y, element, font)\n\n        local currentLetter\n        local originalX = x\n\n        for p = 1, #text do\n\n                currentLetter = string.sub(text, p, p)\n\n                if currentLetter == '\\n' then\n\n                        -- Reset to new line\n                        x = originalX\n                        y = y + fonts[font]['height'] + fonts[font]['linespacing']\n\n                elseif fonts['5x7'][currentLetter] then\n\n                        -- Draw letter\n                        drawLetter(currentLetter, x, y, element, font)\n                        x = x + fonts[font]['width'] + fonts[font]['charspacing'] + fonts[font][currentLetter]['kerning']\n\n                else\n\n                        -- Draw null character\n                        drawLetter('NULL', x, y, element, font)\n                        x = x + fonts[font]['width'] + fonts[font]['charspacing'] + fonts[font]['NULL']['kerning']\n                end\n\n        end\nend\n\nchud:action(function(sender)\nyvalue = 50\nlinenumber = 01\nlocal mouseX, mouseY = tpt.mousex, tpt.mousey\nlocal text, element, font = '', 'ARAY', '5x7'\nclearsb()\nclearm()\nlocal textTextboxs = Textbox:new(98, 55, 40, 20, '', 'Element')\nlocal textTextbox = Textbox:new(10, 30, 505, 20, '', 'Type your text here.')\nlocal scripthelp = Label:new(133,100,120, 10,\"Texter help:\\nElement box: Type the desired output element here (Defaults to ARAY.)\\nNewline: Inserts a new line and places existing text automatically (Max 33.)\\nEnter and Cancel: To place the text or cancel it.\")\nlocal place = Button:new(10,55,40,20,\"Enter\", \"Toggle hidden elements.\")\nlocal cancel= Button:new(52,55,40,20,\"Cancel\", \"Cancel the element placement.\")\nlocal newline = Button:new(142,55,46,20,\"New line\", \"New line.\")\nlocal lno  = Label:new(210, 58, 10, 15, \"Line No:\")\nlocal lnol  = Label:new(240, 58, 10, 15, linenumber)\n\nnewmenu:addComponent(textTextbox)\nnewmenu:addComponent(textTextboxs)\nnewmenu:addComponent(scripthelp) \nnewmenu:addComponent(place)\nnewmenu:addComponent(cancel)\nnewmenu:addComponent(newline)\nnewmenu:addComponent(lno)\nnewmenu:addComponent(lnol)\n textTextbox:onTextChanged(\n                    function(sender)\n                            text = textTextbox:text();\n                    end\n                )\n\n textTextboxs:onTextChanged(\n                    function(sender)\n                            element = textTextboxs:text();\n                    end\n                )\ncancel:action(function(sender)\nnewmenu:removeComponent(scripthelp)\nnewmenu:removeComponent(textTextbox)\nnewmenu:removeComponent(textTextboxs)\nnewmenu:removeComponent(place)\nnewmenu:removeComponent(cancel)\nnewmenu:removeComponent(newline)\nnewmenu:removeComponent(lno)\nnewmenu:removeComponent(lnol)\nclose()\nend)\n\nnewline:action(function(sender)\nif linenumber < 33 then\ntext = textTextbox:text();\ndrawText(string.gsub(text, '\\\\n', '\\n') .. '\\n', 11, yvalue, element, font)\nyvalue = yvalue+10\ntextTextbox:text('')\nlinenumber = linenumber + 1\nlnol:text(linenumber)\nend\nend)\n\nplace:action(function(sender)\nnewmenu:removeComponent(scripthelp)\nnewmenu:removeComponent(textTextbox)\nnewmenu:removeComponent(textTextboxs)\nnewmenu:removeComponent(place)\nnewmenu:removeComponent(cancel)\nnewmenu:removeComponent(newline)\nnewmenu:removeComponent(lno)\nnewmenu:removeComponent(lnol)\nclose()\ndrawText(string.gsub(text, '\\\\n', '\\n') .. '\\n', 11, yvalue, element, font)\nend)\nend)\n\n--Texter script hybrid end\n\nfunction autohidehud()\n\011if tpt.mousey <= 55 then tpt.hud(0) else tpt.hud(1)\n\011end\nend\n\nautohide:action(function(sender)\nclearsb()\nnewmenu:addComponent(autohidey)\nnewmenu:addComponent(autohiden)\nend)\n\nautohidey:action(function(sender)\nevent.register(event.tick,autohidehud)\nclearsb()\nend)\n\nautohiden:action(function(sender)\nevent.unregister(event.tick,autohidehud)\nclearsb()\nend)\n\nbug:action(function(sender)\nclearsb()\nnewmenu:addComponent(bug1)\nnewmenu:addComponent(bug2)\nend)\n\nbug1:action(function(sender)\nclearsb()\nplatform.openLink(\"https://powdertoy.co.uk/Discussions/Thread/View.html?Thread=23279\")\nend)\n\nbug2:action(function(sender)\nsim.loadSave(2596812,0) \nclearsb()\nend)\n\nbare:action(function(sender)\nclearsb()\nnewmenu:addComponent(barye)\nnewmenu:addComponent(barne)\nend)\n\nbarye:action(function(sender)\ntpt.el.dyst.menusection=8\ntpt.el.eqve.menusection=8\ntpt.el.shd4.menusection=9\ntpt.el.shd3.menusection=9\ntpt.el.shd2.menusection=9\ntpt.el.lolz.menusection=11\ntpt.el.love.menusection=11\ntpt.el.embr.menusection=4\ntpt.el.spwn.menusection=11\ntpt.el.spwn2.menusection=11\ntpt.el.frzw.menusection=7\ntpt.el.bizs.menusection=9\ntpt.el.bizg.menusection=6\ntpt.el.bray.menusection=9\ntpt.el.psts.menusection=8\ntpt.el.mort.menusection=6\ntpt.el.dyst.menu=1\ntpt.el.eqve.menu=1\ntpt.el.shd4.menu=1\ntpt.el.shd3.menu=1\ntpt.el.shd2.menu=1\ntpt.el.lolz.menu=1\ntpt.el.love.menu=1\ntpt.el.embr.menu=1\ntpt.el.spwn.menu=1\ntpt.el.spwn2.menu=1\ntpt.el.frzw.menu=1\ntpt.el.bizs.menu=1\ntpt.el.bizg.menu=1\ntpt.el.bray.menu=1\ntpt.el.psts.menu=1\ntpt.el.mort.menu=1\nclearsb()\nend)\n\nbarne:action(function(sender)\ntpt.el.dyst.menu=0\ntpt.el.eqve.menu=0\ntpt.el.shd4.menu=0\ntpt.el.shd3.menu=0\ntpt.el.shd2.menu=0\ntpt.el.lolz.menu=0\ntpt.el.love.menu=0\ntpt.el.embr.menu=0\ntpt.el.spwn.menu=0\ntpt.el.spwn2.menu=0\ntpt.el.frzw.menu=0\ntpt.el.bizs.menu=0\ntpt.el.bizg.menu=0\ntpt.el.bray.menu=0\ntpt.el.psts.menu=0\ntpt.el.mort.menu=0\nclearsb()\nend)\n\nwiki:action(function(sender)\nlocal pgno1 = Label:new(30,400,10, 15, \"Page 1/2\")\nlocal pgno2 = Label:new(30,400,10, 15, \"Page 2/2\")\nlocal creditw = Window:new(-15,-15, 626, 422)\nlocal prevpg = Button:new(242, 400, 40, 15, \"Prev.\")\nlocal nextpg = Button:new(292, 400, 40, 15, \"Next\")\nlocal close2 = Button:new(512, 400, 100, 15, \"Close wiki\")\nlocal creditstxt = Label:new(6,-22, 598, 418,\"\\nWELCOME TO THE OFFLINE WIKI\\n\\n1) CWIR: Customisable wire. Conduction speed set using .tmp property (Range is 0 to 8) \\n.tmp2 property is used for setting melting point (default is 2000C).\\n\\n2) C-16: A powerful explosive. Explodes creating pressure about 40 units when above 65C.\\n\\n3) TIMC: Time Crystal, converts into it's ctype when sparked with PSCN. Timer set using .tmp, default is 100.\\n\\n4) FUEL: Powerful fuel, explodes when temp is above 50C or Pressure above 14.\\n\\n5) THRM: Thermostat. Maintains the surrounding temp based on its own .temp property.\\n\\n6) CLNT: Coolant. Cools down the temp of the system. Use .tmp to configure the cooling/heating power.\\nEvaporates at extreme temperatures into WTRV.\\n\\n7) DMRN: Demron. Radioactive shielding material and a better indestructible heat insulator.\\nIt can also block energy particles like PROT.\\n\\n8) FNTC & FPTC: Faster versions of NTCT and PTCT. Useful for making faster logic gates.\\n\\n9) PINV: Powered Invisible, allows particles to move through it only when activated. Use with PSCN and NSCN.\\n\\n10) UV: UV rays, harms stkms (-5 life every frame), visible with FILT, grows plnt, can sprk pscn and evaporates watr.\\nCan split WATR into O2 and H2 when passed through FILT. \\n\\n11) SUN.: Emits rays which makes PLNT grow in direction of sun, emits UV radiation, makes PSCN spark and heals STKMs.\\n\\n12) CLUD: Realistic cloud, rains and creates LIGH after sometime (every 1000 frames).\\n\\n13) LITH: Lithium ion battery, Use with PSCN and NSCN. Charges with INST when deactivated. Life sets capacity.\\nReacts with different elements like O2, WATR, ACID etc as IRL.\")\n\nlocal creditstxt2 = Label:new(6,-25, 598, 418,\"\\n\\n  14) LED:  Light Emmiting Diode. Use PSCN to activate and NSCN to deactivate. Temp sets the brightness.\\n  Different .tmp2 modes: 0 = white, 1= red, 2= green, 3 =blue, 4= yellow, 5 = pink and 6 = Flash mode.  \\n\\n  15) QGP: Quark Gluon Plasma, bursts out radiation afer sometime. Turns into Purple QGP when under 100C which is stable.\\n  Glows in different colours just before exploding. \\n\\n  16) TMPS: .tmp sensor, creats sprk when there is an element with higher .tmp than its temp. Supports .tmp deserialisation.\\n\\n  17) PHOS: Phosphorus. Shiny white  particle when spawned, slowly turns into red phosphorus with time. \\n  Burns blue or red  when in contact with CFLM or O2 respectively, (based on on .tmp).\\n  Oil reverses the oxidation turning it back into white PHOS. Melts at 45C.\\n\\n  18) CMNT: Cement, creates an exothermic reaction when mixed with water and gets solidified, darkens when solid.\\n\\n  19) NTRG: Nitrogen gas, liquifies to LN2 when cooled or when under pressure, reacts with H2 to make NITR and puts out fire.\\n\\n  20) PRMT: Promethium, radioactive element. Catches fire at high velocity (>12), creats NEUT when mixed with PLUT. \\n  Explodes at low temp and emits neut at high temp.\\n\\n  20) BEE: Eats PLNT. Secretes wax when in contact with wood and life > 75.  Attacks STKMs and FIGH.\\n  Gets aggresive if life gets below 30. Uses pressure waves to communicate when in danger!\\n\\n  21) ECLR: Electronic eraser, clears the defined radius (.tmp) when activated (Use with PSCN and NSCN). \\n\\n  22) PROJ: Projectile, converts into its's ctype upon collision. launch with PSCN. Temperature = power while .tmp = range.\\n\\n  23) PPTI and PPTO: Powered Versions of PRTI and PRTO, use with PSCN and NSCN.\\n\\n  24) SEED: Grows into PLNT of random height when placed on DUST/SAND/CLST and Watered. Needs warm temp. to grow.\\n\\n  25) CSNS: Ctype sensor, detects nearby element's ctype. Useful when working with LAVA.\")\n\ncreditw:addComponent(creditstxt)\ncreditw:addComponent(close2)\ncreditw:addComponent(nextpg)\ncreditw:addComponent(pgno1)\ncreditw:addComponent(prevpg)\n\nprevpg:action(function()\ncreditw:addComponent(creditstxt)\ncreditw:removeComponent(creditstxt2)\ncreditw:removeComponent(pgno2)\ncreditw:addComponent(pgno1)\nend)\nnextpg:action(function() \ncreditw:addComponent(creditstxt2)\ncreditw:removeComponent(creditstxt)\ncreditw:removeComponent(pgno1)\ncreditw:addComponent(pgno2)\nend)\n\nclose2:action(function() ui.closeWindow(creditw) end)\nclearsb()\nui.showWindow(creditw) \nend)\n\ninfo:action(function(sender)\nclearsb()\nnewmenu:addComponent(info1)\nnewmenu:addComponent(info2)\nend)\n\ninfo1:action(function(sender)\nfor i in sim.parts() do\n\011\011local x,y = sim.partProperty(i, sim.FIELD_X),sim.partProperty(i, sim.FIELD_Y)\n\011\011if sim.pmap (x, y) == i then \n                                tpt.delete(i)\n\011\011end\n\011end\nend)\n\ninfo2:action(function(sender)\nfor i in sim.parts() do\n\011\011local x,y = sim.partProperty(i, sim.FIELD_X),sim.partProperty(i, sim.FIELD_Y)\n\011\011if sim.pmap(x, y) ~= i and bit.band(elem.property(sim.partProperty(i, sim.FIELD_TYPE), \"Properties\"), elem.TYPE_ENERGY) == 0 then\n\011\011\011tpt.delete(i)\n\011\011end\n\011end\nend)\n\nbg:action(function(sender)\nclearsb()\nnewmenu:addComponent(bg1)\nnewmenu:addComponent(bg2)\nnewmenu:addComponent(bg3)\nnewmenu:addComponent(bg4)\nnewmenu:addComponent(bg5)\nnewmenu:addComponent(bgI)\nnewmenu:addComponent(bgD)\nend)\n\nas = 60\nbackvr = 0\nbackvg = 0\nbackvb = 0\n\nfunction backg()\ntpt.fillrect(0,-1,610,385,backvr,backvg,backvb,as)\nend\nfunction clearback()\nclearsb()\nevent.unregister(event.tick,backg)\nevent.register(event.tick,backg)\nend\n\nbgI:action(function(sender)\nas = as+30\nend)\nbgD:action(function(sender)\nas = as-30\nend)\n\nbg1:action(function(sender)\nclearsb()\nbackvr = 0\nbackvg = 0\nbackvb = 0\nevent.unregister(event.tick,backg)\nend)\nbg2:action(function(sender)\nbackvr = 0\nbackvg = 0\nbackvb = 200\nclearback()\nend)\n\nbg3:action(function(sender)\nbackvr = 200\nbackvg = 0\nbackvb = 0\nclearback()\nend)\n\nbg4:action(function(sender)\nbackvr = 0\nbackvg = 200\nbackvb = 0\nclearback()\nend)\n\nbg5:action(function(sender)\nbackvr = 200\nbackvg = 200\nbackvb = 0\nclearback()\nend)\n\nrc:action(function(sender)\nclearsb()\nnewmenu:addComponent(rc1)\nnewmenu:addComponent(rc2)\nend)\n\nrc1:action(function(sender)\ntpt.record(true)\nui.closeWindow(newmenu) \nnewmenu:removeComponent(rc1)\nnewmenu:removeComponent(rc2)\nend)\n\nrc2:action(function(sender)\nui.closeWindow(newmenu) \ntpt.record(false)\nui.closeWindow(newmenu) \nnewmenu:removeComponent(rc1)\nnewmenu:removeComponent(rc2)\nend)\n\nfunction theme()\nar = MANAGER.getsetting(\"CRK\", \"ar\")\nag = MANAGER.getsetting(\"CRK\", \"ag\")\nab = MANAGER.getsetting(\"CRK\", \"ab\")\n\nif MANAGER.getsetting(\"CRK\", \"brightstate\") == \"1\" then\nal = brightSlider:value()\nelse\nal = 255\nend\n\ntpt.drawrect(613,1,14,95,ar,ag,ab,al)\ntpt.drawrect(613,136,14,269,ar,ag,ab,al)\ntpt.drawline(612,408,612,421,ar,ag,ab,al)\ntpt.drawline(187,409,187,422,ar,ag,ab,al)\ntpt.drawline(469,408,469,421,ar,ag,ab,al)\ntpt.drawline(487,408,487,421,ar,ag,ab,al)\ntpt.drawline(507,408,507,421,ar,ag,ab,al)\ntpt.drawline(241,408,241,421,ar,ag,ab,al)\ntpt.drawline(36,408,36,421,ar,ag,ab,al)\ntpt.drawline(18,408,18,421,ar,ag,ab,al)\ntpt.drawline(580,409,580,422,ar,ag,ab,al)\ntpt.drawline(596,409,596,422,ar,ag,ab,al)\ntpt.drawrect(1,408,626,14,ar,ag,ab,al)\n\ntpt.drawline(613,96,627,96,ar,ag,ab,al)\ntpt.drawline(613,16,627,16,ar,ag,ab,al)\ntpt.drawline(613,32,627,32,ar,ag,ab,al)\ntpt.drawline(613,48,627,48,ar,ag,ab,al)\ntpt.drawline(613,64,627,64,ar,ag,ab,al)\ntpt.drawline(613,80,627,80,ar,ag,ab,al)\n\ntpt.drawline(613,151,627,151,ar,ag,ab,al)\ntpt.drawline(613,167,627,167,ar,ag,ab,al)\ntpt.drawline(613,183,627,183,ar,ag,ab,al)\ntpt.drawline(613,199,627,199,ar,ag,ab,al)\ntpt.drawline(613,215,627,215,ar,ag,ab,al)\ntpt.drawline(613,231,627,231,ar,ag,ab,al)\ntpt.drawline(613,247,627,247,ar,ag,ab,al)\ntpt.drawline(613,263,627,263,ar,ag,ab,al)\ntpt.drawline(613,279,627,279,ar,ag,ab,al)\ntpt.drawline(613,295,627,295,ar,ag,ab,al)\ntpt.drawline(613,311,627,311,ar,ag,ab,al)\ntpt.drawline(613,327,627,327,ar,ag,ab,al)\ntpt.drawline(613,343,627,343,ar,ag,ab,al)\ntpt.drawline(613,359,627,359,ar,ag,ab,al)\ntpt.drawline(613,375,627,375,ar,ag,ab,al)\ntpt.drawline(613,391,627,391,ar,ag,ab,al)\nend\n\nframeCount,colourRED,colourGRN,colourBLU = 0,0,0,0\nfunction colourblender()\nif MANAGER.getsetting(\"CRK\", \"brightstate\") == \"1\" then\nal = brightSlider:value()\nelse\nal = 255\nend\n colourRGB = {colourRED,colourGRN,colourBLU}\n if frameCount > 1529 then frameCount = 0 else frameCount = frameCount + 1 end\n if frameCount > 0 and frameCount < 255 then\n  colourRED = 255\n  if colourGRN > 254 then else colourGRN = colourGRN + 1 end\n end\n if frameCount > 254 and frameCount < 510 then\n  colourGRN = 255\n  if colourRED == 0 then else colourRED = colourRED - 1 end\n end\n if frameCount > 510 and frameCount < 765 then\n  colourGRN = 255\n  if colourBLU > 254 then else colourBLU = colourBLU + 1 end\n end\n if frameCount > 764 and frameCount < 1020 then\n  colourBLU = 255\n  if colourGRN == 0 then else colourGRN = colourGRN - 1 end\n end\n if frameCount > 1020 and frameCount < 1275 then\n  colourBLU = 255\n  if colourRED > 254 then else colourRED = colourRED + 1 end\n end\n if frameCount > 1274 and frameCount < 1530 then\n  colourRED = 255\n  if colourBLU == 0 then else colourBLU = colourBLU - 1 end\n end\ntpt.drawrect(613,1,14,95,colourRED,colourGRN,colourBLU,al)\ntpt.drawrect(613,136,14,269,colourRED,colourGRN,colourBLU,al)\ntpt.drawline(612,408,612,421,colourRED,colourGRN,colourBLU,al)\ntpt.drawline(187,409,187,422,colourRED,colourGRN,colourBLU,al)\ntpt.drawline(469,408,469,421,colourRED,colourGRN,colourBLU,al)\ntpt.drawline(487,408,487,421,colourRED,colourGRN,colourBLU,al)\ntpt.drawline(507,408,507,421,colourRED,colourGRN,colourBLU,al)\n\ntpt.drawline(241,408,241,421,colourRED,colourGRN,colourBLU,al)\ntpt.drawline(36,408,36,421,colourRED,colourGRN,colourBLU,al)\ntpt.drawline(18,408,18,421,colourRED,colourGRN,colourBLU,al)\ntpt.drawline(580,409,580,422,colourRED,colourGRN,colourBLU,al)\ntpt.drawline(596,409,596,422,colourRED,colourGRN,colourBLU,al)\ntpt.drawrect(1,408,626,14,colourRED,colourGRN,colourBLU,al)\n\ntpt.drawline(613,96,627,96,colourRED,colourGRN,colourBLU,al)\ntpt.drawline(613,16,627,16,colourRED,colourGRN,colourBLU,al)\ntpt.drawline(613,32,627,32,colourRED,colourGRN,colourBLU,al)\ntpt.drawline(613,48,627,48,colourRED,colourGRN,colourBLU,al)\ntpt.drawline(613,64,627,64,colourRED,colourGRN,colourBLU,al)\ntpt.drawline(613,80,627,80,colourRED,colourGRN,colourBLU,al)\n\ntpt.drawline(613,151,627,151,colourRED,colourGRN,colourBLU,al)\ntpt.drawline(613,167,627,167,colourRED,colourGRN,colourBLU,al)\ntpt.drawline(613,183,627,183,colourRED,colourGRN,colourBLU,al)\ntpt.drawline(613,199,627,199,colourRED,colourGRN,colourBLU,al)\ntpt.drawline(613,215,627,215,colourRED,colourGRN,colourBLU,al)\ntpt.drawline(613,231,627,231,colourRED,colourGRN,colourBLU,al)\ntpt.drawline(613,247,627,247,colourRED,colourGRN,colourBLU,al)\ntpt.drawline(613,263,627,263,colourRED,colourGRN,colourBLU,al)\ntpt.drawline(613,279,627,279,colourRED,colourGRN,colourBLU,al)\ntpt.drawline(613,295,627,295,colourRED,colourGRN,colourBLU,al)\ntpt.drawline(613,311,627,311,colourRED,colourGRN,colourBLU,al)\ntpt.drawline(613,327,627,327,colourRED,colourGRN,colourBLU,al)\ntpt.drawline(613,343,627,343,colourRED,colourGRN,colourBLU,al)\ntpt.drawline(613,359,627,359,colourRED,colourGRN,colourBLU,al)\ntpt.drawline(613,375,627,375,colourRED,colourGRN,colourBLU,al)\ntpt.drawline(613,391,627,391,colourRED,colourGRN,colourBLU,al)\nend\n\nfunction mpnolag()\nevent.unregister(event.tick,topbar)\nevent.unregister(event.tick,theme)\nevent.register(event.tick,theme)\nevent.register(event.tick,topbar)\nevent.unregister(event.tick,colourblender)\nend\n\nmp:action(function(sender)\nclearsb()\nfs.makeDirectory(\"scripts\")\nnewmenu:onDraw(theme)\nnewmenu:addComponent(mp1)\nnewmenu:addComponent(mp2)\nnewmenu:addComponent(mp3)\nnewmenu:addComponent(mp4)\nnewmenu:addComponent(mp5)\nnewmenu:addComponent(mp6)\nnewmenu:addComponent(mp7)\nnewmenu:addComponent(mp8)\nnewmenu:addComponent(mp9)\nend)\n\nmp1:action(function(sender)\nMANAGER.savesetting(\"CRK\",\"savergb\",2)\nMANAGER.savesetting(\"CRK\",\"ar\",70)\nMANAGER.savesetting(\"CRK\",\"ag\",70)\nMANAGER.savesetting(\"CRK\",\"ab\",70)\nMANAGER.savesetting(\"CRK\",\"al\",255)\nmpnolag()\nclearsb()\nend)\n\nmp2:action(function(sender)\nMANAGER.savesetting(\"CRK\",\"savergb\",2)\nMANAGER.savesetting(\"CRK\",\"ar\",255)\nMANAGER.savesetting(\"CRK\",\"ag\",0)\nMANAGER.savesetting(\"CRK\",\"ab\",0)\nMANAGER.savesetting(\"CRK\",\"al\",255)\nmpnolag()\nclearsb()\nend)\n\nmp3:action(function(sender)\nMANAGER.savesetting(\"CRK\",\"savergb\",2)\nMANAGER.savesetting(\"CRK\",\"ar\",0)\nMANAGER.savesetting(\"CRK\",\"ag\",0)\nMANAGER.savesetting(\"CRK\",\"ab\",255)\nMANAGER.savesetting(\"CRK\",\"al\",255)\nmpnolag()\nclearsb()\nend)\n\nmp4:action(function(sender)\nMANAGER.savesetting(\"CRK\",\"savergb\",2)\nMANAGER.savesetting(\"CRK\",\"ar\",0)\nMANAGER.savesetting(\"CRK\",\"ag\",255)\nMANAGER.savesetting(\"CRK\",\"ab\",0)\nMANAGER.savesetting(\"CRK\",\"al\",255)\nmpnolag()\nclearsb()\nend)\n\nmp5:action(function(sender)\nMANAGER.savesetting(\"CRK\",\"savergb\",2)\nMANAGER.savesetting(\"CRK\",\"ar\",255)\nMANAGER.savesetting(\"CRK\",\"ag\",255)\nMANAGER.savesetting(\"CRK\",\"ab\",0)\nMANAGER.savesetting(\"CRK\",\"al\",255)\nmpnolag()\nclearsb()\nend)\n\nmp6:action(function(sender)\nMANAGER.savesetting(\"CRK\",\"savergb\",2)\nMANAGER.savesetting(\"CRK\",\"ar\",255)\nMANAGER.savesetting(\"CRK\",\"ag\",150)\nMANAGER.savesetting(\"CRK\",\"ab\",0)\nMANAGER.savesetting(\"CRK\",\"al\",255)\nmpnolag()\nclearsb()\nend)\n\nmp7:action(function(sender)\nMANAGER.savesetting(\"CRK\",\"savergb\",2)\nMANAGER.savesetting(\"CRK\",\"ar\",255)\nMANAGER.savesetting(\"CRK\",\"ag\",255)\nMANAGER.savesetting(\"CRK\",\"ab\",255)\nMANAGER.savesetting(\"CRK\",\"al\",255)\nmpnolag()\nclearsb()\nend)\n\nmp8:action(function(sender)\nMANAGER.savesetting(\"CRK\",\"savergb\",1)\nevent.register(event.tick,colourblender)\nevent.unregister(event.tick,theme)\nclearsb()\nend)\n\nmp9:action(function(sender)\nmpnolag()\nMANAGER.savesetting(\"CRK\",\"savergb\",2)\nif MANAGER.getsetting(\"CRK\",\"ar\") == nil then\nMANAGER.savesetting(\"CRK\",\"ar\",70)\nend\nif MANAGER.getsetting(\"CRK\",\"ag\") == nil then\nMANAGER.savesetting(\"CRK\",\"ag\",70)\nend\nif MANAGER.getsetting(\"CRK\",\"ab\") == nil then\nMANAGER.savesetting(\"CRK\",\"ab\",70)\nend\n\nrlb:text(MANAGER.getsetting(\"CRK\", \"ar\"))\nglb:text(MANAGER.getsetting(\"CRK\", \"ag\"))\nblb:text(MANAGER.getsetting(\"CRK\", \"ab\"))\nrSlider:onValueChanged(function() rclr = rSlider:value() rlb:text(rclr) MANAGER.savesetting(\"CRK\",\"ar\", rSlider:value()) end)\ngSlider:onValueChanged(function() gclr = gSlider:value() glb:text(gclr) MANAGER.savesetting(\"CRK\",\"ag\",gSlider:value()) end)\nbSlider:onValueChanged(function() bclr = bSlider:value() blb:text(bclr) MANAGER.savesetting(\"CRK\",\"ab\",bSlider:value())  end)\nrSlider:value(MANAGER.getsetting(\"CRK\", \"ar\"))\ngSlider:value(MANAGER.getsetting(\"CRK\", \"ag\"))\nbSlider:value(MANAGER.getsetting(\"CRK\", \"ab\"))\nnewmenu:addComponent(rSlider)\nnewmenu:addComponent(gSlider)\nnewmenu:addComponent(bSlider)\nnewmenu:addComponent(rl)\nnewmenu:addComponent(gl)\nnewmenu:addComponent(bl)\nnewmenu:addComponent(rlb)\nnewmenu:addComponent(glb)\nnewmenu:addComponent(blb)\nnewmenu:addComponent(mpop)\n\nmpop:action(function(sender)\nnewmenu:removeComponent(rSlider)\nnewmenu:removeComponent(gSlider)\nnewmenu:removeComponent(bSlider)\nnewmenu:removeComponent(rl)\nnewmenu:removeComponent(gl)\nnewmenu:removeComponent(bl)\nnewmenu:removeComponent(rlb)\nnewmenu:removeComponent(glb)\nnewmenu:removeComponent(blb)\nnewmenu:removeComponent(mpop)\nclearsb()\nend)\nend)\n\nfunction topbar()\nif MANAGER.getsetting(\"CRK\", \"brightstate\") == \"1\" then\nal = brightSlider:value()\nelse\nal = 255\nend\nif MANAGER.getsetting(\"CRK\", \"savergb\") == \"2\" then\ntpt.drawline(1,0, 312,0, ar, ag, ab,al)\ntpt.drawline(338,0, 611,0, ar, ag, ab,al)\nelse\ntpt.drawline(1,0, 312,0, colourRED,colourGRN,colourBLU,al)\ntpt.drawline(338,0, 611,0, colourRED,colourGRN,colourBLU,al)\nend\nend\n\nbar:action(function(sender)\nclearsb()\nnewmenu:addComponent(bary)\nnewmenu:addComponent(barn)\nend)\n\nbary:action(function(sender)\nevent.unregister(event.tick,topbar)\nevent.register(event.tick,topbar)\nclearsb()\nend)\n\nbarn:action(function(sender)\nevent.unregister(event.tick,topbar)\nclearsb()\nend)\n\nfunction startupcheck()\ninterface.addComponent(toggle)\nif MANAGER.getsetting(\"CRK\", \"savergb\") == \"2\" then\nevent.register(event.tick,theme)\nevent.register(event.tick,topbar)\nelse\nevent.register(event.tick,colourblender)\nevent.register(event.tick,topbar)\nend\n\nif MANAGER.getsetting(\"CRK\", \"brightstate\") == \"1\" then\nbrightSlider:value(MANAGER.getsetting(\"CRK\", \"brightness\"))\nevent.register(event.tick,cbrightness)\nbrlabel:text(\"Turned: on\")\nelse\nMANAGER.savesetting(\"CRK\", \"brightness\",200)\nend\n\nif MANAGER.getsetting(\"CRK\", \"fanc\") == \"0\" then\nevent.unregister(event.tick,drawcirc)\nelse\nevent.register(event.tick,drawcirc)\nend\nend\n\nstartupcheck()\n\nRuler:action(function(sender)\nclearsb()\nnewmenu:addComponent(Ry)\nnewmenu:addComponent(Rn)\nend)\n\nRy:action(function(sender)\ntpt.setdebug(0X0)\nnewmenu:removeComponent(Ry)\nnewmenu:removeComponent(Rn)\nend)\n\nRn:action(function(sender)\ntpt.setdebug(0X4)\nnewmenu:removeComponent(Ry)\nnewmenu:removeComponent(Rn)\nend)\n\ndeletesparkButton:action(function(sender)\nclearsb()\ntpt.hud(0)\nnewmenu:addComponent(UIhidey)\nnewmenu:addComponent(UIhiden)\nend)\n\nfunction UIhide()\ntpt.hud(0)\ntpt.fillrect(-1,382,616,42,0,0,0,255)\ntpt.fillrect(612,0,17,424,0,0,0,255)\nend\n\nUIhidey:action(function(sender)\ntpt.hud(0)\nnewmenu:removeComponent(UIhiden)\nnewmenu:removeComponent(UIhidey)\nevent.unregister(event.tick,topbar)\nevent.unregister(event.tick,UIhide)\nevent.register(event.tick,UIhide)\nend)\n\nUIhiden:action(function(sender)\ntpt.hud(1)\nnewmenu:removeComponent(UIhiden)\nnewmenu:removeComponent(UIhidey)\nevent.unregister(event.tick,UIhide)\nevent.register(event.tick,topbar)\nend)\n\nFPS:action(function(sender)\nclearsb()\nnewmenu:addComponent(FPS1)\nnewmenu:addComponent(FPS2)\nend)\n\n\nFPS1:action(function(sender)\nnewmenu:removeComponent(FPS1)\nnewmenu:removeComponent(FPS2)\ntpt.setfpscap(60)\nend)\n\nFPS2:action(function(sender)\nnewmenu:removeComponent(FPS1)\nnewmenu:removeComponent(FPS2)\ntpt.setfpscap(2)\nend)\n\nreset:action(function(sender)\nevent.register(event.tick,drawcirc)\nevent.unregister(event.tick,remindme)\nevent.unregister(event.tick,backg)\nevent.unregister(event.tick,cbrightness)\nevent.unregister(event.tick,UIhide)\nevent.unregister(event.tick,autohidehud)\nevent.register(event.tick,colourblender)\nevent.register(event.tick,topbar)\nnewmenu:removeComponent(remlabel)\nbrlabel:text(\"Turned: off\")\nbrightSlider:value(\"200\")\nMANAGER.savesetting(\"CRK\", \"fanc\",\"0\")\nMANAGER.savesetting(\"CRK\", \"brightstate\", \"0\")\nMANAGER.savesetting(\"CRK\",\"savergb\",1)\ntpt.hud(1)\nui.closeWindow(newmenu) \ntpt.el.dyst.menu=0\ntpt.el.eqve.menu=0\ntpt.el.shd4.menu=0\ntpt.el.shd3.menu=0\ntpt.el.shd2.menu=0\ntpt.el.lolz.menu=0\ntpt.el.love.menu=0\ntpt.el.embr.menu=0\ntpt.el.spwn.menu=0\ntpt.el.spwn2.menu=0\ntpt.el.frzw.menu=0\ntpt.el.bizs.menu=0\ntpt.el.bizg.menu=0\ntpt.el.bray.menu=0\ntpt.el.psts.menu=0\ntpt.el.mort.menu=0\ntpt.display_mode(3)\ntpt.watertest(0)\nsim.edgeMode(0) \ntpt.setfpscap(60)\ntpt.setwindowsize(1)\ntpt.newtonian_gravity(0)\ntpt.decorations_enable(0)\nsim.resetPressure()\ntpt.ambient_heat(0)\nsim.resetTemp()\ntpt.reset_velocity(1,380,300,300)\nclearsb()\ntpt.setdebug(0X0)\nsim.clearSim()\nend)\n\nfunction close()\nui.closeWindow(newmenu) \nclearsb()\nclearm()\nend\n\nfunction drawglitch()\ngraphics.drawLine(7, 18,314,18,ar,ag,ab,240)\nend\n\nfunction open()\nui.showWindow(newmenu) \nnewmenu:onDraw(drawglitch)\nnewmenu:onTryExit(close)\nnewmenu:addComponent(deletesparkButton)\nnewmenu:addComponent(FPS)\nnewmenu:addComponent(info)\nnewmenu:addComponent(reset)\nnewmenu:addComponent(hide)\nnewmenu:addComponent(Ruler)\nnewmenu:addComponent(rc)\nnewmenu:addComponent(bg)\nnewmenu:addComponent(mp)\nnewmenu:addComponent(bug)\nnewmenu:addComponent(bar)\nnewmenu:addComponent(bare)\nnewmenu:addComponent(wiki)\nnewmenu:addComponent(autohide)\nnewmenu:addComponent(chud)\nnewmenu:addComponent(brightness)\nnewmenu:addComponent(reminder)\nnewmenu:addComponent(fancur)\nend\n\nhide:action(function(sender)\nclose()\nend)\n\nfunction keyclicky(key)\nif (key ==\"j\") and TPTMP.chatHidden == true then \nopen()\nend\nend\ntpt.register_keypress(keyclicky) \n\ntoggle:action(function(sender)\nopen()\nend)\n\n--fontstart\nfonts ={}\nfonts['5x7'] = {}\nfonts['5x7']['width'] = 5\nfonts['5x7']['height'] = 7\nfonts['5x7']['linespacing'] = 4\nfonts['5x7']['charspacing'] = 1\nfonts['5x7']['a'] = {\n        ['descender'] = 0,\n        ['kerning'] = 0,\n        ['pixels']  = {\n                {0, 0, 0, 0, 0},\n                {0, 0, 0, 0, 0},\n                {0, 1, 1, 1, 0},\n                {0, 0, 0, 0, 1},\n                {0, 1, 1, 1, 1},\n                {1, 0, 0, 0, 1},\n                {0, 1, 1, 1, 1}\n        }\n}\nfonts['5x7']['b'] = {\n        ['descender'] = 0,\n        ['kerning'] = 0,\n        ['pixels']  = {\n                {1, 0, 0, 0, 0},\n                {1, 0, 0, 0, 0},\n                {1, 1, 1, 1, 0},\n                {1, 0, 0, 0, 1},\n                {1, 0, 0, 0, 1},\n                {1, 0, 0, 0, 1},\n                {1, 1, 1, 1, 0},\n                {0, 0, 0, 0, 0},\n                {0, 0, 0, 0, 0}\n        }\n}\nfonts['5x7']['c'] = {\n        ['descender'] = 0,\n        ['kerning'] = 0,\n        ['pixels']  = {\n                {0, 0, 0, 0, 0},\n                {0, 0, 0, 0, 0},\n                {0, 1, 1, 1, 0},\n                {1, 0, 0, 0, 1},\n                {1, 0, 0, 0, 0},\n                {1, 0, 0, 0, 1},\n                {0, 1, 1, 1, 0},\n                {0, 0, 0, 0, 0},\n                {0, 0, 0, 0, 0}\n        }\n}\nfonts['5x7']['d'] = {\n        ['descender'] = 0,\n        ['kerning'] = 0,\n        ['pixels']  = {\n                {0, 0, 0, 0, 1},\n                {0, 0, 0, 0, 1},\n                {0, 1, 1, 1, 1},\n                {1, 0, 0, 0, 1},\n                {1, 0, 0, 0, 1},\n                {1, 0, 0, 0, 1},\n                {0, 1, 1, 1, 1},\n                {0, 0, 0, 0, 0},\n                {0, 0, 0, 0, 0}\n        }\n}\nfonts['5x7']['e'] = {\n        ['descender'] = 0,\n        ['kerning'] = 0,\n        ['pixels']  = {\n                {0, 0, 0, 0, 0},\n                {0, 0, 0, 0, 0},\n                {0, 1, 1, 1, 0},\n                {1, 0, 0, 0, 1},\n                {1, 1, 1, 1, 0},\n                {1, 0, 0, 0, 0},\n                {0, 1, 1, 1, 0},\n                {0, 0, 0, 0, 0},\n                {0, 0, 0, 0, 0}\n        }\n}\nfonts['5x7']['f'] = {\n        ['descender'] = 0,\n        ['kerning'] = -1,\n        ['pixels']  = {\n                {0, 0, 1, 1, 0},\n                {0, 1, 0, 0, 0},\n                {0, 1, 0, 0, 0},\n                {1, 1, 1, 1, 0},\n                {0, 1, 0, 0, 0},\n                {0, 1, 0, 0, 0},\n                {0, 1, 0, 0, 0},\n                {0, 0, 0, 0, 0},\n                {0, 0, 0, 0, 0}\n        }\n}\nfonts['5x7']['g'] = {\n        ['descender'] = -2,\n        ['kerning'] = 0,\n        ['pixels']  = {\n                {0, 0, 0, 0, 0},\n                {0, 0, 0, 0, 0},\n                {0, 1, 1, 1, 1},\n                {1, 0, 0, 0, 1},\n                {1, 0, 0, 0, 1},\n                {1, 0, 0, 0, 1},\n                {0, 1, 1, 1, 1},\n                {0, 0, 0, 0, 1},\n                {0, 1, 1, 1, 0}\n        }\n}\nfonts['5x7']['h'] = {\n        ['descender'] = 0,\n        ['kerning'] = 0,\n        ['pixels']  = {\n                {1, 0, 0, 0, 0},\n                {1, 0, 0, 0, 0},\n                {1, 1, 1, 1, 0},\n                {1, 0, 0, 0, 1},\n                {1, 0, 0, 0, 1},\n                {1, 0, 0, 0, 1},\n                {1, 0, 0, 0, 1},\n                {0, 0, 0, 0, 0},\n                {0, 0, 0, 0, 0}\n        }\n}\nfonts['5x7']['i'] = {\n        ['descender'] = 0,\n        ['kerning'] = -4,\n        ['pixels']  = {\n                {1, 0, 0, 0, 0},\n                {0, 0, 0, 0, 0},\n                {1, 0, 0, 0, 0},\n                {1, 0, 0, 0, 0},\n                {1, 0, 0, 0, 0},\n                {1, 0, 0, 0, 0},\n                {1, 0, 0, 0, 0},\n                {0, 0, 0, 0, 0},\n                {0, 0, 0, 0, 0}\n        }\n}\nfonts['5x7']['j'] = {\n        ['descender'] = -2,\n        ['kerning'] = -3,\n        ['pixels']  = {\n                {0, 1, 0, 0, 0},\n                {0, 0, 0, 0, 0},\n                {0, 1, 0, 0, 0},\n                {0, 1, 0, 0, 0},\n                {0, 1, 0, 0, 0},\n                {0, 1, 0, 0, 0},\n                {0, 1, 0, 0, 0},\n                {0, 1, 0, 0, 0},\n                {1, 0, 0, 0, 0}\n        }\n}\nfonts['5x7']['k'] = {\n        ['descender'] = 0,\n        ['kerning'] = -1,\n        ['pixels']  = {\n                {1, 0, 0, 0, 0},\n                {1, 0, 0, 0, 0},\n                {1, 0, 0, 1, 0},\n                {1, 0, 1, 0, 0},\n                {1, 1, 0, 0, 0},\n                {1, 0, 1, 0, 0},\n                {1, 0, 0, 1, 0},\n                {0, 0, 0, 0, 0},\n                {0, 0, 0, 0, 0}\n        }\n}\nfonts['5x7']['l'] = {\n        ['descender'] = 0,\n        ['kerning'] = -3,\n        ['pixels']  = {\n                {1, 0, 0, 0, 0},\n                {1, 0, 0, 0, 0},\n                {1, 0, 0, 0, 0},\n                {1, 0, 0, 0, 0},\n                {1, 0, 0, 0, 0},\n                {1, 0, 0, 0, 0},\n                {0, 1, 0, 0, 0},\n                {0, 0, 0, 0, 0},\n                {0, 0, 0, 0, 0}\n        }\n}\nfonts['5x7']['m'] = {\n        ['descender'] = 0,\n        ['kerning'] = 0,\n        ['pixels']  = {\n                {0, 0, 0, 0, 0},\n                {0, 0, 0, 0, 0},\n                {1, 1, 0, 1, 0},\n                {1, 0, 1, 0, 1},\n                {1, 0, 1, 0, 1},\n                {1, 0, 1, 0, 1},\n                {1, 0, 1, 0, 1},\n                {0, 0, 0, 0, 0},\n                {0, 0, 0, 0, 0}\n        }\n}\nfonts['5x7']['n'] = {\n        ['descender'] = 0,\n        ['kerning'] = 0,\n        ['pixels']  = {\n                {0, 0, 0, 0, 0},\n                {0, 0, 0, 0, 0},\n                {1, 0, 1, 1, 0},\n                {1, 1, 0, 0, 1},\n                {1, 0, 0, 0, 1},\n                {1, 0, 0, 0, 1},\n                {1, 0, 0, 0, 1},\n                {0, 0, 0, 0, 0},\n                {0, 0, 0, 0, 0}\n        }\n}\nfonts['5x7']['o'] = {\n        ['descender'] = 0,\n        ['kerning'] = 0,\n        ['pixels']  = {\n                {0, 0, 0, 0, 0},\n                {0, 0, 0, 0, 0},\n                {0, 1, 1, 1, 0},\n                {1, 0, 0, 0, 1},\n                {1, 0, 0, 0, 1},\n                {1, 0, 0, 0, 1},\n                {0, 1, 1, 1, 0},\n                {0, 0, 0, 0, 0},\n                {0, 0, 0, 0, 0}\n        }\n}\nfonts['5x7']['p'] = {\n        ['descender'] = -2,\n        ['kerning'] = 0,\n        ['pixels']  = {\n                {0, 0, 0, 0, 0},\n                {0, 0, 0, 0, 0},\n                {1, 1, 1, 1, 0},\n                {1, 0, 0, 0, 1},\n                {1, 0, 0, 0, 1},\n                {1, 0, 0, 0, 1},\n                {1, 1, 1, 1, 0},\n                {1, 0, 0, 0, 0},\n                {1, 0, 0, 0, 0}\n        }\n}\nfonts['5x7']['q'] = {\n        ['descender'] = -2,\n        ['kerning'] = 0,\n        ['pixels']  = {\n                {0, 0, 0, 0, 0},\n                {0, 0, 0, 0, 0},\n                {0, 1, 1, 1, 1},\n                {1, 0, 0, 0, 1},\n                {1, 0, 0, 0, 1},\n                {1, 0, 0, 0, 1},\n                {0, 1, 1, 1, 1},\n                {0, 0, 0, 0, 1},\n                {0, 0, 0, 0, 1}\n        }\n}\nfonts['5x7']['r'] = {\n        ['descender'] = 0,\n        ['kerning'] = 0,\n        ['pixels']  = {\n                {0, 0, 0, 0, 0},\n                {0, 0, 0, 0, 0},\n                {1, 0, 1, 1, 0},\n                {1, 1, 0, 0, 1},\n                {1, 0, 0, 0, 0},\n                {1, 0, 0, 0, 0},\n                {1, 0, 0, 0, 0},\n                {0, 0, 0, 0, 0},\n                {0, 0, 0, 0, 0}\n        }\n}\nfonts['5x7']['s'] = {\n        ['descender'] = 0,\n        ['kerning'] = 0,\n        ['pixels']  = {\n                {0, 0, 0, 0, 0},\n                {0, 0, 0, 0, 0},\n                {0, 1, 1, 1, 1},\n                {1, 0, 0, 0, 0},\n                {0, 1, 1, 1, 0},\n                {0, 0, 0, 0, 1},\n                {1, 1, 1, 1, 0},\n                {0, 0, 0, 0, 0},\n                {0, 0, 0, 0, 0}\n        }\n}\nfonts['5x7']['t'] = {\n        ['descender'] = 0,\n        ['kerning'] = -2,\n        ['pixels']  = {\n                {1, 0, 0, 0, 0},\n                {1, 0, 0, 0, 0},\n                {1, 1, 1, 0, 0},\n                {1, 0, 0, 0, 0},\n                {1, 0, 0, 0, 0},\n                {1, 0, 0, 0, 0},\n                {0, 1, 1, 0, 0},\n                {0, 0, 0, 0, 0},\n                {0, 0, 0, 0, 0}\n        }\n}\nfonts['5x7']['u'] = {\n        ['descender'] = 0,\n        ['kerning'] = 0,\n        ['pixels']  = {\n                {0, 0, 0, 0, 0},\n                {0, 0, 0, 0, 0},\n                {1, 0, 0, 0, 1},\n                {1, 0, 0, 0, 1},\n                {1, 0, 0, 0, 1},\n                {1, 0, 0, 0, 1},\n                {0, 1, 1, 1, 1},\n                {0, 0, 0, 0, 0},\n                {0, 0, 0, 0, 0}\n        }\n}\nfonts['5x7']['v'] = {\n        ['descender'] = 0,\n        ['kerning'] = 0,\n        ['pixels']  = {\n                {0, 0, 0, 0, 0},\n                {0, 0, 0, 0, 0},\n                {1, 0, 0, 0, 1},\n                {1, 0, 0, 0, 1},\n                {0, 1, 0, 1, 0},\n                {0, 1, 0, 1, 0},\n                {0, 0, 1, 0, 0},\n                {0, 0, 0, 0, 0},\n                {0, 0, 0, 0, 0}\n        }\n}\nfonts['5x7']['w'] = {\n        ['descender'] = 0,\n        ['kerning'] = 0,\n        ['pixels']  = {\n                {0, 0, 0, 0, 0},\n                {0, 0, 0, 0, 0},\n                {1, 0, 0, 0, 1},\n                {1, 0, 1, 0, 1},\n                {1, 0, 1, 0, 1},\n                {1, 0, 1, 0, 1},\n                {0, 1, 0, 1, 0},\n                {0, 0, 0, 0, 0},\n                {0, 0, 0, 0, 0}\n        }\n}\nfonts['5x7']['x'] = {\n        ['descender'] = 0,\n        ['kerning'] = -1,\n        ['pixels']  = {\n                {0, 0, 0, 0, 0},\n                {0, 0, 0, 0, 0},\n                {1, 0, 0, 1, 0},\n                {1, 0, 0, 1, 0},\n                {0, 1, 1, 0, 0},\n                {1, 0, 0, 1, 0},\n                {1, 0, 0, 1, 0},\n                {0, 0, 0, 0, 0},\n                {0, 0, 0, 0, 0}\n        }\n}\nfonts['5x7']['y'] = {\n        ['descender'] = -2,\n        ['kerning'] = 0,\n        ['pixels']  = {\n                {0, 0, 0, 0, 0},\n                {0, 0, 0, 0, 0},\n                {1, 0, 0, 0, 1},\n                {1, 0, 0, 0, 1},\n                {0, 1, 0, 1, 0},\n                {0, 1, 0, 1, 0},\n                {0, 0, 1, 0, 0},\n                {0, 0, 1, 0, 0},\n                {1, 1, 0, 0, 0}\n        }\n}\nfonts['5x7']['z'] = {\n        ['descender'] = 0,\n        ['kerning'] = 0,\n        ['pixels']  = {\n                {0, 0, 0, 0, 0},\n                {0, 0, 0, 0, 0},\n                {1, 1, 1, 1, 1},\n                {0, 0, 0, 1, 0},\n                {0, 0, 1, 0, 0},\n                {0, 1, 0, 0, 0},\n                {1, 1, 1, 1, 1},\n                {0, 0, 0, 0, 0},\n                {0, 0, 0, 0, 0}\n        }\n}\nfonts['5x7'][' '] = {\n        ['descender'] = 0,\n        ['kerning'] = -4,\n        ['pixels']  = {\n                {0, 0, 0, 0, 0},\n                {0, 0, 0, 0, 0},\n                {0, 0, 0, 0, 0},\n                {0, 0, 0, 0, 0},\n                {0, 0, 0, 0, 0},\n                {0, 0, 0, 0, 0},\n                {0, 0, 0, 0, 0},\n                {0, 0, 0, 0, 0},\n                {0, 0, 0, 0, 0}\n        }\n}\n\n\nfonts['5x7']['0'] = {\n        ['descender'] = 0,\n        ['kerning'] = 0,\n        ['pixels']  = {\n                {0, 1, 1, 1, 0},\n                {1, 0, 0, 0, 1},\n                {1, 0, 0, 1, 1},\n                {1, 0, 1, 0, 1},\n                {1, 1, 0, 0, 1},\n                {1, 0, 0, 0, 1},\n                {0, 1, 1, 1, 0},\n                {0, 0, 0, 0, 0},\n                {0, 0, 0, 0, 0}\n        }\n}\nfonts['5x7']['1'] = {\n        ['descender'] = 0,\n        ['kerning'] = -3,\n        ['pixels']  = {\n                {0, 1, 0, 0, 0},\n                {1, 1, 0, 0, 0},\n                {0, 1, 0, 0, 0},\n                {0, 1, 0, 0, 0},\n                {0, 1, 0, 0, 0},\n                {0, 1, 0, 0, 0},\n                {0, 1, 0, 0, 0},\n                {0, 0, 0, 0, 0},\n                {0, 0, 0, 0, 0}\n        }\n}\nfonts['5x7']['2'] = {\n        ['descender'] = 0,\n        ['kerning'] = 0,\n        ['pixels']  = {\n                {0, 1, 1, 1, 0},\n                {1, 0, 0, 0, 1},\n                {0, 0, 0, 0, 1},\n                {0, 0, 0, 1, 0},\n                {0, 0, 1, 0, 0},\n                {0, 1, 0, 0, 0},\n                {1, 1, 1, 1, 1},\n                {0, 0, 0, 0, 0},\n                {0, 0, 0, 0, 0}\n        }\n}\nfonts['5x7']['3'] = {\n        ['descender'] = 0,\n        ['kerning'] = 0,\n        ['pixels']  = {\n                {1, 1, 1, 1, 1},\n                {0, 0, 0, 1, 0},\n                {0, 0, 1, 0, 0},\n                {0, 1, 1, 1, 0},\n                {0, 0, 0, 0, 1},\n                {1, 0, 0, 0, 1},\n                {0, 1, 1, 1, 0},\n                {0, 0, 0, 0, 0},\n                {0, 0, 0, 0, 0}\n        }\n}\nfonts['5x7']['4'] = {\n        ['descender'] = 0,\n        ['kerning'] = 0,\n        ['pixels']  = {\n                {0, 0, 0, 0, 1},\n                {0, 0, 0, 1, 1},\n                {0, 0, 1, 0, 1},\n                {0, 1, 0, 0, 1},\n                {1, 1, 1, 1, 1},\n                {0, 0, 0, 0, 1},\n                {0, 0, 0, 0, 1},\n                {0, 0, 0, 0, 0},\n                {0, 0, 0, 0, 0}\n        }\n}\nfonts['5x7']['5'] = {\n        ['descender'] = 0,\n        ['kerning'] = 0,\n        ['pixels']  = {\n                {1, 1, 1, 1, 1},\n                {1, 0, 0, 0, 0},\n                {1, 0, 0, 0, 0},\n                {1, 1, 1, 1, 0},\n                {0, 0, 0, 0, 1},\n                {1, 0, 0, 0, 1},\n                {0, 1, 1, 1, 0},\n                {0, 0, 0, 0, 0},\n                {0, 0, 0, 0, 0}\n        }\n}\nfonts['5x7']['6'] = {\n        ['descender'] = 0,\n        ['kerning'] = 0,\n        ['pixels']  = {\n                {0, 0, 1, 1, 0},\n                {0, 1, 0, 0, 0},\n                {1, 0, 0, 0, 0},\n                {1, 1, 1, 1, 0},\n                {1, 0, 0, 0, 1},\n                {1, 0, 0, 0, 1},\n                {0, 1, 1, 1, 0},\n                {0, 0, 0, 0, 0},\n                {0, 0, 0, 0, 0}\n        }\n}\nfonts['5x7']['7'] = {\n        ['descender'] = 0,\n        ['kerning'] = -1,\n        ['pixels']  = {\n                {1, 1, 1, 1, 0},\n                {0, 0, 0, 1, 0},\n                {0, 0, 1, 0, 0},\n                {0, 0, 1, 0, 0},\n                {0, 1, 0, 0, 0},\n                {0, 1, 0, 0, 0},\n                {0, 1, 0, 0, 0},\n                {0, 0, 0, 0, 0},\n                {0, 0, 0, 0, 0}\n        }\n}\nfonts['5x7']['8'] = {\n        ['descender'] = 0,\n        ['kerning'] = 0,\n        ['pixels']  = {\n                {0, 1, 1, 1, 0},\n                {1, 0, 0, 0, 1},\n                {1, 0, 0, 0, 1},\n                {0, 1, 1, 1, 0},\n                {1, 0, 0, 0, 1},\n                {1, 0, 0, 0, 1},\n                {0, 1, 1, 1, 0},\n                {0, 0, 0, 0, 0},\n                {0, 0, 0, 0, 0}\n        }\n}\nfonts['5x7']['9'] = {\n        ['descender'] = 0,\n        ['kerning'] = 0,\n        ['pixels']  = {\n                {0, 1, 1, 1, 0},\n                {1, 0, 0, 0, 1},\n                {1, 0, 0, 0, 1},\n                {0, 1, 1, 1, 1},\n                {0, 0, 0, 0, 1},\n                {0, 0, 0, 1, 0},\n                {0, 1, 1, 0, 0},\n                {0, 0, 0, 0, 0},\n                {0, 0, 0, 0, 0}\n        }\n}\n\nfonts['5x7']['.'] = {\n        ['descender'] = 0,\n        ['kerning'] = -4,\n        ['pixels']  = {\n                {0, 0, 0, 0, 0},\n                {0, 0, 0, 0, 0},\n                {0, 0, 0, 0, 0},\n                {0, 0, 0, 0, 0},\n                {0, 0, 0, 0, 0},\n                {0, 0, 0, 0, 0},\n                {1, 0, 0, 0, 0},\n                {0, 0, 0, 0, 0},\n                {0, 0, 0, 0, 0}\n        }\n}\n\nfonts['5x7']['<'] = {\n        ['descender'] = 0,\n        ['kerning'] = -2,\n        ['pixels']  = {\n                {0, 0, 0, 0, 0},\n                {0, 0, 0, 0, 0},\n                {0, 0, 1, 0, 0},\n                {0, 1, 0, 0, 0},\n                {1, 0, 0, 0, 0},\n                {0, 1, 0, 0, 0},\n                {0, 0, 1, 0, 0},\n                {0, 0, 0, 0, 0},\n                {0, 0, 0, 0, 0}\n        }\n}\n\nfonts['5x7']['>'] = {\n        ['descender'] = 0,\n        ['kerning'] = -2,\n        ['pixels']  = {\n                {0, 0, 0, 0, 0},\n                {0, 0, 0, 0, 0},\n                {1, 0, 0, 0, 0},\n                {0, 1, 0, 0, 0},\n                {0, 0, 1, 0, 0},\n                {0, 1, 0, 0, 0},\n                {1, 0, 0, 0, 0},\n                {0, 0, 0, 0, 0},\n                {0, 0, 0, 0, 0}\n        }\n}\n\nfonts['5x7']['@'] = {\n        ['descender'] = -2,\n        ['kerning'] = 0,\n        ['pixels']  = {\n                {0, 1, 1, 1, 0},\n                {1, 0, 0, 0, 1},\n                {1, 0, 0, 0, 1},\n                {1, 1, 0, 0, 1},\n                {1, 0, 1, 0, 1},\n                {1, 1, 0, 0, 1},\n                {0, 0, 0, 0, 1},\n                {1, 0, 0, 0, 1},\n                {0, 1, 1, 1, 0}\n        }\n}\n\nfonts['5x7']['#'] = {\n        ['descender'] = 0,\n        ['kerning'] = 0,\n        ['pixels']  = {\n                {0, 1, 0, 1, 0},\n                {1, 1, 1, 1, 1},\n                {0, 1, 0, 1, 0},\n                {1, 1, 1, 1, 1},\n                {0, 1, 0, 1, 0},\n                {0, 0, 0, 0, 0},\n                {0, 0, 0, 0, 0},\n                {0, 0, 0, 0, 0},\n                {0, 0, 0, 0, 0}\n        }\n}\n\nfonts['5x7']['$'] = {\n        ['descender'] = -2,\n        ['kerning'] = 0,\n        ['pixels']  = {\n                {0, 0, 1, 0, 0},\n                {0, 1, 1, 1, 0},\n                {1, 0, 1, 0, 1},\n                {1, 0, 1, 0, 0},\n                {0, 1, 1, 1, 0},\n                {0, 0, 1, 0, 1},\n                {1, 0, 1, 0, 1},\n                {0, 1, 1, 1, 0},\n                {0, 0, 1, 0, 0}\n        }\n}\n\nfonts['5x7']['%'] = {\n        ['descender'] = -1,\n        ['kerning'] = 0,\n        ['pixels']  = {\n                {0, 0, 0, 0, 0},\n                {1, 1, 0, 0, 1},\n                {1, 1, 0, 0, 1},\n                {0, 0, 0, 1, 0},\n                {0, 0, 1, 0, 0},\n                {0, 1, 0, 0, 0},\n                {1, 0, 0, 1, 1},\n                {1, 0, 0, 1, 1},\n                {0, 0, 0, 0, 0}\n        }\n}\n\nfonts['5x7']['^'] = {\n        ['descender'] = 0,\n        ['kerning'] = 0,\n        ['pixels']  = {\n                {0, 0, 1, 0, 0},\n                {0, 1, 0, 1, 0},\n                {1, 0, 0, 0, 1},\n                {0, 0, 0, 0, 0},\n                {0, 0, 0, 0, 0},\n                {0, 0, 0, 0, 0},\n                {0, 0, 0, 0, 0},\n                {0, 0, 0, 0, 0},\n                {0, 0, 0, 0, 0}\n        }\n}\n\nfonts['5x7']['{'] = {\n        ['descender'] = -2,\n        ['kerning'] = -2,\n        ['pixels']  = {\n                {0, 0, 1, 0, 0},\n                {0, 1, 0, 0, 0},\n                {0, 1, 0, 0, 0},\n                {0, 1, 0, 0, 0},\n                {1, 0, 0, 0, 0},\n                {0, 1, 0, 0, 0},\n                {0, 1, 0, 0, 0},\n                {0, 1, 0, 0, 0},\n                {0, 0, 1, 0, 0}\n        }\n}\n\nfonts['5x7']['}'] = {\n        ['descender'] = -2,\n        ['kerning'] = -2,\n        ['pixels']  = {\n                {1, 0, 0, 0, 0},\n                {0, 1, 0, 0, 0},\n                {0, 1, 0, 0, 0},\n                {0, 1, 0, 0, 0},\n                {0, 0, 1, 0, 0},\n                {0, 1, 0, 0, 0},\n                {0, 1, 0, 0, 0},\n                {0, 1, 0, 0, 0},\n                {1, 0, 0, 0, 0}\n        }\n}\n\nfonts['5x7']['&'] = {\n        ['descender'] = 0,\n        ['kerning'] = 0,\n        ['pixels']  = {\n                {0, 1, 1, 0, 0},\n                {1, 0, 0, 0, 0},\n                {1, 0, 0, 0, 0},\n                {0, 1, 0, 0, 0},\n                {1, 0, 1, 0, 1},\n                {1, 0, 0, 1, 0},\n                {0, 1, 1, 0, 1},\n                {0, 0, 0, 0, 0},\n                {0, 0, 0, 0, 0}\n        }\n}\n\nfonts['5x7']['*'] = {\n        ['descender'] = 0,\n        ['kerning'] = 0,\n        ['pixels']  = {\n                {0, 0, 0, 0, 0},\n                {0, 0, 1, 0, 0},\n                {1, 0, 1, 0, 1},\n                {0, 1, 1, 1, 0},\n                {1, 0, 1, 0, 1},\n                {0, 0, 1, 0, 0},\n                {0, 0, 0, 0, 0},\n                {0, 0, 0, 0, 0},\n                {0, 0, 0, 0, 0}\n        }\n}\n\nfonts['5x7']['('] = {\n        ['descender'] = -2,\n        ['kerning'] = -2,\n        ['pixels']  = {\n                {0, 0, 1, 0, 0},\n                {0, 1, 0, 0, 0},\n                {0, 1, 0, 0, 0},\n                {1, 0, 0, 0, 0},\n                {1, 0, 0, 0, 0},\n                {1, 0, 0, 0, 0},\n                {0, 1, 0, 0, 0},\n                {0, 1, 0, 0, 0},\n                {0, 0, 1, 0, 0}\n        }\n}\n\nfonts['5x7'][')'] = {\n        ['descender'] = -2,\n        ['kerning'] = -2,\n        ['pixels']  = {\n                {1, 0, 0, 0, 0},\n                {0, 1, 0, 0, 0},\n                {0, 1, 0, 0, 0},\n                {0, 0, 1, 0, 0},\n                {0, 0, 1, 0, 0},\n                {0, 0, 1, 0, 0},\n                {0, 1, 0, 0, 0},\n                {0, 1, 0, 0, 0},\n                {1, 0, 0, 0, 0}\n        }\n}\n\nfonts['5x7']['='] = {\n        ['descender'] = 0,\n        ['kerning'] = -1,\n        ['pixels']  = {\n                {0, 0, 0, 0, 0},\n                {0, 0, 0, 0, 0},\n                {0, 0, 0, 0, 0},\n                {1, 1, 1, 0, 0},\n                {0, 0, 0, 0, 0},\n                {1, 1, 1, 0, 0},\n                {0, 0, 0, 0, 0},\n                {0, 0, 0, 0, 0},\n                {0, 0, 0, 0, 0}\n        }\n}\n\nfonts['5x7']['['] = {\n        ['descender'] = -2,\n        ['kerning'] = -3,\n        ['pixels']  = {\n                {1, 1, 0, 0, 0},\n                {1, 0, 0, 0, 0},\n                {1, 0, 0, 0, 0},\n                {1, 0, 0, 0, 0},\n                {1, 0, 0, 0, 0},\n                {1, 0, 0, 0, 0},\n                {1, 0, 0, 0, 0},\n                {1, 0, 0, 0, 0},\n                {1, 1, 0, 0, 0}\n        }\n}\n\nfonts['5x7'][']'] = {\n        ['descender'] = -2,\n        ['kerning'] = -3,\n        ['pixels']  = {\n                {1, 1, 0, 0, 0},\n                {0, 1, 0, 0, 0},\n                {0, 1, 0, 0, 0},\n                {0, 1, 0, 0, 0},\n                {0, 1, 0, 0, 0},\n                {0, 1, 0, 0, 0},\n                {0, 1, 0, 0, 0},\n                {0, 1, 0, 0, 0},\n                {1, 1, 0, 0, 0}\n        }\n}\n\nfonts['5x7']['|'] = {\n        ['descender'] = -2,\n        ['kerning'] = -4,\n        ['pixels']  = {\n                {1, 0, 0, 0, 0},\n                {1, 0, 0, 0, 0},\n                {1, 0, 0, 0, 0},\n                {1, 0, 0, 0, 0},\n                {1, 0, 0, 0, 0},\n                {1, 0, 0, 0, 0},\n                {1, 0, 0, 0, 0},\n                {1, 0, 0, 0, 0},\n                {1, 0, 0, 0, 0}\n        }\n}\n\nfonts['5x7']['!'] = {\n        ['descender'] = 0,\n        ['kerning'] = -4,\n        ['pixels']  = {\n                {1, 0, 0, 0, 0},\n                {1, 0, 0, 0, 0},\n                {1, 0, 0, 0, 0},\n                {1, 0, 0, 0, 0},\n                {1, 0, 0, 0, 0},\n                {0, 0, 0, 0, 0},\n                {1, 0, 0, 0, 0},\n                {0, 0, 0, 0, 0},\n                {0, 0, 0, 0, 0}\n        }\n}\n\nfonts['5x7']['?'] = {\n        ['descender'] = 0,\n        ['kerning'] = 0,\n        ['pixels']  = {\n                {0, 1, 1, 1, 0},\n                {1, 0, 0, 0, 1},\n                {0, 0, 0, 0, 1},\n                {0, 0, 0, 1, 0},\n                {0, 0, 1, 0, 0},\n                {0, 0, 0, 0, 0},\n                {0, 0, 1, 0, 0},\n                {0, 0, 0, 0, 0},\n                {0, 0, 0, 0, 0}\n        }\n}\n\nfonts['5x7'][','] = {\n        ['descender'] = -1,\n        ['kerning'] = -4,\n        ['pixels']  = {\n                {0, 0, 0, 0, 0},\n                {0, 0, 0, 0, 0},\n                {0, 0, 0, 0, 0},\n                {0, 0, 0, 0, 0},\n                {0, 0, 0, 0, 0},\n                {0, 0, 0, 0, 0},\n                {1, 0, 0, 0, 0},\n                {1, 0, 0, 0, 0},\n                {0, 0, 0, 0, 0}\n        }\n}\n\nfonts['5x7'][':'] = {\n        ['descender'] = 0,\n        ['kerning'] = -4,\n        ['pixels']  = {\n                {0, 0, 0, 0, 0},\n                {0, 0, 0, 0, 0},\n                {0, 0, 0, 0, 0},\n                {1, 0, 0, 0, 0},\n                {0, 0, 0, 0, 0},\n                {1, 0, 0, 0, 0},\n                {0, 0, 0, 0, 0},\n                {0, 0, 0, 0, 0},\n                {0, 0, 0, 0, 0}\n        }\n}\n\nfonts['5x7'][';'] = {\n        ['descender'] = 0,\n        ['kerning'] = -4,\n        ['pixels']  = {\n                {0, 0, 0, 0, 0},\n                {0, 0, 0, 0, 0},\n                {0, 0, 0, 0, 0},\n                {1, 0, 0, 0, 0},\n                {0, 0, 0, 0, 0},\n                {1, 0, 0, 0, 0},\n                {1, 0, 0, 0, 0},\n                {0, 0, 0, 0, 0},\n                {0, 0, 0, 0, 0}\n        }\n}\n\nfonts['5x7']['+'] = {\n        ['descender'] = 0,\n        ['kerning'] = -2,\n        ['pixels']  = {\n                {0, 0, 0, 0, 0},\n                {0, 0, 0, 0, 0},\n                {0, 0, 0, 0, 0},\n                {0, 1, 0, 0, 0},\n                {1, 1, 1, 0, 0},\n                {0, 1, 0, 0, 0},\n                {0, 0, 0, 0, 0},\n                {0, 0, 0, 0, 0},\n                {0, 0, 0, 0, 0}\n        }\n}\n\nfonts['5x7']['-'] = {\n        ['descender'] = 0,\n        ['kerning'] = -2,\n        ['pixels']  = {\n                {0, 0, 0, 0, 0},\n                {0, 0, 0, 0, 0},\n                {0, 0, 0, 0, 0},\n                {0, 0, 0, 0, 0},\n                {1, 1, 1, 0, 0},\n                {0, 0, 0, 0, 0},\n                {0, 0, 0, 0, 0},\n                {0, 0, 0, 0, 0},\n                {0, 0, 0, 0, 0}\n        }\n}\n\nfonts['5x7']['_'] = {\n        ['descender'] = 0,\n        ['kerning'] = -2,\n        ['pixels']  = {\n                {0, 0, 0, 0, 0},\n                {0, 0, 0, 0, 0},\n                {0, 0, 0, 0, 0},\n                {0, 0, 0, 0, 0},\n                {0, 0, 0, 0, 0},\n                {0, 0, 0, 0, 0},\n                {1, 1, 1, 0, 0},\n                {0, 0, 0, 0, 0},\n                {0, 0, 0, 0, 0}\n        }\n}\n\nfonts['5x7']['/'] = {\n        ['descender'] = -2,\n        ['kerning'] = -2,\n        ['pixels']  = {\n                {0, 0, 1, 0, 0},\n                {0, 0, 1, 0, 0},\n                {0, 0, 1, 0, 0},\n                {0, 1, 0, 0, 0},\n                {0, 1, 0, 0, 0},\n                {0, 1, 0, 0, 0},\n                {1, 0, 0, 0, 0},\n                {1, 0, 0, 0, 0},\n                {1, 0, 0, 0, 0}\n        }\n}\n\nfonts['5x7']['NULL'] = {\n        ['descender'] = -2,\n        ['kerning'] = 0,\n        ['pixels']  = {\n                {1, 1, 1, 1, 1},\n                {1, 0, 0, 0, 1},\n                {1, 0, 0, 0, 1},\n                {1, 0, 0, 0, 1},\n                {1, 0, 0, 0, 1},\n                {1, 0, 0, 0, 1},\n                {1, 0, 0, 0, 1},\n                {1, 0, 0, 0, 1},\n                {1, 1, 1, 1, 1}\n        }\n}\n\n\nfonts['5x7']['A'] = {\n        ['descender'] = 0,\n        ['kerning'] = 0,\n        ['pixels']  = {\n                {0, 0, 1, 0, 0},\n                {0, 0, 1, 0, 0},\n                {0, 1, 0, 1, 0},\n                {0, 1, 0, 1, 0},\n                {0, 1, 1, 1, 0},\n                {1, 0, 0, 0, 1},\n                {1, 0, 0, 0, 1},\n                {0, 0, 0, 0, 0},\n                {0, 0, 0, 0, 0}\n        }\n}\nfonts['5x7']['B'] = {\n        ['descender'] = 0,\n        ['kerning'] = 0,\n        ['pixels']  = {\n                {1, 1, 1, 1, 0},\n                {1, 0, 0, 0, 1},\n                {1, 0, 0, 0, 1},\n                {1, 1, 1, 1, 0},\n                {1, 0, 0, 0, 1},\n                {1, 0, 0, 0, 1},\n                {1, 1, 1, 1, 0},\n                {0, 0, 0, 0, 0},\n                {0, 0, 0, 0, 0}\n        }\n}\nfonts['5x7']['C'] = {\n        ['descender'] = 0,\n        ['kerning'] = 0,\n        ['pixels']  = {\n                {0, 1, 1, 1, 0},\n                {1, 0, 0, 0, 1},\n                {1, 0, 0, 0, 0},\n                {1, 0, 0, 0, 0},\n                {1, 0, 0, 0, 0},\n                {1, 0, 0, 0, 1},\n                {0, 1, 1, 1, 0},\n                {0, 0, 0, 0, 0},\n                {0, 0, 0, 0, 0}\n        }\n}\nfonts['5x7']['D'] = {\n        ['descender'] = 0,\n        ['kerning'] = 0,\n        ['pixels']  = {\n                {1, 1, 1, 1, 0},\n                {1, 0, 0, 0, 1},\n                {1, 0, 0, 0, 1},\n                {1, 0, 0, 0, 1},\n                {1, 0, 0, 0, 1},\n                {1, 0, 0, 0, 1},\n                {1, 1, 1, 1, 0},\n                {0, 0, 0, 0, 0},\n                {0, 0, 0, 0, 0}\n        }\n}\nfonts['5x7']['E'] = {\n        ['descender'] = 0,\n        ['kerning'] = 0,\n        ['pixels']  = {\n                {1, 1, 1, 1, 1},\n                {1, 0, 0, 0, 0},\n                {1, 0, 0, 0, 0},\n                {1, 1, 1, 1, 0},\n                {1, 0, 0, 0, 0},\n                {1, 0, 0, 0, 0},\n                {1, 1, 1, 1, 1},\n                {0, 0, 0, 0, 0},\n                {0, 0, 0, 0, 0}\n        }\n}\nfonts['5x7']['F'] = {\n        ['descender'] = 0,\n        ['kerning'] = 0,\n        ['pixels']  = {\n                {1, 1, 1, 1, 1},\n                {1, 0, 0, 0, 0},\n                {1, 0, 0, 0, 0},\n                {1, 1, 1, 1, 0},\n                {1, 0, 0, 0, 0},\n                {1, 0, 0, 0, 0},\n                {1, 0, 0, 0, 0},\n                {0, 0, 0, 0, 0},\n                {0, 0, 0, 0, 0}\n        }\n}\nfonts['5x7']['G'] = {\n        ['descender'] = 0,\n        ['kerning'] = 0,\n        ['pixels']  = {\n                {0, 1, 1, 1, 0},\n                {1, 0, 0, 0, 1},\n                {1, 0, 0, 0, 0},\n                {1, 0, 1, 1, 1},\n                {1, 0, 0, 0, 1},\n                {1, 0, 0, 0, 1},\n                {0, 1, 1, 1, 0},\n                {0, 0, 0, 0, 0},\n                {0, 0, 0, 0, 0}\n        }\n}\nfonts['5x7']['H'] = {\n        ['descender'] = 0,\n        ['kerning'] = 0,\n        ['pixels']  = {\n                {1, 0, 0, 0, 1},\n                {1, 0, 0, 0, 1},\n                {1, 0, 0, 0, 1},\n                {1, 1, 1, 1, 1},\n                {1, 0, 0, 0, 1},\n                {1, 0, 0, 0, 1},\n                {1, 0, 0, 0, 1},\n                {0, 0, 0, 0, 0},\n                {0, 0, 0, 0, 0}\n        }\n}\nfonts['5x7']['I'] = {\n        ['descender'] = 0,\n        ['kerning'] = -4,\n        ['pixels']  = {\n                {1, 0, 0, 0, 0},\n                {1, 0, 0, 0, 0},\n                {1, 0, 0, 0, 0},\n                {1, 0, 0, 0, 0},\n                {1, 0, 0, 0, 0},\n                {1, 0, 0, 0, 0},\n                {1, 0, 0, 0, 0},\n                {0, 0, 0, 0, 0},\n                {0, 0, 0, 0, 0}\n        }\n}\nfonts['5x7']['J'] = {\n        ['descender'] = 0,\n        ['kerning'] = -1,\n        ['pixels']  = {\n                {0, 0, 0, 1, 0},\n                {0, 0, 0, 1, 0},\n                {0, 0, 0, 1, 0},\n                {0, 0, 0, 1, 0},\n                {0, 0, 0, 1, 0},\n                {1, 0, 0, 1, 0},\n                {0, 1, 1, 0, 0},\n                {0, 0, 0, 0, 0},\n                {0, 0, 0, 0, 0}\n        }\n}\nfonts['5x7']['K'] = {\n        ['descender'] = 0,\n        ['kerning'] = 0,\n        ['pixels']  = {\n                {1, 0, 0, 0, 1},\n                {1, 0, 0, 1, 0},\n                {1, 0, 1, 0, 0},\n                {1, 1, 0, 0, 0},\n                {1, 0, 1, 0, 0},\n                {1, 0, 0, 1, 0},\n                {1, 0, 0, 0, 1},\n                {0, 0, 0, 0, 0},\n                {0, 0, 0, 0, 0}\n        }\n}\nfonts['5x7']['L'] = {\n        ['descender'] = 0,\n        ['kerning'] = -1,\n        ['pixels']  = {\n                {1, 0, 0, 0, 0},\n                {1, 0, 0, 0, 0},\n                {1, 0, 0, 0, 0},\n                {1, 0, 0, 0, 0},\n                {1, 0, 0, 0, 0},\n                {1, 0, 0, 0, 0},\n                {1, 1, 1, 1, 0},\n                {0, 0, 0, 0, 0},\n                {0, 0, 0, 0, 0}\n        }\n}\nfonts['5x7']['M'] = {\n        ['descender'] = 0,\n        ['kerning'] = 0,\n        ['pixels']  = {\n                {1, 0, 0, 0, 1},\n                {1, 0, 0, 0, 1},\n                {1, 1, 0, 1, 1},\n                {1, 1, 0, 1, 1},\n                {1, 0, 1, 0, 1},\n                {1, 0, 1, 0, 1},\n                {1, 0, 0, 0, 1},\n                {0, 0, 0, 0, 0},\n                {0, 0, 0, 0, 0}\n        }\n}\nfonts['5x7']['N'] = {\n        ['descender'] = 0,\n        ['kerning'] = 0,\n        ['pixels']  = {\n                {1, 0, 0, 0, 1},\n                {1, 1, 0, 0, 1},\n                {1, 1, 0, 0, 1},\n                {1, 0, 1, 0, 1},\n                {1, 0, 0, 1, 1},\n                {1, 0, 0, 1, 1},\n                {1, 0, 0, 0, 1},\n                {0, 0, 0, 0, 0},\n                {0, 0, 0, 0, 0}\n        }\n}\nfonts['5x7']['O'] = {\n        ['descender'] = 0,\n        ['kerning'] = 0,\n        ['pixels']  = {\n                {0, 1, 1, 1, 0},\n                {1, 0, 0, 0, 1},\n                {1, 0, 0, 0, 1},\n                {1, 0, 0, 0, 1},\n                {1, 0, 0, 0, 1},\n                {1, 0, 0, 0, 1},\n                {0, 1, 1, 1, 0},\n                {0, 0, 0, 0, 0},\n                {0, 0, 0, 0, 0}\n        }\n}\nfonts['5x7']['P'] = {\n        ['descender'] = 0,\n        ['kerning'] = 0,\n        ['pixels']  = {\n                {1, 1, 1, 1, 0},\n                {1, 0, 0, 0, 1},\n                {1, 0, 0, 0, 1},\n                {1, 1, 1, 1, 0},\n                {1, 0, 0, 0, 0},\n                {1, 0, 0, 0, 0},\n                {1, 0, 0, 0, 0},\n                {0, 0, 0, 0, 0},\n                {0, 0, 0, 0, 0}\n        }\n}\nfonts['5x7']['Q'] = {\n        ['descender'] = -2,\n        ['kerning'] = 0,\n        ['pixels']  = {\n                {0, 1, 1, 1, 0},\n                {1, 0, 0, 0, 1},\n                {1, 0, 0, 0, 1},\n                {1, 0, 0, 0, 1},\n                {1, 0, 0, 0, 1},\n                {1, 0, 0, 0, 1},\n                {0, 1, 1, 1, 0},\n                {0, 0, 0, 1, 0},\n                {0, 0, 0, 0, 1}\n        }\n}\nfonts['5x7']['R'] = {\n        ['descender'] = 0,\n        ['kerning'] = 0,\n        ['pixels']  = {\n                {1, 1, 1, 1, 0},\n                {1, 0, 0, 0, 1},\n                {1, 0, 0, 0, 1},\n                {1, 1, 1, 1, 0},\n                {1, 0, 0, 0, 1},\n                {1, 0, 0, 0, 1},\n                {1, 0, 0, 0, 1},\n                {0, 0, 0, 0, 0},\n                {0, 0, 0, 0, 0}\n        }\n}\nfonts['5x7']['S'] = {\n        ['descender'] = 0,\n        ['kerning'] = 0,\n        ['pixels']  = {\n                {0, 1, 1, 1, 0},\n                {1, 0, 0, 0, 1},\n                {1, 0, 0, 0, 0},\n                {0, 1, 1, 1, 0},\n                {0, 0, 0, 0, 1},\n                {1, 0, 0, 0, 1},\n                {0, 1, 1, 1, 0},\n                {0, 0, 0, 0, 0},\n                {0, 0, 0, 0, 0}\n        }\n}\nfonts['5x7']['T'] = {\n        ['descender'] = 0,\n        ['kerning'] = 0,\n        ['pixels']  = {\n                {1, 1, 1, 1, 1},\n                {0, 0, 1, 0, 0},\n                {0, 0, 1, 0, 0},\n                {0, 0, 1, 0, 0},\n                {0, 0, 1, 0, 0},\n                {0, 0, 1, 0, 0},\n                {0, 0, 1, 0, 0},\n                {0, 0, 0, 0, 0},\n                {0, 0, 0, 0, 0}\n        }\n}\nfonts['5x7']['U'] = {\n        ['descender'] = 0,\n        ['kerning'] = 0,\n        ['pixels']  = {\n                {1, 0, 0, 0, 1},\n                {1, 0, 0, 0, 1},\n                {1, 0, 0, 0, 1},\n                {1, 0, 0, 0, 1},\n                {1, 0, 0, 0, 1},\n                {1, 0, 0, 0, 1},\n                {0, 1, 1, 1, 0},\n                {0, 0, 0, 0, 0},\n                {0, 0, 0, 0, 0}\n        }\n}\nfonts['5x7']['V'] = {\n        ['descender'] = 0,\n        ['kerning'] = 0,\n        ['pixels']  = {\n                {1, 0, 0, 0, 1},\n                {1, 0, 0, 0, 1},\n                {1, 0, 0, 0, 1},\n                {0, 1, 0, 1, 0},\n                {0, 1, 0, 1, 0},\n                {0, 0, 1, 0, 0},\n                {0, 0, 1, 0, 0},\n                {0, 0, 0, 0, 0},\n                {0, 0, 0, 0, 0}\n        }\n}\nfonts['5x7']['W'] = {\n        ['descender'] = 0,\n        ['kerning'] = 0,\n        ['pixels']  = {\n                {1, 0, 0, 0, 1},\n                {1, 0, 0, 0, 1},\n                {1, 0, 0, 0, 1},\n                {1, 0, 1, 0, 1},\n                {1, 0, 1, 0, 1},\n                {0, 1, 0, 1, 0},\n                {0, 1, 0, 1, 0},\n                {0, 0, 0, 0, 0},\n                {0, 0, 0, 0, 0}\n        }\n}\nfonts['5x7']['X'] = {\n        ['descender'] = 0,\n        ['kerning'] = 0,\n        ['pixels']  = {\n                {1, 0, 0, 0, 1},\n                {1, 0, 0, 0, 1},\n                {0, 1, 0, 1, 0},\n                {0, 0, 1, 0, 0},\n                {0, 1, 0, 1, 0},\n                {1, 0, 0, 0, 1},\n                {1, 0, 0, 0, 1},\n                {0, 0, 0, 0, 0},\n                {0, 0, 0, 0, 0}\n        }\n}\nfonts['5x7']['Y'] = {\n        ['descender'] = 0,\n        ['kerning'] = 0,\n        ['pixels']  = {\n                {1, 0, 0, 0, 1},\n                {1, 0, 0, 0, 1},\n                {1, 0, 0, 0, 1},\n                {0, 1, 0, 1, 0},\n                {0, 0, 1, 0, 0},\n                {0, 0, 1, 0, 0},\n                {0, 0, 1, 0, 0},\n                {0, 0, 0, 0, 0},\n                {0, 0, 0, 0, 0}\n        }\n}\nfonts['5x7']['Z'] = {\n        ['descender'] = 0,\n        ['kerning'] = 0,\n        ['pixels']  = {\n                {1, 1, 1, 1, 1},\n                {0, 0, 0, 0, 1},\n                {0, 0, 0, 1, 0},\n                {0, 0, 1, 0, 0},\n                {0, 1, 0, 0, 0},\n                {1, 0, 0, 0, 0},\n                {1, 1, 1, 1, 1},\n                {0, 0, 0, 0, 0},\n                {0, 0, 0, 0, 0}\n        }\n}\n\n\nfonts['5x7']['_'] = {\n        ['descender'] = 0,\n        ['kerning'] = 0,\n        ['pixels']  = {\n                {0, 0, 0, 0, 0},\n                {0, 0, 0, 0, 0},\n                {0, 0, 0, 0, 0},\n                {0, 0, 0, 0, 0},\n                {0, 0, 0, 0, 0},\n                {0, 0, 0, 0, 0},\n                {1, 1, 1, 1, 1},\n                {0, 0, 0, 0, 0},\n                {0, 0, 0, 0, 0}\n        }\n}\nfonts['5x7']['\"'] = {\n        ['descender'] = 0,\n        ['kerning'] = 0,\n        ['pixels']  = {\n                {0, 0, 1, 0, 1},\n                {0, 1, 0, 1, 0},\n                {0, 0, 0, 0, 0},\n                {0, 0, 0, 0, 0},\n                {0, 0, 0, 0, 0},\n                {0, 0, 0, 0, 0},\n                {0, 0, 0, 0, 0},\n                {0, 0, 0, 0, 0},\n                {0, 0, 0, 0, 0}\n        }\n}\n--fontstop\n\n--Cracker64's Powder Toy Multiplayer\nlocal version = 8\nlocal versionstring = \"1.0.2\"\n\nif TPTMP then if TPTMP.version <= version then TPTMP.disableMultiplayer() else error(\"newer version already running\") end end local get_name = tpt.get_name -- if script already running, replace it\nTPTMP = {[\"version\"] = version, [\"versionStr\"] = versionstring} -- script version sent on connect to ensure server protocol is the same\nlocal issocket,socket = pcall(require,\"socket\")\nif not http then error\"Tpt version not supported\" end\nlocal using_manager = false\nlocal type = type -- people like to overwrite this function with a global a lot\nlocal _print = print\nif MANAGER ~= nil or MANAGER_EXISTS then\n\011using_manager = true\n\011_print = MANAGER and MANAGER.print or MANAGER_PRINT\nelse\n\011_print = print\nend\nlocal hooks_enabled = false --hooks only enabled once you maximize the button\n\nlocal PORT = 34403 --Change 34403 to your desired port\nlocal KEYBOARD = 1 --only change if you have issues. Only other option right now is 2(finnish).\n--Local player vars we need to keep\nlocal L = {mousex=0, mousey=0, realMouseX=0, realMouseY=0, brushx=0, brushy=0, sell=1, sela=296, selr=0, selrep=0, replacemode = 0, mButt=0, mEvent=0, isDrawing=false, dcolour=0, stick2=false, chatHidden=true, flashChat=false,\nshift=false, alt=false, ctrl=false, tabs = false, z=false, skipClick=false, pauseNextFrame=false, copying=false, stamp=false, placeStamp=false, lastStamp=nil, lastCopy=nil, smoved=false, rotate=false, sendScreen=false}\n\nlocal tptversion = tpt.version.build\nlocal jacobsmod = tpt.version.jacob1s_mod~=nil\nmath.randomseed(os.time())\nlocal username = get_name()\nif username == \"\" then\n\011username = \"Guest#\"..math.random(10000,99999)\nend\nlocal authToken\nif using_manager then\n\011authToken = MANAGER.getsetting(\"tptmp\", \"authtoken\")\nend\nlocal chatwindow\nlocal lastchan = ''\nlocal con = {connected = false,\n\011\011 socket = nil,\n\011\011 members = nil,\n\011\011 pingTime = os.time()+60}\nlocal function disconnected(reason)\n\011if con.socket then\n\011\011con.socket:close()\n\011end\n\011if reason then\n\011\011chatwindow:addline(reason,255,50,50)\n\011else\n\011\011chatwindow:addline(\"Connection was closed\",255,50,50)\n\011end\n\011con.connected = false\n\011con.members = {}\n\011lastchan = ''\nend\nlocal function conSend(cmd,msg,endNull)\n\011if not con.connected then return false,\"Not connected\" end\n\011msg = msg or \"\"\n\011if endNull then msg = msg..\"\\0\" end\n\011if cmd then msg = string.char(cmd)..msg end\n\011con.socket:settimeout(10)\n\011con.socket:send(msg)\n\011con.socket:settimeout(0)\nend\nlocal function joinChannel(chan)\n\011conSend(16,chan,true)\n\011--send some things to new channel\n\011conSend(34,string.char(L.brushx,L.brushy))\n\011conSend(37,string.char(math.floor(L.sell/256),L.sell%256))\n\011conSend(37,string.char(math.floor(64 + L.sela/256),L.sela%256))\n\011conSend(37,string.char(math.floor(128 + L.selr/256),L.selr%256))\n\011conSend(37,string.char(math.floor(192 + L.selrep/256),L.selrep%256))\n\011conSend(38,L.replacemode)\n\011conSend(65,string.char(math.floor(L.dcolour/16777216),math.floor(L.dcolour/65536)%256,math.floor(L.dcolour/256)%256,L.dcolour%256))\nend\nlocal function authenticateGetUser()\n\011local pref = io.open(\"powder.pref\")\n\011if not pref then\n\011\011return false\n\011end\n\011local prefData = pref:read(\"*a\")\n\011pref:close()\n\011local user = prefData:match([[\"User\"%s*:%s*(%b{})]])\n\011if not user then\n\011\011return false\n\011end\n\011local uid = user:match([[\"ID\"%s*:%s*(%d+)]])\n\011local sess = user:match([[\"SessionID\"%s*:%s*\"([^\"]+)\"]])\n\011if not uid or not sess then\n\011\011return false\n\011end\n\011return uid, sess\nend\nlocal function authenticateGetToken(uid, sess)\n\011local req = http.get(\"https://powdertoy.co.uk/ExternalAuth.api?Action=Get\", { [ \"X-Auth-User-Id\" ] = uid, [ \"X-Auth-Session-Key\" ] = sess })\n\011while req:status() == \"running\" do\n\011\011socket.sleep(0.1)\n\011end\n\011local body, code = req:finish()\n\011if code ~= 200 then\n\011\011return nil, \"Error code \" .. code .. \": \" .. body\n\011end\n\011local status = body:match([[\"Status\":\"([^\"]+)\"]])\n\011if status ~= \"OK\" then\n\011\011return nil, \"Authentication failed, try logging out and back in and restarting TPT\"\n\011end\n\011return body:match([[\"Token\":\"([^\"]+)\"]])\nend\nlocal function connectToServer(ip,port,nick)\n\011if con.connected then return false,\"Already connected\" end\n\011ip = ip or \"tptmp.starcatcher.us\"\n\011port = port or PORT\n\011local sock = socket.tcp()\n\011sock:settimeout(10)\n\011local s,r = sock:connect(ip,port)\n\011if not s then return false,r end\n\011sock:settimeout(0.1)\n\011sock:setoption(\"keepalive\",true)\n\011sock:send(string.char(tpt.version.major)..string.char(tpt.version.minor)..string.char(TPTMP.version)..nick..\"\\0\")\n\011local c,r,zs\n\011local function connectByte()\n\011\011repeat\n\011\011\011c,r = sock:receive(1)\n\011\011\011if not c and r~=\"timeout\" then break end\n\011\011until c\n\011\011return c\n\011end\n\011local function connectZString()\n\011\011local buf = {}\n\011\011while true do\n\011\011\011if not connectByte() then\n\011\011\011\011return false\n\011\011\011end\n\011\011\011if c == \"\\0\" then\n\011\011\011\011break\n\011\011\011end\n\011\011\011table.insert(buf, c)\n\011\011end\n\011\011zs = table.concat(buf)\n\011\011return zs\n\011end\n\011if not connectByte() then\n\011\011return false, r\n\011end\n\011for authAttempt = 1, 2 do\n\011\011if c~=\"\\3\" then\n\011\011\011break\n\011\011end\n\011\011local uid, sess = authenticateGetUser()\n\011\011if uid then\n\011\011\011if not authToken then\n\011\011\011\011local err\n\011\011\011\011authToken, err = authenticateGetToken(uid, sess)\n\011\011\011\011if not authToken then\n\011\011\011\011\011return false, err\n\011\011\011\011end\n\011\011\011\011if using_manager then\n\011\011\011\011\011MANAGER.savesetting(\"tptmp\", \"authtoken\", authToken)\n\011\011\011\011end\n\011\011\011end\n\011\011else\n\011\011\011authToken = nil\n\011\011end\n\011\011if authToken then\n\011\011\011sock:send(\"\\1\" .. authToken .. \"\\0\")\n\011\011else\n\011\011\011sock:send(\"\\0\")\n\011\011end\n\011\011if not connectByte() then\n\011\011\011return false, r\n\011\011end\n\011\011local cresponse = c\n\011\011if c == \"\\1\" then\n\011\011\011if not connectZString() then\n\011\011\011\011return false, r\n\011\011\011end\n\011\011\011if nick ~= zs then\n\011\011\011\011nick = zs\n\011\011\011\011chatwindow:addline(\"You joined as \"..nick,255,255,50)\n\011\011\011end\n\011\011else\n\011\011\011authToken = nil\n\011\011end\n\011\011c = cresponse\n\011end\n\011sock:settimeout(0)\n\011if c~= \"\\1\" then\n\011if c==\"\\0\" then\n\011\011local err=\"\"\n\011\011c,r = sock:receive(1)\n\011\011while c~=\"\\0\" do\n\011\011err = err..c\n\011\011c,r = sock:receive(1)\n\011\011end\n\011\011if err==\"This nick is already on the server\" then\n\011\011\011nick = nick:gsub(\"(.)$\",function(s) local n=tonumber(s) if n and n+1 <= 9 then return n+1 else return nick:sub(-1)..'0' end end)\n\011\011\011return connectToServer(ip,port,nick)\n\011\011end\n\011\011return false,err\n\011end\n\011return false,\"Bad Connect\"\n\011end\n\n\011con.socket = sock\n\011con.connected = true\n\011username = nick\n\011conSend(34,string.char(L.brushx,L.brushy))\n\011conSend(37,string.char(math.floor(L.sell/256),L.sell%256))\n\011conSend(37,string.char(math.floor(64 + L.sela/256),L.sela%256))\n\011conSend(37,string.char(math.floor(128 + L.selr/256),L.selr%256))\n\011conSend(37,string.char(math.floor(192 + L.selrep/256),L.selrep%256))\n\011conSend(38,L.replacemode)\n\011conSend(65,string.char(math.floor(L.dcolour/16777216),math.floor(L.dcolour/65536)%256,math.floor(L.dcolour/256)%256,L.dcolour%256))\n\011return true\nend\n--get up to a null (\\0)\nlocal function conGetNull()\n\011con.socket:settimeout(nil)\n\011local c,r = con.socket:receive(1)\n\011if not c and r ~= \"timeout\" then disconnected() return nil end\n\011local rstring=\"\"\n\011while c~=\"\\0\" do\n\011rstring = rstring..c\n\011c,r = con.socket:receive(1)\n\011if not c and r ~= \"timeout\" then disconnected() return nil end\n\011end\n\011con.socket:settimeout(0)\n\011return rstring\nend\n--get next char/byte\nlocal function cChar()\n\011con.socket:settimeout(nil)\n\011local c,r = con.socket:receive(1)\n\011con.socket:settimeout(0)\n\011if not c then disconnected() end\n\011return c\nend\nlocal function cByte()\n\011local byte = cChar()\n\011return byte and byte:byte() or nil\nend\n--return table of arguments\nlocal function getArgs(msg)\n\011if not msg then return {} end\n\011local args = {}\n\011for word in msg:gmatch(\"([^%s%c]+)\") do\n\011table.insert(args,word)\n\011end\n\011return args\nend\n\nlocal ui_base local ui_box local ui_text local ui_button local ui_scrollbar local ui_inputbox local ui_chatbox\nui_base = {\nnew = function()\n\011local b={}\n\011b.drawlist = {}\n\011function b:drawadd(f)\n\011\011table.insert(self.drawlist,f)\n\011end\n\011function b:draw(...)\n\011\011for _,f in ipairs(self.drawlist) do\n\011\011\011if type(f)==\"function\" then\n\011\011\011\011f(self,...)\n\011\011\011end\n\011\011end\n\011end\n\011b.movelist = {}\n\011function b:moveadd(f)\n\011\011table.insert(self.movelist,f)\n\011end\n\011function b:onmove(x,y)\n\011\011for _,f in ipairs(self.movelist) do\n\011\011\011if type(f)==\"function\" then\n\011\011\011\011f(self,x,y)\n\011\011\011end\n\011\011end\n\011end\n\011return b\nend\n}\nui_box = {\nnew = function(x,y,w,h,r,g,b)\n\011local box=ui_base.new()\n\011box.x=x box.y=y box.w=w box.h=h box.x2=x+w box.y2=y+h\n\011box.r=r or 70 box.g=g or 70 box.b=b or 70\n\011function box:setcolor(r,g,b) self.r=r self.g=g self.b=b end\n\011function box:setbackground(r,g,b,a) self.br=r self.bg=g self.bb=b self.ba=a end\n\011box.drawbox=true\n\011box.drawbackground=false\n\011box:drawadd(function(self) if self.drawbackground then gfx.fillRect(self.x,self.y,self.w+1,self.h+1,self.br,self.bg,self.bb,self.ba) end\n\011\011\011\011\011\011\011\011if self.drawbox then gfx.drawRect(self.x,self.y,self.w+1,self.h+1,self.r,self.g,self.b) end end)\n\011box:moveadd(function(self,x,y)\n\011\011if x then self.x=self.x+x self.x2=self.x2+x end\n\011\011if y then self.y=self.y+y self.y2=self.y2+y end\n\011end)\n\011return box\nend\n}\nui_text = {\nnew = function(text,x,y,r,g,b)\n\011local txt = ui_base.new()\n\011txt.text = text\n\011txt.x=x or 0 txt.y=y or 0 txt.r=r or 255 txt.g=g or 255 txt.b=b or 255\n\011function txt:setcolor(r,g,b) self.r=r self.g=g self.b=b end\n\011txt:drawadd(function(self,x,y) gfx.drawText(x or self.x,y or self.y,self.text,self.r,self.g,self.b) end)\n\011txt:moveadd(function(self,x,y)\n\011\011if x then self.x=self.x+x end\n\011\011if y then self.y=self.y+y end\n\011end)\n\011return txt\nend,\n--Scrolls while holding mouse over\nnewscroll = function(text,x,y,vis,force,r,g,b)\n\011local txt = ui_text.new(text,x,y,r,g,b)\n\011if not force and tpt.textwidth(text)<vis then return txt end\n\011txt.visible=vis\n\011txt.length=string.len(text)\n\011txt.start=1\n\011local last=2\n\011while tpt.textwidth(text:sub(1,last))<vis and last<=txt.length do\n\011\011last=last+1\n\011end\n\011txt.last=last-1\n\011txt.minlast=last-1\n\011txt.ppl=((txt.visible-6)/(txt.length-txt.minlast+1))\n\011function txt:update(text,pos)\n\011\011if text then\n\011\011\011self.text=text\n\011\011\011self.length=string.len(text)\n\011\011\011local last=2\n\011\011\011while tpt.textwidth(text:sub(1,last))<self.visible and last<=self.length do\n\011\011\011\011last=last+1\n\011\011\011end\n\011\011\011self.minlast=last-1\n\011\011\011self.ppl=((self.visible-6)/(self.length-self.minlast+1))\n\011\011\011if not pos then self.last=self.minlast end\n\011\011end\n\011\011if pos then\n\011\011\011if pos>=self.last and pos<=self.length then --more than current visible\n\011\011\011\011local newlast = pos\n\011\011\011\011local newstart=1\n\011\011\011\011while tpt.textwidth(self.text:sub(newstart,newlast))>= self.visible do\n\011\011\011\011\011newstart=newstart+1\n\011\011\011\011end\n\011\011\011\011self.start=newstart self.last=newlast\n\011\011\011elseif pos<self.start and pos>0 then --position less than current visible\n\011\011\011\011local newstart=pos\n\011\011\011\011local newlast=pos+1\n\011\011\011\011while tpt.textwidth(self.text:sub(newstart,newlast))<self.visible and newlast<self.length do\n\011\011\011\011\011\011newlast=newlast+1\n\011\011\011\011end\n\011\011\011\011self.start=newstart self.last=newlast-1\n\011\011\011end\n\011\011\011--keep strings as long as possible (pulls from left)\n\011\011\011local newlast=self.last\n\011\011\011if newlast<self.minlast then newlast=self.minlast end\n\011\011\011local newstart=1\n\011\011\011while tpt.textwidth(self.text:sub(newstart,newlast))>= self.visible do\n\011\011\011\011\011newstart=newstart+1\n\011\011\011end\n\011\011\011self.start=newstart self.last=newlast\n\011\011end\n\011end\n\011txt.drawlist={} --reset draw\n\011txt:drawadd(function(self,x,y)\n\011\011gfx.drawText(x or self.x,y or self.y, self.text:sub(self.start,self.last) ,self.r,self.g,self.b)\n\011end)\n\011function txt:mouseMove(mx,my,dX,dY)\n\011\011local newlast = math.floor((mx-self.x)/self.ppl)+self.minlast\n\011\011if newlast<self.minlast then newlast=self.minlast end\n\011\011if newlast>0 and newlast~=self.last then\n\011\011\011local newstart=1\n\011\011\011while tpt.textwidth(self.text:sub(newstart,newlast))>= self.visible do\n\011\011\011\011newstart=newstart+1\n\011\011\011end\n\011\011\011self.start=newstart self.last=newlast\n\011\011end\n\011end\n\011return txt\nend\n}\nui_inputbox = {\nnew=function(x,y,w,h)\n\011local intext=ui_box.new(x,y,w,h)\n\011intext.cursor=0\n\011intext.line=1\n\011intext.currentline = \"\"\n\011intext.focus=false\n\011intext.t=ui_text.newscroll(\"\",x+2,y+2,w-2,true)\n\011intext.history={}\n\011intext.max_history=200\n\011intext.ratelimit = 0\n\011intext:drawadd(function(self)\n\011\011local cursoradjust=tpt.textwidth(self.t.text:sub(self.t.start,self.cursor))+2\n\011\011if self.cursor > 0 then gfx.drawLine(self.x+cursoradjust,self.y,self.x+cursoradjust,self.y+10,255,255,255) end\n\011\011self.t:draw()\n\011end)\n\011intext:moveadd(function(self,x,y) self.t:onmove(x,y) end)\n\011function intext:setfocus(focus)\n\011\011self.focus=focus\n\011\011if focus then self:setcolor(255,255,0)\n\011\011else self:setcolor(255,255,255) end\n\011end\n\011function intext:movecursor(amt)\n\011\011self.cursor = self.cursor+amt\n\011\011if self.cursor>self.t.length then self.cursor = self.t.length end\n\011\011if self.cursor<0 then self.cursor = 0 return end\n\011end\n\011function intext:addhistory(str)\n\011\011self.history[#self.history+1] = str\n\011\011if #self.history >= self.max_history then\n\011\011\011table.remove(self.history, 1)\n\011\011end\n\011end\n\011function intext:moveline(amt)\n\011\011self.line = self.line+amt\n\011\011local max = #self.currentline and #self.history+2 or #self.history+1\n\011\011if self.line>max then self.line=max\n\011\011elseif self.line<1 then self.line=1 end\n\011\011local history = self.history[self.line] or \"\"\n\011\011if self.line == #self.history+1 then history = self.currentline end\n\011\011self.cursor = string.len(history)\n\011\011self.t:update(history, self.cursor)\n\011end\n\011function intext:keypress(key, scan, rep, shift, ctrl, alt)\n\011\011if not self.focus then\n\011\011\011if key == 13 then\n\011\011\011\011self:setfocus(true)\n\011\011\011end\n\011\011\011return\n\011\011end\n\011\011-- Esc\n\011\011if key == 27 then\n\011\011\011self:setfocus(false)\n\011\011-- Enter\n\011\011elseif key == 13 and not rep then\n\011\011\011if socket.gettime() < self.ratelimit then\n\011\011\011\011return\n\011\011\011end\n\011\011\011local text = self.t.text\n\011\011\011if text == \"\" then\n\011\011\011\011self:setfocus(false)\n\011\011\011else\n\011\011\011\011self.cursor = 0\n\011\011\011\011self.t.text = \"\"\n\011\011\011\011self:addhistory(text)\n\011\011\011\011self.line = #self.history + 1\n\011\011\011\011self.currentline = \"\"\n\011\011\011\011self.ratelimit = socket.gettime() + 1\n\011\011\011\011return text\n\011\011\011end\n\011\011-- Up\n\011\011elseif key == 1073741906 then\n\011\011\011if socket.gettime() < self.ratelimit then\n\011\011\011\011return\n\011\011\011end\n\011\011\011self:moveline(-1)\n\011\011-- Down\n\011\011elseif key == 1073741905 then\n\011\011\011self:moveline(1)\n\011\011-- Right\n\011\011elseif key == 1073741903 then\n\011\011\011self:movecursor(1)\n\011\011\011self.t:update(nil, self.cursor)\n\011\011-- Left\n\011\011elseif key == 1073741904 then\n\011\011\011self:movecursor(-1)\n\011\011\011self.t:update(nil, self.cursor)\n\011\011end\n\n\011\011local newstr\n\011\011-- Backspace\n\011\011if key == 8 then\n\011\011\011if self.cursor > 0 then\n\011\011\011\011newstr = self.t.text:sub(1,self.cursor-1) .. self.t.text:sub(self.cursor+1)\n\011\011\011\011self:movecursor(-1)\n\011\011\011end\n\011\011-- Delete\n\011\011elseif key == 127 then\n\011\011\011newstr=self.t.text:sub(1,self.cursor) .. self.t.text:sub(self.cursor+2)\n\011\011-- Tab\n\011\011elseif key == 9 then\n\011\011\011local nickstart, nickend, nick = self.t.text:sub(1,self.cursor+1):find(\"([^%s%c]+)\"..(self.cursor == #self.t.text and \"\" or \" \")..\"$\")\n\011\011\011if con.members and nick then\n\011\011\011\011for k, v in pairs(con.members) do\n\011\011\011\011\011if v.name:sub(1, #nick) == nick then\n\011\011\011\011\011\011nick = v.name\n\011\011\011\011\011\011if nickstart == 1 then\n\011\011\011\011\011\011\011nick = nick .. \":\"\n\011\011\011\011\011\011end\n\011\011\011\011\011\011newstr = self.t.text:sub(1,nickstart-1)..nick..\" \"..self.t.text:sub(nickend+1, #self.t.text)\n\011\011\011\011\011\011self.cursor = nickstart + #nick\n\011\011\011\011\011end\n\011\011\011\011end\n\011\011\011end\n\011\011-- CTRL+C\n\011\011elseif scan == 6 and ctrl then\n\011\011\011platform.clipboardPaste(self.t.text)\n\011\011\011tpt.log('Copied to clipboard')\n\011\011-- CTRL+V\n\011\011elseif scan == 25 and ctrl then\n\011\011\011local paste = platform.clipboardCopy()\n\011\011\011local newText = self.t.text:sub(1, self.cursor) .. paste .. self.t.text:sub(self.cursor + 1)\n\011\011\011self.cursor = self.cursor + #paste\n\011\011\011self.t:update(newText, self.cursor)\n\011\011-- CTRL+X\n\011\011elseif scan == 27 and ctrl then\n\011\011\011platform.clipboardPaste(self.t.text)\n\011\011\011tpt.log('Copied to clipboard')\n\011\011\011self.cursor = 0\n\011\011\011self.t:update(\"\", 0)\n\011\011end\n\011\011if newstr then\n\011\011\011self.t:update(newstr,self.cursor)\n\011\011end\n\011end\n\011function intext:textinput(text)\n\011\011if not self.focus then\n\011\011\011return\n\011\011end\n\011\011-- TPT font has no unicode characters at the moment, nor does it have a good enough api to support them\n\011\011if #text > 1 or string.byte(text) < 20 or string.byte(text) > 126 then return end\n\011\011newstr = self.t.text:sub(1, self.cursor) .. text .. self.t.text:sub(self.cursor + 1)\n\011\011self.currentline = newstr\n\011\011self.t:update(newstr, self.cursor + 1)\n\011\011self:movecursor(1)\n\011end\n\011return intext\nend\n}\nui_scrollbar = {\nnew = function(x,y,h,t,m)\n\011local bar = ui_base.new() --use line object as base?\n\011bar.x=x bar.y=y bar.h=h\n\011bar.total=t\n\011bar.numshown=m\n\011bar.pos=0\n\011bar.length=math.floor((1/math.ceil(bar.total-bar.numshown+1))*bar.h)\n\011bar.soffset=math.floor(bar.pos*((bar.h-bar.length)/(bar.total-bar.numshown)))\n\011function bar:update(total,shown,pos)\n\011\011self.pos=pos or 0\n\011\011if self.pos<0 then self.pos=0 end\n\011\011self.total=total\n\011\011self.numshown=shown\n\011\011self.length= math.floor((1/math.ceil(self.total-self.numshown+1))*self.h)\n\011\011self.soffset= math.floor(self.pos*((self.h-self.length)/(self.total-self.numshown)))\n\011end\n\011function bar:move(wheel)\n\011\011self.pos = self.pos-wheel\n\011\011if self.pos < 0 then self.pos=0 end\n\011\011if self.pos > (self.total-self.numshown) then self.pos=(self.total-self.numshown) end\n\011\011self.soffset= math.floor(self.pos*((self.h-self.length)/(self.total-self.numshown)))\n\011end\n\011bar:drawadd(function(self)\n\011\011if self.total > self.numshown then\n\011\011\011gfx.drawLine(self.x,self.y+self.soffset,self.x,self.y+self.soffset+self.length)\n\011\011end\n\011end)\n\011bar:moveadd(function(self,x,y)\n\011\011if x then self.x=self.x+x end\n\011\011if y then self.y=self.y+y end\n\011end)\n\011function bar:mouseWheel(mx,my,wheel)\n\011\011if wheel~=0 and not hidden_mode then\n\011\011\011if self.total > self.numshown then\n\011\011\011\011local previous = self.pos\n\011\011\011\011self:move(wheel)\n\011\011\011\011if self.pos~=previous then\n\011\011\011\011\011return wheel\n\011\011\011\011end\n\011\011\011end\n\011\011end\n\011end\n\011return bar\nend\n}\nui_button = {\nnew = function(x,y,w,h,f,text)\n\011local b = ui_box.new(x,y,w,h)\n\011b.f=f\n\011b.t=ui_text.new(text,x+2,y+2)\n\011b.drawbox=false\n\011b.clicked = false\n\011b.invert = false\n\011b:drawadd(function(self)\n\011\011if self.clicked or self.invert then\n\011\011\011tpt.fillrect(self.x,self.y,self.w,self.h)\n\011\011\011local tr=self.t.r local tg=self.t.g local tb=self.t.b\n\011\011\011b.t:setcolor(0,0,0)\n\011\011\011b.t:draw()\n\011\011\011b.t:setcolor(tr,tg,tb)\n\011\011else\n\011\011\011b.t:draw()\n\011\011end\n\011end)\n\011b:moveadd(function(self,x,y)\n\011\011self.t:onmove(x,y)\n\011end)\n\011function b:mouseDown(mouseX, mouseY, button, reason)\n\011\011if mouseX >= self.x and mouseX <= self.x2 and mouseY >= self.y and mouseY <= self.y2 then\n\011\011\011self.clicked = true\n\011\011\011return true\n\011\011end\n\011end\n\011function b:mouseMove(mouseX, mouseY, dX, dY)\n\011\011if not (mouseX >= self.x and mouseX <= self.x2 and mouseY >= self.y and mouseY <= self.y2) then\n\011\011\011self.clicked = false\n\011\011end\n\011end\n\011function b:mouseUp(mouseX, mouseY, button, reason)\n\011\011if self.clicked and mouseX >= self.x and mouseX <= self.x2 and mouseY >= self.y and mouseY <= self.y2 then\n\011\011\011self:f()\n\011\011\011return true\n\011\011end\n\011end\n\011return b\nend\n}\nui_chatbox = {\nnew=function(x,y,w,h)\n\011local chat=ui_box.new(x,y,w,h)\n\011chat.moving=false\n\011chat.lastx=0\n\011chat.lasty=0\n\011chat.relx=0\n\011chat.rely=0\n\011chat.shown_lines=math.floor(chat.h/10)-2 --one line for top, one for chat\n\011chat.max_width=chat.w-4\n\011chat.max_lines=200\n\011chat.lines = {}\n\011chat.scrollbar = ui_scrollbar.new(chat.x2-2,chat.y+11,chat.h-22,0,chat.shown_lines)\n\011chat.inputbox = ui_inputbox.new(x,chat.y2-10,w,10)\n\011chat.minimize = ui_button.new(chat.x2-15,chat.y,15,10,function() chat.moving=false chat.inputbox:setfocus(false) L.chatHidden=true TPTMP.chatHidden=true end,\">>\")\n\011chat:drawadd(function(self)\n\011\011local header_pos = self.x+self.w/2-tpt.textwidth(\"TPT Multiplayer\")/2\n\011\011local lastchan_width = tpt.textwidth(lastchan)\n\011\011self.minimize.t.y = self.y+1 -- aligns the minimize button vertically\n\011\011-- channel displayed in the left top corner\n\011\011if lastchan == \"null\" then\n\011\011\011gfx.drawText(self.x+2,self.y+2,'lobby',200,200,0)\n\011\011elseif lastchan == \"guest\" then\n\011\011\011gfx.drawText(self.x+2,self.y+2,'guest lobby',200,200,0)\n\011\011else\n\011\011\011if lastchan_width > self.w - 5 then\n\011\011\011\011while tpt.textwidth(lastchan) > self.w - 5 do\n\011\011\011\011\011lastchan = lastchan:sub(1, #lastchan-1)\n\011\011\011\011end\n\011\011\011\011lastchan = lastchan:sub(1, #lastchan-3) .. '...'\n\011\011\011\011gfx.drawText(self.x+2,self.y+2,lastchan,0,200,200)\n\011\011\011end\n\011\011\011gfx.drawText(self.x+2,self.y+2,lastchan,0,200,200)\n\011\011end\n\011\011if lastchan_width < header_pos - self.x - 15 then\n\011\011\011gfx.drawText(header_pos,self.y+2,\"TPT Multiplayer\")\n\011\011end\n\011\011\n\011\011gfx.drawLine(self.x+1,self.y+10,self.x2-1,self.y+10,120,120,120)\n\011\011self.scrollbar:draw()\n\011\011local count=0\n\011\011for i,line in ipairs(self.lines) do\n\011\011\011if i>self.scrollbar.pos and i<= self.scrollbar.pos+self.shown_lines then\n\011\011\011\011line:draw(self.x+3,self.y+12+(count*10))\n\011\011\011\011count = count+1\n\011\011\011end\n\011\011end\n\011\011self.inputbox:draw()\n\011\011self.minimize:draw()\n\011end)\n\011chat:moveadd(function(self,x,y)\n\011\011for i,line in ipairs(self.lines) do\n\011\011\011line:onmove(x,y)\n\011\011end\n\011\011self.scrollbar:onmove(x,y)\n\011\011self.inputbox:onmove(x,y)\n\011\011self.minimize:onmove(x,y)\n\011end)\n\011function chat:addline(line,r,g,b,noflash)\n\011\011if not line or line==\"\" then return end --No blank lines\n\011\011local linebreak,lastspace = 0,nil\n\011\011for i=0,#line do\n\011\011\011local width = tpt.textwidth(line:sub(linebreak,i+1))\n\011\011\011if width > self.max_width/2 and line:sub(i,i):match(\"[%s,_%.%-?!]\") then\n\011\011\011\011lastspace = i\n\011\011\011end\n\011\011\011if width > self.max_width or i==#line then\n\011\011\011\011local pos = (i==#line or not lastspace) and i or lastspace\n\011\011\011\011table.insert(self.lines,ui_text.new(line:sub(linebreak,pos),self.x,0,r,g,b))\n\011\011\011\011linebreak = pos+1\n\011\011\011\011lastspace = nil\n\011\011\011end\n\011\011end\n\011\011while #self.lines>self.max_lines do table.remove(self.lines,1) end\n\011\011self.scrollbar:update(#self.lines,self.shown_lines,#self.lines-self.shown_lines)\n\011\011if L.chatHidden and not noflash then L.flashChat=true end\n\011end\n\011chat:addline(\"TPTMP v\"..versionstring..\": Type '/connect' to join server, or /list for a list of commands.\",200,200,200,true)\n\011function chat:mouseDown(mouseX, mouseY, button)\n\011\011if L.chatHidden then return false end\n\011\011self.minimize:mouseDown(mouseX, mouseY, button)\n\011\011\n\011\011local selectedLine = math.floor((mouseY - self.y) / 10)\n\011\011-- Mouse outside chat window, defocus it\n\011\011if mouseX < self.x or mouseX > self.x2 or mouseY < self.y or mouseY > self.y2 then\n\011\011\011self.inputbox:setfocus(false)\n\011\011\011return false\n\011\011end\n\n\011\011-- Copy the selected line\n\011\011if button == 3 and selectedLine ~= 0 and selectedLine ~= self.shown_lines+1 and self.lines[self.scrollbar.pos+selectedLine] then\n\011\011\011platform.clipboardPaste(self.lines[self.scrollbar.pos+selectedLine].text)\n\011\011\011tpt.log('Copied to clipboard')\n\011\011end\n\n\011\011-- header was grabbed, enable window movement\n\011\011if selectedLine == 0 and mouseX < self.minimize.x then\n\011\011\011self.moving = true\n\011\011\011self.lastx = mx\n\011\011\011self.lasty = my\n\011\011\011self.relx = mouseX - self.x\n\011\011\011self.rely = mouseY - self.y\n\011\011\011return true\n\011\011-- Textbox clicked\n\011\011elseif selectedLine == self.shown_lines + 1 then\n\011\011\011self.inputbox:setfocus(true)\n\011\011\011return true\n\011\011end\n\n\011\011-- At this point we know chatbox is selected, ensure window is focused then block mouse events\n\011\011if not self.inputbox.focus then\n\011\011\011self.inputbox:setfocus(true)\n\011\011end\n\011\011return true\n\011end\n\011function chat:mouseMove(mouseX, mouseY, dX, dY)\n\011\011if self.moving then\n\011\011\011local newx, newy = self.x + dX, self.y + dY\n\011\011\011if newx < 0 then dX = dX - newx end\n\011\011\011if newy < 0 then dY = dY - newy end\n\011\011\011if (newx + self.w) >= sim.XRES then dX = dX - (newx + self.w - sim.XRES) end\n\011\011\011if (newy + self.h) >= sim.YRES then dY = dY - (newy + self.h - sim.YRES) end\n\n\011\011\011if dX < 0 and mouseX > self.relx + self.x then dX = 0 end\n\011\011\011if dX > 0 and mouseX < self.relx + self.x then dX = 0 end\n\011\011\011if dY < 0 and mouseY > self.rely + self.y then dY = 0 end\n\011\011\011if dY > 0 and mouseY < self.rely + self.y then dY = 0 end\n\011\011\011\n\011\011\011self:onmove(dX, dY)\n\011\011end\n\011\011self.minimize:mouseMove(mouseX, mouseY, dX, dY)\n\011end\n\011function chat:mouseUp(mouseX, mouseY, button, reason)\n\011\011self.minimize:mouseUp(mouseX, mouseY, button, reason)\n\011\011if self.moving then\n\011\011\011self.moving = false\n\011\011\011return true\n\011\011end\n\011end\n\011function chat:mouseWheel(mouseX, mouseY, wheel)\n\011\011self.scrollbar:mouseWheel(mouseX, mouseY, wheel)\n\011end\n\011--commands for chat window\n\011chatcommands = {\n\011connect = function(self,msg,args)\n\011\011if not issocket then self:addline(\"No luasockets found\") return end\n\011\011local newname = pcall(string.dump, get_name) and \"Gue\"..\"st#\"..math[\"random\"](1111,9888) or get_name()\n\011\011local s,r = connectToServer(args[1],tonumber(args[2]), newname~=\"\" and newname or username)\n\011\011if not s then self:addline(r,255,50,50) end\n\011\011pressedKeys = nil\n\011end,\n\011send = function(self,msg,args)\n\011\011if tonumber(args[1]) and args[2] then\n\011\011local withNull=false\n\011\011if args[2]==\"true\" then withNull=true end\n\011\011msg = msg:sub(#args[1]+1+(withNull and #args[2]+2 or 0))\n\011\011conSend(tonumber(args[1]),msg,withNull)\n\011\011end\n\011end,\n\011quit = function(self,msg,args)\n\011\011disconnected(\"Disconnected\")\n\011end,\n\011disconnect = function(self,msg,args)\n\011\011disconnected(\"Disconnected\")\n\011end,\n\011join = function(self,msg,args)\n\011\011if args[1] then\n\011\011\011joinChannel(args[1])\n\011\011end\n\011end,\n\011sync = function(self,msg,args)\n\011\011if con.connected then L.sendScreen=true end --need to send 67 clear screen\n\011\011self:addline(\"Synced screen to server\",255,255,50)\n\011end,\n\011help = function(self,msg,args)\n\011\011if not args[1] then self:addline(\"/help <command>, type /list for a list of commands\") end\n\011\011if args[1] == \"connect\" then self:addline(\"(/connect [ip] [port]) -- connect to a TPT multiplayer server, or no args to connect to the default one\")\n\011\011--elseif args[1] == \"send\" then self:addline(\"(/send <something> <somethingelse>) -- send raw data to the server\") -- send a raw command\n\011\011elseif args[1] == \"quit\" or args[1] == \"disconnect\" then self:addline(\"(/quit, no arguments) -- quit the game\")\n\011\011elseif args[1] == \"join\" then self:addline(\"(/join <channel> -- joins a room on the server\")\n\011\011elseif args[1] == \"sync\" then self:addline(\"(/sync, no arguments) -- syncs your screen to everyone else in the room\")\n\011\011elseif args[1] == \"me\" then self:addline(\"(/me <message>) -- say something in 3rd person\") -- send a raw command\n\011\011elseif args[1] == \"kick\" then self:addline(\"(/kick <nick> <reason>) -- kick a user, only works if you have been in a channel the longest\")\n\011\011elseif args[1] == \"size\" then self:addline(\"(/size <width> <height>) -- sets the size of the chat window\")\n\011\011elseif args[1] == \"clear\" then self:addline(\"(/clear, no arguments) -- clears the chat\")\n\011\011elseif args[1] == \"lobby\" then self:addline(\"(/lobby, no arguments) -- joins the lobby\")\n\011\011end\n\011end,\n\011list = function(self,msg,args)\n\011\011local list = \"\"\n\011\011for name in pairs(chatcommands) do\n\011\011\011list=list..name..\", \"\n\011\011end\n\011\011self:addline(\"Commands: \"..list:sub(1,#list-2))\n\011end,\n\011me = function(self, msg, args)\n\011\011if not con.connected then return end\n\011\011self:addline(\"* \" .. username .. \" \".. table.concat(args, \" \"),200,200,200)\n\011\011conSend(20,table.concat(args, \" \"),true)\n\011end,\n\011kick = function(self, msg, args)\n\011\011if not con.connected then return end\n\011\011if not args[1] then self:addline(\"Need a nick! '/kick <nick> [reason]'\") return end\n\011\011conSend(21, args[1]..\"\\0\"..table.concat(args, \" \", 2),true)\n\011end,\n\011size = function(self, msg, args)\n\011\011if args[2] then\n\011\011\011local w, h = tonumber(args[1]), tonumber(args[2])\n\011\011\011if w < 75 or h < 50 then self:addline(\"size too small\") return\n\011\011\011elseif w > sim.XRES-100 or h > sim.YRES-100 then self:addline(\"size too large\") return\n\011\011\011end\n\011\011\011chatwindow = ui_chatbox.new(100,100,w,h)\n\011\011\011chatwindow:setbackground(10,10,10,235) chatwindow.drawbackground=true\n\011\011\011if using_manager then\n\011\011\011\011MANAGER.savesetting(\"tptmp\", \"width\", w)\n\011\011\011\011MANAGER.savesetting(\"tptmp\", \"height\", h)\n\011\011\011end\n\011\011end\n\011end,\n\011clear = function(self, msg, args)\n\011\011chatwindow.lines = {}\n\011end,\n\011lobby = function(self, msg, args)\n\011\011joinChannel(username:find(\"#\") and \"guest\" or \"null\") -- best effort\n\011end\n\011}\n\011function chat:keypress(key, scan, rep, shift, ctrl, alt)\n\011\011if L.chatHidden then return nil end\n\011\011local text = self.inputbox:keypress(key, scan, rep, shift, ctrl, alt)\n\011\011if text and text~=\"\" then\n\011\011\011local cmd = text:match(\"^/([^%s]+)\")\n\011\011\011if cmd then\n\011\011\011\011local msg=text:sub(#cmd+3)\n\011\011\011\011local args = getArgs(msg)\n\011\011\011\011if chatcommands[cmd] then\n\011\011\011\011\011chatcommands[cmd](self,msg,args)\n\011\011\011\011\011--self:addline(\"Executed \"..cmd..\" \"..rest)\n\011\011\011\011\011return\n\011\011\011\011end\n\011\011\011end\n\011\011\011--normal chat\n\011\011\011if con.connected then\n\011\011\011\011conSend(19,text,true)\n\011\011\011\011self:addline(username .. \": \".. text,200,200,200)\n\011\011\011else\n\011\011\011\011self:addline(\"Not connected to server!\",255,50,50)\n\011\011\011end\n\011\011end\n\011\011if self.inputbox.focus then\n\011\011\011return true\n\011\011end\n\011end\n\011function chat:textinput(text)\n\011\011if L.chatHidden then return end\n\011\011self.inputbox:textinput(text)\n\011end\n\011return chat\nend\n}\nlocal fadeText = {}\n--A little text that fades away, (align text (left/center/right)?)\nlocal function newFadeText(text,frames,x,y,r,g,b,noremove)\n\011local t = {ticks=frames,max=frames,text=text,x=x,y=y,r=r,g=g,b=b,keep=noremove}\n\011t.reset = function(self,text) self.ticks=self.max if text then self.text=text end end\n\011table.insert(fadeText,t)\n\011return t\nend\n--Some text locations for repeated usage\nlocal infoText = newFadeText(\"\",150,245,370,255,255,255,true)\nlocal cmodeText = newFadeText(\"\",120,250,180,255,255,255,true)\n\nlocal function getypos()\n\011local ypos = 136\n\011if jacobsmod and tpt.oldmenu and tpt.oldmenu()==1 then\n\011\011ypos = 392\n\011elseif tpt.num_menus then\n\011\011ypos = 392-16*tpt.num_menus()-(not jacobsmod and 16 or 0)\n\011end\n\011if using_manager then ypos = ypos - 17 end\n\011return ypos\nend\nlocal jacobsmod_old_menu_check = false\nlocal showbutton = ui_button.new(613,getypos(),14,14,function() if using_manager and not MANAGER.hidden then _print(\"minimize the manager before opening TPTMP\") return end if not hooks_enabled then TPTMP.enableMultiplayer() end L.chatHidden=false TPTMP.chatHidden=false L.flashChat=false end,\"Mp\")\nlocal flashCount=0\nshowbutton.drawbox = true showbutton:drawadd(function(self) if L.flashChat then self.almostselected=true flashCount=flashCount+1 if flashCount%25==0 then self.invert=not self.invert end end end)\nif using_manager then\n\011local loadsettings = function() chatwindow = ui_chatbox.new(100, 100, tonumber(MANAGER.getsetting(\"tptmp\", \"width\")), tonumber(MANAGER.getsetting(\"tptmp\", \"height\"))) end\n\011if not pcall(loadsettings) then chatwindow = ui_chatbox.new(100, 100, 225, 150) end\nelse\n\011chatwindow = ui_chatbox.new(100, 100, 225, 150)\nend\nchatwindow:setbackground(10,10,10,150) chatwindow.drawbackground=true\n\nlocal eleNameTable = {\n[\"DEFAULT_PT_LIFE_GOL\"] = 256,[\"DEFAULT_PT_LIFE_HLIF\"] = 257,[\"DEFAULT_PT_LIFE_ASIM\"] = 258,[\"DEFAULT_PT_LIFE_2x2\"] = 259,[\"DEFAULT_PT_LIFE_DANI\"] = 260,\n[\"DEFAULT_PT_LIFE_AMOE\"] = 261,[\"DEFAULT_PT_LIFE_MOVE\"] = 262,[\"DEFAULT_PT_LIFE_PGOL\"] = 263,[\"DEFAULT_PT_LIFE_DMOE\"] = 264,[\"DEFAULT_PT_LIFE_34\"] = 265,\n[\"DEFAULT_PT_LIFE_LLIF\"] = 276,[\"DEFAULT_PT_LIFE_STAN\"] = 267,[\"DEFAULT_PT_LIFE_SEED\"] = 268,[\"DEFAULT_PT_LIFE_MAZE\"] = 269,[\"DEFAULT_PT_LIFE_COAG\"] = 270,\n[\"DEFAULT_PT_LIFE_WALL\"] = 271,[\"DEFAULT_PT_LIFE_GNAR\"] = 272,[\"DEFAULT_PT_LIFE_REPL\"] = 273,[\"DEFAULT_PT_LIFE_MYST\"] = 274,[\"DEFAULT_PT_LIFE_LOTE\"] = 275,\n[\"DEFAULT_PT_LIFE_FRG2\"] = 276,[\"DEFAULT_PT_LIFE_STAR\"] = 277,[\"DEFAULT_PT_LIFE_FROG\"] = 278,[\"DEFAULT_PT_LIFE_BRAN\"] = 279,\n--walls\n[\"DEFAULT_WL_ERASE\"] = 280,[\"DEFAULT_WL_CNDTW\"] = 281,[\"DEFAULT_WL_EWALL\"] = 282,[\"DEFAULT_WL_DTECT\"] = 283,[\"DEFAULT_WL_STRM\"] = 284,\n[\"DEFAULT_WL_FAN\"] = 285,[\"DEFAULT_WL_LIQD\"] = 286,[\"DEFAULT_WL_ABSRB\"] = 287,[\"DEFAULT_WL_WALL\"] = 288,[\"DEFAULT_WL_AIR\"] = 289,[\"DEFAULT_WL_POWDR\"] = 290,\n[\"DEFAULT_WL_CNDTR\"] = 291,[\"DEFAULT_WL_EHOLE\"] = 292,[\"DEFAULT_WL_GAS\"] = 293,[\"DEFAULT_WL_GRVTY\"] = 294,[\"DEFAULT_WL_ENRGY\"] = 295,\n[\"DEFAULT_WL_NOAIR\"] = 296,[\"DEFAULT_WL_ERASEA\"] = 297,[\"DEFAULT_WL_STASIS\"] = 298,\n--special tools\n[\"DEFAULT_UI_SAMPLE\"] = 299,[\"DEFAULT_UI_SIGN\"] = 300,[\"DEFAULT_UI_PROPERTY\"] = 301,[\"DEFAULT_UI_WIND\"] = 302,\n--tools\n[\"DEFAULT_TOOL_HEAT\"] = 303,[\"DEFAULT_TOOL_COOL\"] = 304,[\"DEFAULT_TOOL_AIR\"] = 305,[\"DEFAULT_TOOL_VAC\"] = 306,[\"DEFAULT_TOOL_PGRV\"] = 307,[\"DEFAULT_TOOL_NGRV\"] = 308, [\"DEFAULT_TOOL_MIX\"] = 309,\n--decoration tools\n[\"DEFAULT_DECOR_SET\"] = 310,[\"DEFAULT_DECOR_CLR\"] = 311,[\"DEFAULT_DECOR_ADD\"] = 312,[\"DEFAULT_DECOR_SUB\"] = 313,[\"DEFAULT_DECOR_MUL\"] = 314,[\"DEFAULT_DECOR_DIV\"] = 315,[\"DEFAULT_DECOR_SMDG\"] = 316,\n[\"DEFAULT_DECOR_LIGH\"] = 317, [\"DEFAULT_DECOR_DARK\"] = 318\n}\nlocal gravList= {[0]=\"Vertical\",[1]=\"Off\",[2]=\"Radial\"}\nlocal airList= {[0]=\"On\",[1]=\"Pressure Off\",[2]=\"Velocity Off\",[3]=\"Off\",[4]=\"No Update\"}\nlocal noFlood = {[15]=true,[55]=true,[87]=true,[128]=true,[158]=true}\nlocal noShape = {[55]=true,[87]=true,[128]=true,[158]=true}\nlocal createOverride = {\n\011[55] = function(rx,ry,c) return 0,0,c end,\n\011[87] = function(rx,ry,c) local tmp=rx+ry if tmp>55 then tmp=55 end return 0,0,c+bit.lshift(tmp,8) end,\n\011[88] = function(rx,ry,c) local tmp=rx*4+ry*4+7 if tmp>300 then tmp=300 end return rx,ry,c+bit.lshift(tmp,8) end,\n\011[128] = function(rx,ry,c) return 0,0,c end,\n\011[158] = function(rx,ry,c) return 0,0,c end}\nlocal golStart,golEnd=256,279\nlocal wallStart,wallEnd=280,298\nlocal toolStart,toolEnd=303,309\nlocal decoStart,decoEnd=310,318\n\n--Functions that do stuff in powdertoy\nlocal function createPartsAny(x,y,rx,ry,c,brush,user)\n\011if c>=wallStart then\n\011\011if c<= wallEnd then\n\011\011\011if c == 284 then rx,ry = 0,0 end\n\011\011\011sim.createWalls(x,y,rx,ry,c-wallStart,brush)\n\011\011elseif c<=toolEnd then\n\011\011\011if c>=toolStart then sim.toolBrush(x,y,rx,ry,c-toolStart,brush) end\n\011\011elseif c<= decoEnd then\n\011\011\011sim.decoBrush(x,y,rx,ry,user.dcolour[2],user.dcolour[3],user.dcolour[4],user.dcolour[1],c-decoStart,brush)\n\011\011end\n\011\011return\n\011elseif c>=golStart then\n\011\011c = 78+(c-golStart)*bit.lshift(1, sim.PMAPBITS)\n\011end\n\011if createOverride[c] then\n\011\011rx,ry,c = createOverride[c](rx,ry,c)\n\011end\n\011sim.createParts(x,y,rx,ry,c,brush,user.replacemode)\nend\nlocal function createLineAny(x1,y1,x2,y2,rx,ry,c,brush,user)\n\011if noShape[c] then return end\n\011if jacobsmod and c == tpt.element(\"ball\") and not user.shift then return end\n\011if c>=wallStart then\n\011\011if c<= wallEnd then\n\011\011\011if c == 284 then rx,ry = 0,0 end\n\011\011\011sim.createWallLine(x1,y1,x2,y2,rx,ry,c-wallStart,brush)\n\011\011elseif c<=toolEnd then\n\011\011\011if c>=toolStart then local str=1.0 if user.drawtype==4 then if user.shift then str=10.0 elseif user.alt then str=0.1 end end sim.toolLine(x1,y1,x2,y2,rx,ry,c-toolStart,brush,str) end\n\011\011elseif c<= decoEnd then\n\011\011\011sim.decoLine(x1,y1,x2,y2,rx,ry,user.dcolour[2],user.dcolour[3],user.dcolour[4],user.dcolour[1],c-decoStart,brush)\n\011\011end\n\011\011return\n\011elseif c>=golStart then\n\011\011c = 78+(c-golStart)*bit.lshift(1, sim.PMAPBITS)\n\011end\n\011if createOverride[c] then\n\011\011rx,ry,c = createOverride[c](rx,ry,c)\n\011end\n\011sim.createLine(x1,y1,x2,y2,rx,ry,c,brush,user.replacemode)\nend\nlocal function createBoxAny(x1,y1,x2,y2,c,user)\n\011if noShape[c] then return end\n\011if c>=wallStart then\n\011\011if c<= wallEnd then\n\011\011\011sim.createWallBox(x1,y1,x2,y2,c-wallStart)\n\011\011elseif c<=toolEnd then\n\011\011\011if c>=toolStart then sim.toolBox(x1,y1,x2,y2,c-toolStart) end\n\011\011elseif c<= decoEnd then\n\011\011\011sim.decoBox(x1,y1,x2,y2,user.dcolour[2],user.dcolour[3],user.dcolour[4],user.dcolour[1],c-decoStart)\n\011\011end\n\011\011return\n\011elseif c>=golStart then\n\011\011c = 78+(c-golStart)*bit.lshift(1, sim.PMAPBITS)\n\011end\n\011if createOverride[c] then\n\011\011_,_,c = createOverride[c](user.brushx,user.brushy,c)\n\011end\n\011sim.createBox(x1,y1,x2,y2,c,user and user.replacemode)\nend\nlocal function floodAny(x,y,c,cm,bm,user)\n\011if noFlood[c] then return end\n\011if c>=wallStart then\n\011\011if c<= wallEnd then\n\011\011\011sim.floodWalls(x,y,c-wallStart,bm)\n\011\011end\n\011\011--other tools shouldn't flood\n\011\011return\n\011elseif c>=golStart then --GoL adjust\n\011\011c = 78+(c-golStart)*bit.lshift(1, sim.PMAPBITS)\n\011end\n\011if createOverride[c] then\n\011\011_,_,c = createOverride[c](user.brushx,user.brushy,c)\n\011end\n\011sim.floodParts(x,y,c,cm,user.replacemode)\nend\nlocal function lineSnapCoords(x1,y1,x2,y2)\n\011local nx,ny\n\011local snapAngle = math.floor(math.atan2(y2-y1, x2-x1)/(math.pi*0.25)+0.5)*math.pi*0.25;\n\011local lineMag = math.sqrt(math.pow(x2-x1,2)+math.pow(y2-y1,2));\n\011nx = math.floor(lineMag*math.cos(snapAngle)+x1+0.5);\n\011ny = math.floor(lineMag*math.sin(snapAngle)+y1+0.5);\n\011return nx,ny\nend\n\nlocal function rectSnapCoords(x1,y1,x2,y2)\n\011local nx,ny\n\011local snapAngle = math.floor((math.atan2(y2-y1, x2-x1)+math.pi*0.25)/(math.pi*0.5)+0.5)*math.pi*0.5 - math.pi*0.25;\n\011local lineMag = math.sqrt(math.pow(x2-x1,2)+math.pow(y2-y1,2));\n\011nx = math.floor(lineMag*math.cos(snapAngle)+x1+0.5);\n\011ny = math.floor(lineMag*math.sin(snapAngle)+y1+0.5);\n\011return nx,ny\nend\nlocal function wallSnapCoords(x, y)\n\011return math.floor(x / 4) * 4, math.floor(y / 4) * 4\nend\nlocal renModes = {[0xff00f270]=1,[-16715152]=1,[0x0400f381]=2,[0xf382]=4,[0xf388]=8,[0xf384]=16,[0xfff380]=32,[1]=0xff00f270,[2]=0x0400f381,[4]=0xf382,[8]=0xf388,[16]=0xf384,[32]=0xfff380}\nlocal function getViewModes()\n\011local t={0,0,0}\n\011for k,v in pairs(ren.displayModes()) do\n\011\011t[1] = t[1]+v\n\011end\n\011for k,v in pairs(ren.renderModes()) do\n\011\011t[2] = t[2]+(renModes[v] or 0)\n\011end\n\011t[3] = ren.colorMode()\n\011return t\nend\n\n--clicky click\nlocal function playerMouseClick(id,btn,ev)\n\011local user = con.members[id]\n\011local createE, checkBut\n\n\011--_print(tostring(btn)..tostring(ev))\n\011if ev==0 then return end\n\011-- Mouse up event, TPT will \"draw\" whatever element was last clicked, even if we are releasing a different button\n\011-- This covers the case where we start drawing a line with rmb, switch to lmb, but then release rmb. The lmb element is drawn\n\011if ev == 2 then\n\011\011if user.lbtn then\n\011\011\011createE,checkBut=user.selectedl,user.lbtn\n\011\011elseif user.abtn then\n\011\011\011createE,checkBut=user.selecteda,user.abtn\n\011\011elseif user.rbtn then\n\011\011\011createE,checkBut=user.selectedr,user.rbtn\n\011\011else\n\011\011\011return\n\011\011end\n\011else\n\011\011if btn==1 then\n\011\011\011user.rbtn,user.abtn = false,false\n\011\011\011createE,checkBut=user.selectedl,user.lbtn\n\011\011elseif btn==2 then\n\011\011\011user.rbtn,user.lbtn = false,false\n\011\011\011createE,checkBut=user.selecteda,user.abtn\n\011\011elseif btn==3 then\n\011\011\011user.lbtn,user.abtn = false,false\n\011\011\011createE,checkBut=user.selectedr,user.rbtn\n\011\011else\n\011\011\011return\n\011\011end\n\011end\n\n\011--if user.mousex>=sim.XRES or user.mousey>=sim.YRES then user.drawtype=false return end\n\n\011if ev==1 then\n\011\011if user.mousex >= 0 and user.mousey >= 0 and user.mousex < sim.XRES and user.mousey < sim.YRES then\n\011\011\011user.pmx,user.pmy = user.mousex,user.mousey\n\011\011\011--left box\n\011\011\011if user.ctrl and not user.shift then user.drawtype = 2 return end\n\011\011\011--left line\n\011\011\011if user.shift and not user.ctrl then user.drawtype = 1 return end\n\011\011\011--floodfill\n\011\011\011if user.ctrl and user.shift then floodAny(user.mousex,user.mousey,createE,-1,-1,user) user.drawtype = 3 return end\n\011\011\011--an alt click\n\011\011\011if user.alt then return end\n\011\011\011user.drawtype=4 --normal hold\n\011\011\011createPartsAny(user.mousex,user.mousey,user.brushx,user.brushy,createE,user.brush,user)\n\011\011end\n\011elseif ev==2 and checkBut and user.drawtype then\n\011\011local releaseX, releaseY = user.mousex, user.mousey\n\011\011\n\011\011if user.drawtype==2 then\n\011\011\011if user.alt then user.mousex,user.mousey = rectSnapCoords(user.pmx,user.pmy,releaseX,releaseY) end\n\011\011\011createBoxAny(releaseX,releaseY,user.pmx,user.pmy,createE,user)\n\011\011elseif user.drawtype ~= 3 then\n\011\011\011if user.alt then user.mousex,user.mousey = lineSnapCoords(user.pmx,user.pmy,user.mousex,user.mousey) end\n\011\011\011createLineAny(releaseX,releaseY,user.pmx,user.pmy,user.brushx,user.brushy,createE,user.brush,user)\n\011\011end\n\011\011user.drawtype=false\n\011\011user.pmx,user.pmy = user.mousex,user.mousey\n\011end\nend\n--To draw continued lines\nlocal function playerMouseMove(id)\n\011local user = con.members[id]\n\011local createE, checkBut\n\011if user.lbtn then\n\011\011createE,checkBut=user.selectedl,user.lbtn\n\011elseif user.rbtn then\n\011\011createE,checkBut=user.selectedr,user.rbtn\n\011elseif user.abtn then\n\011\011createE,checkBut=user.selecteda,user.abtn\n\011else return end\n\011if user.drawtype~=4 then if user.drawtype==3 then floodAny(user.mousex,user.mousey,createE,-1,-1,user) end return end\n\011\n\011if user.mousex>=sim.XRES then user.mousex=sim.XRES-1 end\n\011if user.mousey>=sim.YRES then user.mousey=sim.YRES-1 end\n\011createLineAny(user.mousex,user.mousey,user.pmx,user.pmy,user.brushx,user.brushy,createE,user.brush,user)\n\011user.pmx,user.pmy = user.mousex,user.mousey\nend\nlocal function loadStamp(size,x,y,reset)\n\011con.socket:settimeout(10)\n\011local s = con.socket:receive(size)\n\011con.socket:settimeout(0)\n\011if s then\n\011\011local f = io.open(\".tmp.stm\",\"wb\")\n\011\011f:write(s)\n\011\011f:close()\n\011\011if reset then sim.clearSim() end\n\011\011if not sim.loadStamp(\".tmp.stm\",x,y) then\n\011\011\011infoText:reset(\"Error loading stamp\")\n\011\011end\n\011\011os.remove\".tmp.stm\"\n\011else\n\011\011infoText:reset(\"Error loading empty stamp\")\n\011end\nend\nlocal function saveStamp(x, y, w, h)\n\011local stampName = sim.saveStamp(x, y, w, h) or \"errorsavingstamp\"\n\011local fullName = \"stamps/\"..stampName..\".stm\"\n\011return stampName, fullName\nend\nlocal function deleteStamp(name)\n\011if sim.deleteStamp then\n\011\011sim.deleteStamp(name)\n\011else\n\011\011os.remove(\"stamps/\"..name..\".stm\")\n\011end\nend\n\nlocal dataCmds = {\n\011[5] = function()\n\011\011disconnected(conGetNull())\n\011end,\n\011[16] = function()\n\011\011local initialJoin = lastchan == ''\n\011\011lastchan = conGetNull()\n\011\011--room members\n\011\011con.members = {}\n\011\011local amount = cByte()\n\011\011local peeps = {}\n\011\011for i=1,amount do\n\011\011\011local id = cByte()\n\011\011\011con.members[id]={name=conGetNull(),mousex=0,mousey=0,brushx=4,brushy=4,brush=0,selectedl=1,selectedr=0,selecteda=296,replacemode=0,dcolour={0,0,0,0},lbtn=false,abtn=false,rbtn=false,ctrl=false,shift=false,alt=false}\n\011\011\011local name = con.members[id].name\n\011\011\011table.insert(peeps,name)\n\011\011end\n\011\011if not initialJoin then\n\011\011\011chatwindow:addline(\"Joined channel \"..lastchan,50,255,50)\n\011\011end\n\011\011chatwindow:addline(\"Online: \"..table.concat(peeps,\" \"),255,255,50)\n\011end,\n\011[17]= function()\n\011\011local id = cByte()\n\011\011con.members[id] ={name=conGetNull(),mousex=0,mousey=0,brushx=4,brushy=4,brush=0,selectedl=1,selectedr=0,selecteda=296,replacemode=0,dcolour={0,0,0,0},lbtn=false,abtn=false,rbtn=false,ctrl=false,shift=false,alt=false}\n\011\011chatwindow:addline(con.members[id].name..\" has joined\",100,255,100)\n\011end,\n\011[18] = function()\n\011\011local id = cByte()\n\011\011chatwindow:addline(con.members[id].name..\" has left\",255,255,100)\n\011\011con.members[id]=nil\n\011end,\n\011[19] = function()\n\011\011chatwindow:addline(con.members[cByte()].name .. \": \" .. conGetNull())\n\011end,\n\011[20] = function()\n\011\011chatwindow:addline(\"* \"..con.members[cByte()].name .. \" \" .. conGetNull())\n\011end,\n\011[22] = function()\n\011\011chatwindow:addline(\"[SERVER] \"..conGetNull(), cByte(), cByte(), cByte())\n\011end,\n\011--Mouse Position\n\011[32] = function()\n\011\011local id = cByte()\n\011\011local b1,b2,b3=cByte(),cByte(),cByte()\n\011\011con.members[id].mousex,con.members[id].mousey=((b1*16)+math.floor(b2/16)),((b2%16)*256)+b3\n\011\011playerMouseMove(id)\n\011end,\n\011--Mouse Click\n\011[33] = function()\n\011\011local id = cByte()\n\011\011local d=cByte()\n\011\011local btn,ev=math.floor(d/16),d%16\n\011\011-- Fake mouseup due to either blur or zoom window\n\011\011if btn == 0 then\n\011\011\011local user = con.members[id]\n\011\011\011user.lbtn, user.rbtn, user.abtn, user.drawtype = nil, nil, nil, nil\n\011\011\011return\n\011\011end\n\011\011playerMouseClick(id,btn,ev)\n\011\011if ev==0 then return end\n\011\011if ev==2 then ev = nil end\n\011\011if btn==1 then\n\011\011\011con.members[id].lbtn=ev\n\011\011elseif btn==2 then\n\011\011\011con.members[id].abtn=ev\n\011\011elseif btn==3 then\n\011\011\011con.members[id].rbtn=ev\n\011\011end\n\011end,\n\011--Brush size\n\011[34] = function()\n\011\011local id = cByte()\n\011\011con.members[id].brushx,con.members[id].brushy=cByte(),cByte()\n\011end,\n\011--Brush Shape change, no args\n\011[35] = function()\n\011\011local id = cByte()\n\011\011con.members[id].brush=(con.members[id].brush+1)%3\n\011end,\n\011--Modifier (mod and state)\n\011[36] = function()\n\011\011local id = cByte()\n\011\011local d=cByte()\n\011\011local mod,state=math.floor(d/16),d%16~=0\n\011\011if mod==0 then\n\011\011\011con.members[id].ctrl=state\n\011\011elseif mod==1 then\n\011\011\011con.members[id].shift=state\n\011\011elseif mod==2 then\n\011\011\011con.members[id].alt=state\n\011\011end\n\011end,\n\011--selected elements (2 bits button, 14-element)\n\011[37] = function()\n\011\011local id = cByte()\n\011\011local b1,b2=cByte(),cByte()\n\011\011local btn,el=math.floor(b1/64),(b1%64)*256+b2\n\011\011if btn==0 then\n\011\011\011con.members[id].selectedl=el\n\011\011elseif btn==1 then\n\011\011\011con.members[id].selecteda=el\n\011\011elseif btn==2 then\n\011\011\011con.members[id].selectedr=el\n\011\011elseif btn==3 then\n\011\011\011--sync replace mode element between all players since apparently you have to set tpt.selectedreplace to use replace mode ...\n\011\011\011tpt.selectedreplace = elem.property(el, \"Identifier\")\n\011\011end\n\011end,\n\011--replace mode / specific delete\n\011[38] = function()\n\011\011local id = cByte()\n\011\011local mod = cByte()\n\011\011con.members[id].replacemode = mod\n\011end,\n\011--cmode defaults (1 byte mode)\n\011[48] = function()\n\011\011local id = cByte()\n\011\011tpt.display_mode(cByte())\n\011\011cmodeText:reset(con.members[id].name..\" set:\")\n\011end,\n\011--pause set (1 byte state)\n\011[49] = function()\n\011\011local id = cByte()\n\011\011local p,str = cByte(),\"Pause\"\n\011\011tpt.set_pause(p)\n\011\011if p==0 then str=\"Unpause\" end\n\011\011infoText:reset(str..\" from \"..con.members[id].name)\n\011end,\n\011--step frame, no args\n\011[50] = function()\n\011\011local id = cByte()\n\011\011tpt.set_pause(0)\n\011\011L.pauseNextFrame=true\n\011end,\n\011--deco mode, (1 byte state)\n\011[51] = function()\n\011\011local id = cByte()\n\011\011tpt.decorations_enable(cByte())\n\011\011cmodeText:reset(con.members[id].name..\" set:\")\n\011end,\n\011--[[HUD mode, (1 byte state), deprecated\n\011[52] = function()\n\011\011local id = cByte()\n\011\011local hstate = cByte()\n\011\011tpt.hud(hstate)\n\011end,\n\011--]]\n\011--amb heat mode, (1 byte state)\n\011[53] = function()\n\011\011local id = cByte()\n\011\011tpt.ambient_heat(cByte())\n\011end,\n\011--newt_grav mode, (1 byte state)\n\011[54] = function()\n\011\011local id = cByte()\n\011\011tpt.newtonian_gravity(cByte())\n\011end,\n\n\011--[[\n\011--debug mode (1 byte state?) can't implement\n\011[55] = function()\n\011\011local id = cByte()\n\011\011--local dstate = cByte()\n\011\011tpt.setdebug()\n\011end,\n\011--]]\n\011--legacy heat mode, (1 byte state)\n\011[56] = function()\n\011\011local id = cByte()\n\011\011tpt.heat(cByte())\n\011end,\n\011--water equal, (1 byte state)\n\011[57] = function()\n\011\011local id = cByte()\n\011\011sim.waterEqualisation(cByte())\n\011end,\n\n\011--grav mode, (1 byte state)\n\011[58] = function()\n\011\011local id = cByte()\n\011\011local mode = cByte()\n\011\011sim.gravityMode(mode)\n\011\011cmodeText:reset(con.members[id].name..\" set: Gravity: \"..gravList[mode])\n\011end,\n\011--air mode, (1 byte state)\n\011[59] = function()\n\011\011local id = cByte()\n\011\011local mode=cByte()\n\011\011sim.airMode(mode)\n\011\011cmodeText:reset(con.members[id].name..\" set: Air: \"..airList[mode])\n\011end,\n\n\011--clear sparks (no args)\n\011[60] = function()\n\011\011local id = cByte()\n\011\011tpt.reset_spark()\n\011end,\n\011--clear pressure/vel (no args)\n\011[61] = function()\n\011\011local id = cByte()\n\011\011tpt.reset_velocity()\n\011\011tpt.set_pressure()\n\011end,\n\011--invert pressure (no args)\n\011[62] = function()\n\011\011local id = cByte()\n\011\011for x=0,152 do\n\011\011\011for y=0,95 do\n\011\011\011\011sim.pressure(x,y,-sim.pressure(x,y))\n\011\011\011end\n\011\011end\n\011end,\n\011--Clearsim button (no args)\n\011[63] = function()\n\011\011local id = cByte()\n\011\011sim.clearSim()\n\011\011L.lastSave=nil\n\011\011infoText:reset(con.members[id].name..\" cleared the screen\")\n\011end,\n\011--Full graphics view mode (for manual changes in display menu) (3 bytes)\n\011[64] = function()\n\011\011local id = cByte()\n\011\011local disM,renM,colM = cByte(),cByte(),cByte()\n\011\011ren.displayModes({disM})\n\011\011local t,i={},1\n\011\011while i<=32 do\n\011\011\011if bit.band(renM,i)>0 then table.insert(t,renModes[i]) end\n\011\011\011i=i*2\n\011\011end\n\011\011ren.renderModes(t)\n\011\011ren.colorMode(colM)\n\011end,\n\011--Selected deco colour (4 bytes)\n\011[65] = function()\n\011\011local id = cByte()\n\011\011con.members[id].dcolour = {cByte(),cByte(),cByte(),cByte()}\n\011end,\n\011--Recieve a stamp, with location (6 bytes location(3),size(3))\n\011[66] = function()\n\011\011local id = cByte()\n\011\011local b1,b2,b3=cByte(),cByte(),cByte()\n\011\011local x,y =((b1*16)+math.floor(b2/16)),((b2%16)*256)+b3\n\011\011local d = cByte()*65536+cByte()*256+cByte()\n\011\011loadStamp(d,x,y,false)\n\011\011infoText:reset(\"Stamp from \"..con.members[id].name)\n\011end,\n\011--Clear an area, helper for cut (6 bytes, start(3), end(3))\n\011[67] = function()\n\011\011local id = cByte()\n\011\011local b1,b2,b3,b4,b5,b6=cByte(),cByte(),cByte(),cByte(),cByte(),cByte()\n\011\011local x1,y1 =((b1*16)+math.floor(b2/16)),((b2%16)*256)+b3\n\011\011local x2,y2 =((b4*16)+math.floor(b5/16)),((b5%16)*256)+b6\n\011\011sim.clearRect(x1,y1,x2-x1+1,y2-y1+1)\n\011end,\n\011--Edge mode (1 byte state)\n\011[68] = function()\n\011\011local id = cByte()\n\011\011sim.edgeMode(cByte())\n\011end,\n\011--Load a save ID (3 bytes ID)\n\011[69] = function()\n\011\011local id = cByte()\n\011\011local saveID = cByte()*65536+cByte()*256+cByte()\n\011\011L.lastSave=saveID\n\011\011sim.loadSave(saveID,1)\n\011end,\n\011--Reload sim(from a stamp right now, no args)\n\011[70] = function()\n\011\011local id = cByte()\n\011\011sim.reloadSave()\n\011\011infoText:reset(con.members[id].name..\" reloaded the save\")\n\011end,\n\011--A request to sync a player, from server, send screen, and various settings\n\011[128] = function()\n\011\011local id = cByte()\n\011\011conSend(130,string.char(id,49,tpt.set_pause()))\n\011\011local stampName,fullName = saveStamp(0,0,sim.XRES-1,sim.YRES-1)\n\011\011local f = assert(io.open(fullName,\"rb\"))\n\011\011local s = f:read\"*a\"\n\011\011f:close()\n\011\011deleteStamp(stampName)\n\011\011local d = #s\n\011\011conSend(128,string.char(id,math.floor(d/65536),math.floor(d/256)%256,d%256)..s)\n\011\011conSend(130,string.char(id,53,tpt.ambient_heat()))\n\011\011conSend(130,string.char(id,54,tpt.newtonian_gravity()))\n\011\011conSend(130,string.char(id,56,tpt.heat()))\n\011\011conSend(130,string.char(id,57,sim.waterEqualisation()))\n\011\011conSend(130,string.char(id,58,sim.gravityMode()))\n\011\011conSend(130,string.char(id,59,sim.airMode()))\n\011\011conSend(130,string.char(id,68,sim.edgeMode()))\n\011\011conSend(64,string.char(unpack(getViewModes())))\n\011\011conSend(34,string.char(tpt.brushx,tpt.brushy))\n\011end,\n\011--Recieve sync stamp\n\011[129] = function()\n\011\011local d = cByte()*65536+cByte()*256+cByte()\n\011\011loadStamp(d,0,0,true)\n\011end,\n}\n\nlocal function connectThink()\n\011if not con.connected then return end\n\011if not con.socket then disconnected() return end\n\011--read all messages\n\011while 1 do\n\011\011local s,r = con.socket:receive(1)\n\011\011if s then\n\011\011\011local cmd = string.byte(s)\n\011\011\011--_print(\"GOT \"..tostring(cmd))\n\011\011\011if dataCmds[cmd] then dataCmds[cmd]() else _print(\"TPTMP: Unknown protocol \"..tostring(cmd),255,20,20) end\n\011\011else\n\011\011\011if r ~= \"timeout\" then disconnected() end\n\011\011\011break\n\011\011end\n\011end\n\n\011--ping every minute\n\011if os.time()>con.pingTime then conSend(2) con.pingTime=os.time()+60 end\nend\n--Track if we have STKM2 out, for WASD key changes\nelements.property(128,\"Update\",function() L.stick2=true end)\n\nlocal function drawStuff()\n\011if con.members then\n\011\011for i,user in pairs(con.members) do\n\011\011\011local x,y = user.mousex,user.mousey\n\011\011\011local brx,bry=user.brushx,user.brushy\n\011\011\011local brush,drawBrush=user.brush,true\n\011\011\011gfx.drawText(x,y,(\"%s %dx%d\"):format(user.name,brx,bry),0,255,0,192)\n\n\011\011\011-- Draw player cursors\n\011\011\011if user.drawtype==1 then\n\011\011\011\011if user.alt then x,y = lineSnapCoords(user.pmx,user.pmy,x,y) end\n\011\011\011\011gfx.drawLine(user.pmx,user.pmy,x,y,0,255,0,128)\n\011\011\011elseif user.drawtype==2 then\n\011\011\011\011if user.alt then x,y = rectSnapCoords(user.pmx,user.pmy,x,y) end\n\011\011\011\011local tpmx,tpmy = user.pmx,user.pmy\n\011\011\011\011if tpmx>x then tpmx,x=x,tpmx end\n\011\011\011\011if tpmy>y then tpmy,y=y,tpmy end\n\011\011\011\011gfx.drawRect(tpmx,tpmy,x-tpmx+1,y-tpmy+1,0,255,0,128)\n\011\011\011\011drawBrush=false\n\011\011\011elseif user.drawtype==3 or (user.shift and user.ctrl) then\n\011\011\011\011gfx.drawLine(x,y,x+5,y,0,255,0,128)\n\011\011\011\011gfx.drawLine(x,y,x-5,y,0,255,0,128)\n\011\011\011\011gfx.drawLine(x,y,x,y+5,0,255,0,128)\n\011\011\011\011gfx.drawLine(x,y,x,y-5,0,255,0,128)\n\011\011\011\011drawBrush=false\n\011\011\011end\n\n\011\011\011if drawBrush then\n\011\011\011\011if user.selectedl >= wallStart and user.selectedl <= wallEnd then\n\011\011\011\011\011local blockX, blockY = wallSnapCoords(x, y)\n\011\011\011\011\011local blockRadX, blockRadY = wallSnapCoords(brx, bry)\n\011\011\011\011\011\n\011\011\011\011\011local x1, y1 = blockX - blockRadX, blockY - blockRadY\n\011\011\011\011\011local x2, y2 = blockX + blockRadX + 3, blockY + blockRadY + 3\n\011\011\011\011\011gfx.drawRect(x1, y1, x2 - x1, y2 - y1)\n\011\011\011\011elseif brush==0 then\n\011\011\011\011\011gfx.drawCircle(x,y,brx,bry,0,255,0,128)\n\011\011\011\011elseif brush==1 then\n\011\011\011\011\011gfx.drawRect(x-brx,y-bry,brx*2+1,bry*2+1,0,255,0,128)\n\011\011\011\011elseif brush==2 then\n\011\011\011\011\011gfx.drawLine(x-brx,y+bry,x,y-bry,0,255,0,128)\n\011\011\011\011\011gfx.drawLine(x-brx,y+bry,x+brx,y+bry,0,255,0,128)\n\011\011\011\011\011gfx.drawLine(x,y-bry,x+brx,y+bry,0,255,0,128)\n\011\011\011\011end\n\011\011\011end\n\011\011end\n\011end\n\011for k,v in pairs(fadeText) do\n\011\011if v.ticks > 0 then\n\011\011\011local a = math.floor(255*(v.ticks/v.max))\n\011\011\011gfx.drawText(v.x,v.y,v.text,v.r,v.g,v.b,a)\n\011\011\011v.ticks = v.ticks-1\n\011\011else if not v.keep then table.remove(fadeText,k) end\n\011\011end\n\011end\nend\n\nlocal function sendStuff()\n\011if not con.connected then return end\n\011if tpt.brushx > 255 then tpt.brushx = 255 end\n\011if tpt.brushy > 255 then tpt.brushy = 255 end\n\011local nbx,nby = tpt.brushx,tpt.brushy\n\011if L.brushx~=nbx or L.brushy~=nby then\n\011\011L.brushx,L.brushy = nbx,nby\n\011\011conSend(34,string.char(L.brushx,L.brushy))\n\011end\n\011--check selected elements\n\011local nsell,nsela,nselr,nselrep = elements[tpt.selectedl] or eleNameTable[tpt.selectedl],elements[tpt.selecteda] or eleNameTable[tpt.selecteda],elements[tpt.selectedr] or eleNameTable[tpt.selectedr],elements[tpt.selectedreplace] or eleNameTable[tpt.selectedreplace]\n\011if L.sell~=nsell then\n\011\011L.sell=nsell\n\011\011if nsell == nil then\n\011\011\011_print(\"Unsupported wall/tool \"..tpt.selectedl)\n\011\011else\n\011\011\011conSend(37,string.char(math.floor(L.sell/256),L.sell%256))\n\011\011end\n\011elseif L.sela~=nsela then\n\011\011L.sela=nsela\n\011\011if nsela == nil then\n\011\011\011_print(\"Unsupported wall/tool \"..tpt.selecteda)\n\011\011else\n\011\011\011conSend(37,string.char(math.floor(64 + L.sela/256),L.sela%256))\n\011\011end\n\011elseif L.selr~=nselr then\n\011\011L.selr=nselr\n\011\011if nselr == nil then\n\011\011\011_print(\"Unsupported wall/tool \"..tpt.selectedr)\n\011\011else\n\011\011\011conSend(37,string.char(math.floor(128 + L.selr/256),L.selr%256))\n\011\011end\n\011elseif L.selrep~=nselrep then\n\011\011L.selrep=nselrep\n\011\011if nselrep == nil then\n\011\011\011_print(\"Unsupported wall/tool \"..tpt.selectedreplace)\n\011\011else\n\011\011\011conSend(37,string.char(math.floor(192 + L.selrep/256),L.selrep%256))\n\011\011end\n\011end\n\011local ncol = sim.decoColour()\n\011if L.dcolour~=ncol then\n\011\011L.dcolour=ncol\n\011\011conSend(65,string.char(math.floor(ncol/16777216),math.floor(ncol/65536)%256,math.floor(ncol/256)%256,ncol%256))\n\011end\n\n\011--Tell others to open this save ID, or send screen if opened local browser\n\011if L.browseMode==1 then\n\011\011--loaded online save\n\011\011local id=sim.getSaveID()\n\011\011if L.lastSave~=id then\n\011\011\011L.lastSave=id\n\011\011\011conSend(69,string.char(math.floor(id/65536),math.floor(id/256)%256,id%256))\n\011\011end\n\011\011L.browseMode=nil\n\011elseif L.browseMode==2 then\n\011\011--loaded local save (should probably clear sim first instead?)\n\011\011L.sendScreen=true\n\011\011L.browseMode=nil\n\011end\n\n\011--Send screen (or an area for known size) for stamps\n\011if jacobsmod and L.sendScreen == 2 then\n\011\011L.sendScreen = true\n\011elseif L.sendScreen then\n\011\011local x,y,w,h = 0,0,sim.XRES-1,sim.YRES-1\n\011\011if L.smoved then\n\011\011\011local stm\n\011\011\011if L.copying then stm=L.lastCopy else stm=L.lastStamp end\n\011\011\011if L.rotate then stm.w,stm.h=stm.h,stm.w end\n\011\011\011x,y,w,h = math.floor((L.mousex-stm.w/2)/4)*4,math.floor((L.mousey-stm.h/2)/4)*4,stm.w,stm.h\n\011\011\011L.smoved=false\n\011\011\011L.copying=false\n\011\011end\n\011\011L.sendScreen=false\n\011\011local stampName,fullName = saveStamp(x,y,w,h)\n\011\011local f = assert(io.open(fullName,\"rb\"))\n\011\011local s = f:read\"*a\"\n\011\011f:close()\n\011\011deleteStamp(stampName)\n\011\011local d = #s\n\011\011local b1,b2,b3 = math.floor(x/16),((x%16)*16)+math.floor(y/256),(y%256)\n\011\011conSend(67,string.char(math.floor(x/16),((x%16)*16)+math.floor(y/256),(y%256),math.floor((x+w)/16),(((x+w)%16)*16)+math.floor((y+h)/256),((y+h)%256)))\n\011\011conSend(66,string.char(b1,b2,b3,math.floor(d/65536),math.floor(d/256)%256,d%256)..s)\n\011\011conSend(49,string.char(tpt.set_pause()))\n\011end\n\n\011--Check if custom modes were changed\n\011if jacobsmod and L.checkRen == 2 then\n\011\011L.checkRen = true\n\011elseif L.checkRen then\n\011\011L.checkRen=false\n\011\011local t,send=getViewModes(),false\n\011\011for k,v in pairs(t) do\n\011\011\011if v~=L.pModes[k] then\n\011\011\011\011send=true break\n\011\011\011end\n\011\011end\n\011\011if send then conSend(64,string.char(t[1],t[2],t[3])) end\n\011end\n\n\011--Send option menu settings\n\011if L.checkOpt then\n\011\011L.checkOpt=false\n\011\011conSend(49,string.char(tpt.set_pause()))\n\011\011conSend(56,string.char(tpt.heat()))\n\011\011conSend(53,string.char(tpt.ambient_heat()))\n\011\011conSend(54,string.char(tpt.newtonian_gravity()))\n\011\011conSend(57,string.char(sim.waterEqualisation()))\n\011\011conSend(58,string.char(sim.gravityMode()))\n\011\011conSend(59,string.char(sim.airMode()))\n\011\011conSend(68,string.char(sim.edgeMode()))\n\011end\n\nend\nlocal function updatePlayers()\n\011if con.members then\n\011\011for k,v in pairs(con.members) do\n\011\011\011playerMouseMove(k)\n\011\011end\n\011end\n\011--Keep last frame of stick2\n\011L.lastStick2=L.stick2\n\011L.stick2=false\nend\n\nlocal pressedKeys\nlocal function step()\n\011if jacobsmod_old_menu_check then showbutton:onmove(0, getypos()-showbutton.y) end\n\011if not L.chatHidden then chatwindow:draw() else showbutton:draw() end\n\011if hooks_enabled then\n\011\011drawStuff()\n\011\011sendStuff()\n\011\011if L.pauseNextFrame then L.pauseNextFrame=false tpt.set_pause(1) end\n\011\011connectThink()\n\011\011updatePlayers()\n\011end\nend\n\n--some button locations that emulate tpt, return false will disable button\nlocal tpt_buttons = {\n\011[\"open\"] = {x1=1, y1=408, x2=17, y2=422, f=function() if not L.ctrl then L.browseMode=1 else L.browseMode=2 end L.lastSave=sim.getSaveID() end},\n\011[\"rload\"] = {x1=19, y1=408, x2=35, y2=422, f=function()\n\011\011if L.lastSave then\n\011\011\011if L.ctrl then\n\011\011\011\011infoText:reset(\"If you re-opened the save, please type /sync\")\n\011\011\011else\n\011\011\011\011conSend(70)\n\011\011\011\011infoText:reset(\"Sent sync\")\n\011\011\011end\n\011\011else\n\011\011\011--[[infoText:reset(\"Reloading local saves is not synced currently. Type /sync\")]]\n\011\011\011L.checkOpt = true\n\011\011\011L.sendScreen = true\n\011\011end\n\011end},\n\011[\"clear\"] = {x1=470, y1=408, x2=486, y2=422, f=function() conSend(63) L.lastSave=nil end},\n\011[\"opts\"] = {x1=581, y1=408, x2=595, y2=422, f=function() L.checkOpt=true end},\n\011[\"disp\"] = {x1=597, y1=408, x2=611, y2=422, f=function() L.checkRen=true L.pModes=getViewModes() end},\n\011[\"pause\"] = {x1=gfx.WIDTH-16, y1=408, x2=gfx.WIDTH-2, y2=422, f=function() conSend(49,tpt.set_pause()==0 and \"\\1\" or \"\\0\") end},\n\011[\"deco\"] = {x1=gfx.WIDTH-16, y1=33, x2=gfx.WIDTH-2, y2=47, f=function() if jacobsmod and (L.tabs or L.ctrl) then return end conSend(51,tpt.decorations_enable()==0 and \"\\1\" or \"\\0\") end},\n\011[\"newt\"] = {x1=gfx.WIDTH-16, y1=49, x2=gfx.WIDTH-2, y2=63, f=function() if jacobsmod and (L.tabs or L.ctrl) then return end conSend(54,tpt.newtonian_gravity()==0 and \"\\1\" or \"\\0\") end},\n\011[\"ambh\"] = {x1=gfx.WIDTH-16, y1=65, x2=gfx.WIDTH-2, y2=79, f=function() if jacobsmod and (L.tabs or L.ctrl) then return end conSend(53,tpt.ambient_heat()==0 and \"\\1\" or \"\\0\") end},\n}\nif jacobsmod then\n\011tpt_buttons[\"tab\"] = {x1=gfx.WIDTH-16, y1=1, x2=gfx.WIDTH-2, y2=15, f=function() L.tabs = not L.tabs end}\n\011tpt_buttons[\"tabs\"] = {x1=gfx.WIDTH-16, y1=17, x2=gfx.WIDTH-2, y2=147, f=function() if L.tabs or L.ctrl then L.sendScreen = true end end}\n\011tpt_buttons[\"opts\"] = {x1=465, y1=408, x2=479, y2=422, f=function() L.checkOpt=true end}\n\011tpt_buttons[\"clear\"] = {x1=481, y1=408, x2=497, y2=422, f=function() conSend(63) L.lastSave=nil end}\n\011tpt_buttons[\"disp\"] = {x1=595, y1=408, x2=611, y2=422,f=function() L.checkRen=2 L.pModes=getViewModes() end}\n\011tpt_buttons[\"open\"] = {x1=1, y1=408, x2=17, y2=422, f=function() if not L.ctrl then L.browseMode=1 else L.browseMode=2 end L.lastSave=sim.getSaveID() end}\nend\n\nlocal function inZoomWindow(x, y)\n\011if not L.isDrawing and (x < 0 or x >= sim.XRES or y < 0 or y >= sim.YRES) then\n\011\011return false\n\011end\n\011local snappedX, snappedY = x, y\n\011-- When the mouse is outside the window, TPT will snap coords to simulation area then check for zoom window\n\011if snappedX < 0 then snappedX = 0 elseif snappedX >= sim.XRES then snappedX = sim.XRES end\n\011if snappedY < 0 then snappedY = 0 elseif snappedY >= sim.YRES then snappedY = sim.YRES end\n\011local zoomX, zoomY = sim.adjustCoords(snappedX, snappedY)\n\011return zoomX ~= x or zoomY ~= y\nend\n\nlocal function sendMouseUpdate(mouseX, mouseY)\n\011L.realMouseX, L.realMouseY = mouseX, mouseY\n\011if inZoomWindow(mouseX, mouseY) then\n\011\011mouseX, mouseY = sim.adjustCoords(mouseX, mouseY)\011\n\011else\n\011\011if mouseX < 0 then mouseX = 0 end\n\011\011if mouseY < 0 then mouseY = 0 end\n\011\011if mouseX > gfx.WIDTH then mouseX = gfx.WIDTH end\n\011\011if mouseY > gfx.HEIGHT then mouseY = gfx.HEIGHT end\n\011end\n\n\011if L.mousex ~= mouseX or L.mousey ~= mouseY then\n\011\011local b1, b2, b3 = math.floor(mouseX / 16), ((mouseX % 16) * 16) + math.floor(mouseY / 256), (mouseY % 256)\n\011\011conSend(32, string.char(b1, b2, b3))\n\011\011L.mousex, L.mousey = mouseX, mouseY\n\011end\nend\n\nlocal function mouseDown(mouseX, mouseY, button)\n\011if L.chatHidden then\n\011\011showbutton:mouseDown(mouseX, mouseY, button)\n\011\011if not hooks_enabled then\n\011\011\011return true\n\011\011end\n\011end\n\011if L.stamp and button == 1 then\n\011\011L.stampx, L.stampy = mouseX, mouseY\n\011\011return true\n\011end\n\011if L.stamp or L.placeStamp then\n\011\011return true\n\011end\n\011if L.skipClick then\n\011\011L.skipClick = false\n\011\011return true\n\011end\n\011if chatwindow:mouseDown(mouseX, mouseY, button) then\n\011\011return false\n\011end\n\n\011sendMouseUpdate(mouseX, mouseY)\n\011local obut, oevnt = L.mButt, L.mEvent\n\011if button ~= obut or 1 ~= oevnt then\n\011\011L.mButt, L.mEvent = button, 1\n\011\011if mouseX >= 0 and mouseY >= 0 and mouseX < sim.XRES and mouseY < sim.YRES then\n\011\011\011L.isDrawing = true\n\011\011end\n\011\011conSend(33, string.char(L.mButt * 16 + L.mEvent))\n\011end\n\011\n\011-- Click inside button first\n\011if button==1 then\n\011\011for k, v in pairs(tpt_buttons) do\n\011\011\011if mouseX >= v.x1 and mouseX <= v.x2 and mouseY >= v.y1 and mouseY <= v.y2 then\n\011\011\011\011v.downInside = true\n\011\011\011end\n\011\011end\n\011end\nend\n\nlocal function mouseUp(mouseX, mouseY, button, reason)\n\011if L.chatHidden then\n\011\011showbutton:mouseUp(mouseX, mouseY, button)\n\011\011if not hooks_enabled then\n\011\011\011return true\n\011\011end\n\011end\n\011if L.stamp then\n\011\011if L.skipClick then\n\011\011\011L.skipClick = false\n\011\011\011return true\n\011\011end\n\011\011--stamp has been saved, make our own copy\n\011\011if button==1 then\n\011\011\011--save stamp ourself for data, delete it\n\011\011\011local sx,sy = mouseX, mouseY\n\011\011\011if sx<L.stampx then L.stampx,sx=sx,L.stampx end\n\011\011\011if sy<L.stampy then L.stampy,sy=sy,L.stampy end\n\011\011\011--cheap cut hook to send a clear\n\011\011\011if L.copying==1 then\n\011\011\011\011--maybe this is ctrl+x? 67 is clear area\n\011\011\011\011conSend(67,string.char(math.floor(L.stampx/16),((L.stampx%16)*16)+math.floor(L.stampy/256),(L.stampy%256),math.floor(sx/16),((sx%16)*16)+math.floor(sy/256),(sy%256)))\n\011\011\011end\n\011\011\011local w,h = sx-L.stampx,sy-L.stampy\n\011\011\011local stampName,fullName = saveStamp(L.stampx,L.stampy,w,h)\n\011\011\011sx,sy,L.stampx,L.stampy = math.ceil((sx+1)/4)*4,math.ceil((sy+1)/4)*4,math.floor(L.stampx/4)*4,math.floor(L.stampy/4)*4\n\011\011\011w,h = sx-L.stampx, sy-L.stampy\n\011\011\011local f = assert(io.open(fullName,\"rb\"))\n\011\011\011if L.copying then L.lastCopy = {data=f:read\"*a\",w=w,h=h} else L.lastStamp = {data=f:read\"*a\",w=w,h=h} end\n\011\011\011f:close()\n\011\011\011deleteStamp(stampName)\n\011\011end\n\011\011L.stamp=false\n\011\011L.copying=false\n\011end\n\011if L.placeStamp and reason == 0 then\n\011\011if L.skipClick then\n\011\011\011L.skipClick=false\n\011\011\011return true\n\011\011end\n\011\011if button==1 then\n\011\011\011local stm\n\011\011\011if L.copying then stm=L.lastCopy else stm=L.lastStamp end\n\011\011\011if stm then\n\011\011\011\011if not stm.data then\n\011\011\011\011\011--unknown stamp, send full screen on next step, how can we read last created stamp, timestamps on files?\n\011\011\011\011\011L.sendScreen = (jacobsmod and 2 or true)\n\011\011\011\011else\n\011\011\011\011\011--send the stamp\n\011\011\011\011\011if L.smoved then\n\011\011\011\011\011\011--moved from arrows or rotate, send area next frame\n\011\011\011\011\011\011L.placeStamp=false\n\011\011\011\011\011\011L.sendScreen=true\n\011\011\011\011\011\011return true\n\011\011\011\011\011end\n\011\011\011\011\011local sx,sy = mouseX-math.floor(stm.w/2),mouseY-math.floor((stm.h)/2)\n\011\011\011\011\011if sx<0 then sx=0 end\n\011\011\011\011\011if sy<0 then sy=0 end\n\011\011\011\011\011if sx+stm.w>sim.XRES-1 then sx=sim.XRES-stm.w end\n\011\011\011\011\011if sy+stm.h>sim.YRES-1 then sy=sim.YRES-stm.h end\n\011\011\011\011\011local b1,b2,b3 = math.floor(sx/16),((sx%16)*16)+math.floor(sy/256),(sy%256)\n\011\011\011\011\011local d = #stm.data\n\011\011\011\011\011conSend(66,string.char(b1,b2,b3,math.floor(d/65536),math.floor(d/256)%256,d%256)..stm.data)\n\011\011\011\011end\n\011\011\011end\n\011\011end\n\011\011L.placeStamp=false\n\011\011L.copying=false\n\011end\n\011\n\011if L.skipClick then\n\011\011L.skipClick = false\n\011\011return true\n\011end\n\011if chatwindow:mouseUp(mouseX, mouseY, button, reason) then\n\011\011return false\n\011end\n\n\011-- Ignore fake mouseups due to blur (don't send 0, 0 coordinate)\n\011-- Also ignore fake mouseups due to going into / outside of zoom window\n\011-- In both cases, tell other clients we're no longer holding the mouse, without causing it to draw the line\n\011if reason == 1 or reason == 2 then\n\011\011L.mButt, L.mEvent = button, 2\n\011\011L.isDrawing = false\n\011\011conSend(33, string.char(0 * 16 + L.mEvent))\n\011\011return\n\011end\n\n\011sendMouseUpdate(mouseX, mouseY)\n\011local obut, oevnt = L.mButt, L.mEvent\n\011if button ~= obut or 2 ~= oevnt then\n\011\011L.isDrawing = false\n\011\011L.mButt, L.mEvent = button, 2\n\011\011conSend(33, string.char(L.mButt * 16 + L.mEvent))\n\011end\n\n\011-- Up inside the button we started with\n\011if button == 1 then\n\011\011local ret = true\n\011\011for k,v in pairs(tpt_buttons) do\n\011\011\011if v.downInside and (mouseX>=v.x1 and mouseX<=v.x2 and mouseY>=v.y1 and mouseY<=v.y2) then\n\011\011\011\011if v.f() == false then ret = false end\n\011\011\011end\n\011\011\011v.downInside = nil\n\011\011end\n\011\011return ret\n\011end\nend\n\nlocal function mouseMove(mouseX, mouseY, dX, dY)\n\011if L.chatHidden then\n\011\011showbutton:mouseMove(mouseX, mouseY, dX, dY)\n\011\011if not hooks_enabled then\n\011\011\011return true\n\011\011end\n\011end\n\011if chatwindow:mouseMove(mouseX, mouseY, dX, dY) then\n\011\011return false\n\011end\n\n\011-- Always send mouse update, unless we're currently drawing and entered/exited the zoom window\n\011-- TPT sends a fake mouseup event in this case, but the mouse move happens first so we need to stop it ourselves\n\011local shouldBlockMove = L.isDrawing and not inZoomWindow(mouseX, mouseY) ~= inZoomWindow(L.realMouseX, L.realMouseY)\n\011if shouldBlockMove then\n\011\011L.isDrawing = false\n\011else\n\011\011sendMouseUpdate(mouseX, mouseY)\n\011end\n\n\011--Mouse hold, we MUST stay inside button or don't trigger on up\n\011if button == 1 then\n\011\011for k, v in pairs(tpt_buttons) do\n\011\011\011if v.downInside and (mouseX < v.x1 or mouseX > v.x2 or mouseY < v.y1 or mouseY > v.y2) then\n\011\011\011\011v.downInside = nil\n\011\011\011end\n\011\011end\n\011end\nend\n\nlocal function mouseWheel(mouseX, mouseY, wheel)\n\011if chatwindow.inputbox.focus and chatwindow:mouseWheel(mousex, mousey, wheel) then\n\011\011return false\n\011end\nend\n\nlocal keyFuncs = {\n\011--TAB\n\011[9] = function() if not jacobsmod or not L.ctrl then conSend(35) end end,\n\n\011--View modes 0-9\n\011[48] = function() conSend(48,\"\\10\") end,\n\011[49] = function() if L.shift then conSend(48,\"\\9\") tpt.display_mode(9)--[[force local display mode, screw debug check for now]] return false end conSend(48,\"\\0\") end,\n\011[50] = function() conSend(48,\"\\1\") end,\n\011[51] = function() conSend(48,\"\\2\") end,\n\011[52] = function() conSend(48,\"\\3\") end,\n\011[53] = function() conSend(48,\"\\4\") end,\n\011[54] = function() conSend(48,\"\\5\") end,\n\011[55] = function() conSend(48,\"\\6\") end,\n\011[56] = function() conSend(48,\"\\7\") end,\n\011[57] = function() conSend(48,\"\\8\") end,\n\n\011-- ins / del for replace mode\n\011[1073741897] = function() L.replacemode = bit.bxor(L.replacemode, 1) conSend(38, L.replacemode) end,\n\011[127] = function() L.replacemode = bit.bxor(L.replacemode, 2) conSend(38, L.replacemode) end,\n\n\011--Arrows for stamp adjust\n\011[273] = function() if L.placeStamp then L.smoved=true end end,\n\011[274] = function() if L.placeStamp then L.smoved=true end end,\n\011[275] = function() if L.placeStamp then L.smoved=true end end,\n\011[276] = function() if L.placeStamp then L.smoved=true end end\n}\n\nlocal scanFuncs = {\n\011--`, console\n\011[53] = function() if not L.shift and con.connected then infoText:reset(\"Console does not sync, use shift+` to open instead\") return false else jacobsmod_old_menu_check = true end end,\n\n\011--b, deco, pauses sim\n\011[5] = function() if L.ctrl then conSend(51,tpt.decorations_enable()==0 and \"\\1\" or \"\\0\") else conSend(49,\"\\1\") conSend(51,\"\\1\") end end,\n\n\011--c, copy\n\011[6] = function() if L.ctrl then L.stamp=true L.copying=true L.stampx = -1 L.stampy = -1 end end,\n\n\011--d key, debug, api broken right now\n\011--[7] = function() conSend(55) end,\n\n\011--F, frame step\n\011[9] = function() if not jacobsmod or not L.ctrl then conSend(50) end end,\n\n\011--H, HUD and intro text\n\011[11] = function() if L.ctrl and jacobsmod then return false end end,\n\n\011--I, invert pressure\n\011[12] = function() conSend(62) end,\n\n\011--K, stamp menu, abort our known stamp, who knows what they picked, send full screen?\n\011[14] = function() L.lastStamp={data=nil,w=0,h=0} L.placeStamp=true end,\n\n\011--L, last Stamp\n\011[15] = function() if L.lastStamp then L.placeStamp=true end end,\n\n\011--N, newtonian gravity or new save\n\011[17] = function() if jacobsmod and L.ctrl then L.sendScreen=2 L.lastSave=nil else conSend(54,tpt.newtonian_gravity()==0 and \"\\1\" or \"\\0\") end end,\n\n\011--O, old menu in jacobs mod\n\011[18] = function() if jacobsmod and not L.ctrl then jacobsmod_old_menu_check = true end end,\n\n\011--R, for stamp rotate or save reload\n\011[21] = function()\n\011\011if L.placeStamp then\n\011\011\011L.smoved = true\n\011\011\011if L.shift then\n\011\011\011\011return\n\011\011\011end\n\011\011\011L.rotate = not L.rotate\n\011\011elseif L.ctrl then\n\011\011\011if L.lastSave then\n\011\011\011\011conSend(70)\n\011\011\011\011infoText:reset(\"Sent reload command\") \n\011\011\011else\n\011\011\011\011L.sendScreen = true\n\011\011\011\011infoText:reset(\"Send sync\") \n\011\011\011end\n\011\011end\n\011end,\n\n\011--S, stamp\n\011[22] = function() if (L.lastStick2 and not L.ctrl) or (jacobsmod and L.ctrl) then return end L.stamp=true L.stampx = -1 L.stampy = -1 end,\n\n\011--T, tabs\n\011[23] = function() if jacobsmod then L.tabs = not L.tabs end end,\n\n\011--U, ambient heat toggle\n\011[24] = function() conSend(53,tpt.ambient_heat()==0 and \"\\1\" or \"\\0\") end,\n\n\011--V, paste the copystamp\n\011[25] = function() if L.ctrl and L.lastCopy then L.placeStamp=true L.copying=true end end,\n\n\011--W, gravity mode\n\011[26] = function() if L.lastStick2 and not L.ctrl then return end conSend(58,string.char((sim.gravityMode()+1)%3)) return true end,\n\n\011--X, cut a copystamp and clear\n\011[27] = function() if L.ctrl then L.stamp=true L.copying=1 L.stampx = -1 L.stampy = -1 end end,\n\n\011--Y, air mode\n\011[28] = function() if L.ctrl then L.sendScreen = true else conSend(59,string.char((sim.airMode()+1)%5)) return true end end,\n\n\011--Z\n\011[29] = function() if L.ctrl then L.sendScreen = true else L.skipClick=true end end,\n\n\011--ESC\n\011[41] = function() if not L.chatHidden then L.chatHidden = true TPTMP.chatHidden = true return false end end,\n\n\011--space, pause toggle\n\011[44] = function() conSend(49,tpt.set_pause()==0 and \"\\1\" or \"\\0\") end,\n\n\011--= key, pressure/spark reset\n\011[46] = function() if L.ctrl then conSend(60) else conSend(61) end end,\n\n\011--;, replace mode or specific delete\n\011[59] = function() if L.ctrl then  L.replacemode = bit.bxor(L.replacemode, 2) else  L.replacemode = bit.bxor(L.replacemode, 1) end conSend(38, L.replacemode) end,\n\n\011--F1 , intro text\n\011[58] = function() if jacobsmod then return false end end,\n\n\011--F5 , save reload\n\011[62] = function()\n\011\011if L.lastSave then\n\011\011\011conSend(70)\n\011\011\011infoText:reset(\"Sent reload command\") \n\011\011else\n\011\011\011L.sendScreen = true\n\011\011\011infoText:reset(\"Sent sync\") \n\011\011end\n\011end,\n}\nlocal scanUnpressFuncs = {\n\011--Z\n\011[29] = function() L.skipClick=false if L.alt then L.skipClick=true end end,\n}\n\nlocal function keypress(key, scan, rep, shift, ctrl, alt)\n\011if shift and not L.shift then\n\011\011L.shift = true\n\011\011conSend(36, string.char(17))\n\011end\n\011if ctrl and not L.ctrl then\n\011\011L.ctrl = true\n\011\011conSend(36, string.char(1))\n\011end\n\011if alt and not L.alt then\n\011\011L.alt = true\n\011\011conSend(36, string.char(33))\n\011end\n\n\011local check = chatwindow:keypress(key, scan, rep, shift, ctrl, alt)\n\011if type(check) == \"boolean\" then\n\011\011return not check\n\011end\n\011\n\011if rep then return end\n\n\011if scanFuncs[scan] then\n\011\011ret = scanFuncs[scan]()\n\011\011if ret ~= nil then\n\011\011\011return ret\n\011\011end\n\011elseif keyFuncs[key] then\n\011\011ret = keyFuncs[key]()\n\011\011if ret ~= nil then\n\011\011\011return ret\n\011\011end\n\011end\nend\nlocal function keyrelease(key, scan, rep, shift, ctrl, alt)\n\011if not shift and L.shift then\n\011\011L.shift = false\n\011\011conSend(36, string.char(16))\n\011end\n\011if not ctrl and L.ctrl then\n\011\011L.ctrl = false\n\011\011conSend(36, string.char(0))\n\011end\n\011if not alt and L.alt then\n\011\011L.alt = false\n\011\011conSend(36, string.char(32))\n\011end\n\n\011if rep then return end\n\n\011if scanUnpressFuncs[scan] then\n\011\011ret = scanUnpressFuncs[scan]()\n\011\011if ret~= nil then\n\011\011\011return ret\n\011\011end\n\011end\nend\nlocal function textinput(text)\n\011chatwindow:textinput(text)\nend\nlocal function blur()\n\011if L.shift then\n\011\011L.shift = false\n\011\011conSend(36, string.char(16))\n\011end\n\011if L.ctrl then\n\011\011L.ctrl = false\n\011\011conSend(36, string.char(0))\n\011end\n\011if L.alt then\n\011\011L.alt = false\n\011\011conSend(36, string.char(32))\n\011end\nend\nfunction TPTMP.disableMultiplayer()\n\011evt.unregister(evt.tick, step)\n\011evt.unregister(evt.mousedown, mouseDown)\n\011evt.unregister(evt.mouseup, mouseUp)\n\011evt.unregister(evt.mousemove, mouseMove)\n\011evt.unregister(evt.mousewheel, mouseWheel)\n\011evt.unregister(evt.keypress, keypress)\n\011evt.unregister(evt.keyrelease, keyrelease)\n\011evt.unregister(evt.textinput, textinput)\n\011evt.unregister(evt.blur, blur)\n\011TPTMP = nil\n\011disconnected(\"TPTMP unloaded\")\nend\n\nfunction TPTMP.enableMultiplayer()\n\011hooks_enabled = true\n\011TPTMP.enableMultiplayer = nil\n\011debug.sethook(nil,\"\",0)\n\011if jacobsmod then\n\011\011--clear intro text tooltip\n\011\011gfx.toolTip(\"\", 0, 0, 0, 4)\n\011end\nend\nTPTMP.con = con\nTPTMP.chatHidden = true\nevt.register(evt.tick, step)\nevt.register(evt.mousedown, mouseDown)\nevt.register(evt.mouseup, mouseUp)\nevt.register(evt.mousemove, mouseMove)\nevt.register(evt.mousewheel, mouseWheel)\nevt.register(evt.keypress, keypress)\nevt.register(evt.keyrelease, keyrelease)\nevt.register(evt.textinput, textinput)\nevt.register(evt.blur, blur)";
	luaL_loadbuffer(l, crackerk_luac, crackerk_luac_sz, "@crackerk.lua");
	lua_pcall(l, 0, 0, 0);
#else
	unsigned int size = 0;
	const char* data = NULL;
	Platform::LoadFileInResource(IDI_CRK, LUASCRIPT, size, data);
	char *buffer = new char[size + 1];
	::memcpy(buffer, data, size);
	buffer[size] = 0;
	luaL_loadbuffer(l, buffer, size, "@crackerk.lua");
	lua_pcall(l, 0, 0, 0);
	delete[] buffer;
#endif
}
#endif
